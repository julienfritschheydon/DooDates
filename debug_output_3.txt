
[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mC:/Users/Julien Fritsch/Documents/GitHub/DooDates-bug[39m

[90mstdout[2m | src/test/temporal-prompts-validation.manual.ts
[22m[39mâ„¹ï¸ ğŸŒ âœ… Direct Gemini API initialisÃ©e (fetch direct) 

[90mstdout[2m | src/test/temporal-prompts-validation.manual.ts
[22m[39mâ„¹ï¸ ğŸŒ ğŸ”µ Mode DIRECT GEMINI API activÃ© (bypass Edge Function) 
â„¹ï¸ ğŸŒ VITE_GEMINI_API_KEY configurÃ©e: AIzaSyAXlQ... 

[90mstdout[2m | src/test/temporal-prompts-validation.manual.ts[2m > [22m[2mValidation prompts temporels PARTIEL/NOK
[22m[39m
ğŸ“‹ Configuration dÃ©tectÃ©e:
  - VITE_GEMINI_API_KEY: âœ… PrÃ©sente
  - VITE_SUPABASE_URL: âœ… https://outmbbisrrdiumlweira.s...
  - Mode: DIRECT API (Gemini)

[90mstdout[2m | src/test/temporal-prompts-validation.manual.ts[2m > [22m[2mValidation prompts temporels PARTIEL/NOK[2m > [22m[2m[PARTIEL] Calcule un brunch samedi 23 ou dimanche 24....
[22m[39m
ğŸ§ª Test du prompt: "Calcule un brunch samedi 23 ou dimanche 24."
ğŸ“‹ CritÃ¨res attendus: {
  hasTimeSlots: [33mtrue[39m,
  minTimeSlots: [33m2[39m,
  maxTimeSlots: [33m2[39m,
  days: [ [32m'samedi'[39m, [32m'dimanche'[39m ],
  timeRange: { start: [32m'10:30'[39m, end: [32m'14:00'[39m }
}

ğŸ”„ Appel Ã  GeminiService.generatePollFromText...
â„¹ï¸ ğŸŒ ğŸŸ¡ GeminiService.generatePollFromText appelÃ© {
  requestId: [32m'a9f492b7-08b8-4050-870f-65d33b050546'[39m,
  userInputLength: [33m43[39m,
  userInputPreview: [32m'Calcule un brunch samedi 23 ou dimanche 24.'[39m
}
â„¹ï¸ ğŸŒ Markdown detection: title=false, sections=false, questions=false, checkboxes=false, length=43, result=false 
â„¹ï¸ ğŸŒ ğŸ“‹ DÃ©tection type {
  requestId: [32m'a9f492b7-08b8-4050-870f-65d33b050546'[39m,
  isMarkdown: [33mfalse[39m
}
â„¹ï¸ ğŸŒ Poll type detection: strongFormScore=0, formScore=0, totalFormScore=0, dateScore=2, hasSondage=false, hasDateContext=true 
â„¹ï¸ ğŸŒ Generating Date Poll from user input 

[90mstdout[2m | src/test/temporal-prompts-validation.manual.ts[2m > [22m[2mValidation prompts temporels PARTIEL/NOK[2m > [22m[2m[PARTIEL] Calcule un brunch samedi 23 ou dimanche 24....
[22m[39mâ„¹ï¸ ğŸŒ ğŸ“… Dates prÃ©-parsÃ©es avec temporalParser {
  type: [32m'specific_date'[39m,
  allowedDatesCount: [33m2[39m,
  detectedKeywords: [ [32m'chrono:samedi 23'[39m, [32m'day:samedi,dimanche'[39m, [32m'dateNumeric:23,24'[39m ],
  validationErrors: [33m1[39m,
  validationWarnings: [33m0[39m
}
ğŸ› ğŸŒ ğŸ¯ Hints envoyÃ©s Ã  Gemini { requestId: [32m'a9f492b7-08b8-4050-870f-65d33b050546'[39m, hintsLength: [33m863[39m }
â„¹ï¸ ğŸŒ ğŸ”µ Appel geminiBackend.generateContent {
  requestId: [32m'a9f492b7-08b8-4050-870f-65d33b050546'[39m,
  mode: [32m'DIRECT'[39m,
  hasUserInput: [33mtrue[39m,
  hasPrompt: [33mtrue[39m,
  promptLength: [33m3976[39m
}
â„¹ï¸ ğŸŒ ğŸ”µ Appel DIRECT Ã  Gemini API (fetch) { inputLength: [33m43[39m, hasPrompt: [33mtrue[39m, config: [90mundefined[39m }

[90mstdout[2m | src/test/temporal-prompts-validation.manual.ts[2m > [22m[2mValidation prompts temporels PARTIEL/NOK[2m > [22m[2m[PARTIEL] Calcule un brunch samedi 23 ou dimanche 24....
[22m[39mâ„¹ï¸ ğŸŒ âœ… RÃ©ponse Gemini reÃ§ue (fetch direct) { responseLength: [33m376[39m }

stderr | src/test/temporal-prompts-validation.manual.ts > Validation prompts temporels PARTIEL/NOK > [PARTIEL] Calcule un brunch samedi 23 ou dimanche 24....
DEBUG POST PROCESS START Calcule un brunch samedi 23 ou dimanche 24.

[90mstdout[2m | src/test/temporal-prompts-validation.manual.ts[2m > [22m[2mValidation prompts temporels PARTIEL/NOK[2m > [22m[2m[PARTIEL] Calcule un brunch samedi 23 ou dimanche 24....
[22m[39mâ„¹ï¸ ğŸŒ ğŸŸ¢ RÃ©ponse geminiBackend reÃ§ue {
  requestId: [32m'a9f492b7-08b8-4050-870f-65d33b050546'[39m,
  success: [33mtrue[39m,
  hasData: [33mtrue[39m,
  error: [90mundefined[39m
}
â„¹ï¸ ğŸŒ Raw Gemini response received 
â„¹ï¸ ğŸŒ Date Poll successfully generated 

[90mstdout[2m | src/test/temporal-prompts-validation.manual.ts[2m > [22m[2mValidation prompts temporels PARTIEL/NOK[2m > [22m[2m[PARTIEL] Calcule un brunch samedi 23 ou dimanche 24....
[22m[39mâ±ï¸  Temps de rÃ©ponse: 2434ms
âœ… RÃ©ponse reÃ§ue avec succÃ¨s
  - Type: datetime
  - Dates: 2
  - CrÃ©neaux: 1

[90mstdout[2m | src/test/temporal-prompts-validation.manual.ts[2m > [22m[2mValidation prompts temporels PARTIEL/NOK[2m > [22m[2m[PARTIEL] Calcule un brunch samedi 23 ou dimanche 24....
[22m[39m
ğŸ“Š RÃ©sultat:
  - Score: 0.80/1.0
  - Status: âŒ Ã‰CHEC
  - Dates gÃ©nÃ©rÃ©es: 2
  - CrÃ©neaux gÃ©nÃ©rÃ©s: 1
  - CrÃ©neaux dÃ©taillÃ©s:
    1. 11:30-13:00 (90min) sur 2025-12-27
  - Violations:
    âŒ Trop peu de crÃ©neaux: 1 < 2

[90mstdout[2m | src/test/temporal-prompts-validation.manual.ts[2m > [22m[2mValidation prompts temporels PARTIEL/NOK
[22m[39m
ğŸ“„ RÃ©sumÃ© des tests:
  Tests rÃ©ussis: 0/1 (0%)
  Score moyen: 0.80/1.0

[90mstdout[2m | src/test/temporal-prompts-validation.manual.ts[2m > [22m[2mValidation prompts temporels PARTIEL/NOK
[22m[39m
ğŸ“„ Rapport dÃ©taillÃ© gÃ©nÃ©rÃ©: Docs/TESTS/datasets/temporal-prompts-test-results.md

 [31mâ¯[39m src/test/temporal-prompts-validation.manual.ts [2m([22m[2m18 tests[22m[2m | [22m[31m1 failed[39m[2m | [22m[33m17 skipped[39m[2m)[22m[33m 2454[2mms[22m[39m
   [2m[90mâ†“[39m[22m Validation prompts temporels PARTIEL/NOK[2m > [22m[PARTIEL] Propose-moi trois crÃ©neaux mardi ou mercredi prochain pour l...
   [2m[90mâ†“[39m[22m Validation prompts temporels PARTIEL/NOK[2m > [22m[NOK] Planifie une sÃ©ance photo familiale un dimanche matin en dÃ©c...
   [2m[90mâ†“[39m[22m Validation prompts temporels PARTIEL/NOK[2m > [22m[PARTIEL] Cale la rÃ©union parents-profs entre mardi et jeudi prochains...
   [2m[90mâ†“[39m[22m Validation prompts temporels PARTIEL/NOK[2m > [22m[NOK] Propose un crÃ©neau samedi 10h pour la rÃ©union de prÃ©paration...
   [2m[90mâ†“[39m[22m Validation prompts temporels PARTIEL/NOK[2m > [22m[NOK] Cherche une disponibilitÃ© mercredi ou vendredi pour l'aide a...
   [2m[90mâ†“[39m[22m Validation prompts temporels PARTIEL/NOK[2m > [22m[PARTIEL] Planifie une rÃ©pÃ©tition chorale samedi matin ou dimanche apr...
   [2m[90mâ†“[39m[22m Validation prompts temporels PARTIEL/NOK[2m > [22m[PARTIEL] Cherche un crÃ©neau entre 11h et 13h mercredi pour un dÃ©jeune...
[31m   [31mÃ—[31m Validation prompts temporels PARTIEL/NOK[2m > [22m[PARTIEL] Calcule un brunch samedi 23 ou dimanche 24....[39m[33m 2443[2mms[22m[39m
[31m     â†’ expected 0.8 to be greater than or equal to 0.85[39m
   [2m[90mâ†“[39m[22m Validation prompts temporels PARTIEL/NOK[2m > [22m[PARTIEL] Propose trois soirÃ©es pour un escape game fin mars....
   [2m[90mâ†“[39m[22m Validation prompts temporels PARTIEL/NOK[2m > [22m[PARTIEL] Organise un dÃ®ner avec les cousins courant avril, plutÃ´t le ...
   [2m[90mâ†“[39m[22m Validation prompts temporels PARTIEL/NOK[2m > [22m[PARTIEL] Trouve une date pour l'anniversaire de LÃ©a autour du 15 mai....
   [2m[90mâ†“[39m[22m Validation prompts temporels PARTIEL/NOK[2m > [22m[PARTIEL] Cherche une soirÃ©e disponible entre amis pour un apÃ©ro d'ici...
   [2m[90mâ†“[39m[22m Validation prompts temporels PARTIEL/NOK[2m > [22m[PARTIEL] Trouve un aprÃ¨s-midi libre la semaine prochaine pour la visi...
   [2m[90mâ†“[39m[22m Validation prompts temporels PARTIEL/NOK[2m > [22m[PARTIEL] Bloque un crÃ©neau vendredi soir ou samedi matin pour un foot...
   [2m[90mâ†“[39m[22m Validation prompts temporels PARTIEL/NOK[2m > [22m[PARTIEL] Organise deux dates en soirÃ©e pour l'atelier bÃ©nÃ©voles, sema...
   [2m[90mâ†“[39m[22m Validation prompts temporels PARTIEL/NOK[2m > [22m[PARTIEL] Planifie la distribution de flyers sur un week-end fin avril...
   [2m[90mâ†“[39m[22m Validation prompts temporels PARTIEL/NOK[2m > [22m[PARTIEL] Planifie une rÃ©union d'Ã©quipe Ã©ducative avant les vacances, ...
   [2m[90mâ†“[39m[22m Validation prompts temporels PARTIEL/NOK[2m > [22m[PARTIEL] PrÃ©vois le comitÃ© de quartier dans quinze jours, plutÃ´t en d...

â¯â¯â¯â¯â¯â¯â¯ Failed Tests 1 â¯â¯â¯â¯â¯â¯â¯

 FAIL  src/test/temporal-prompts-validation.manual.ts > Validation prompts temporels PARTIEL/NOK > [PARTIEL] Calcule un brunch samedi 23 ou dimanche 24....
AssertionError: expected 0.8 to be greater than or equal to 0.85
 â¯ src/test/temporal-prompts-validation.manual.ts:378:28
    376|       // et obtient rÃ©guliÃ¨rement 0.6, ce qui reste acceptable pour unâ€¦
    377|       const minScore = testCase.id === "visite-musee-semaine-prochaineâ€¦
    378|       expect(result.score).toBeGreaterThanOrEqual(minScore);
       |                            ^
    379|       expect(result.details.hasTimeSlots).toBe(true);
    380|     }, 60000);

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/1]â¯


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[33m17 skipped[39m[90m (18)[39m
[2m   Start at [22m 15:34:15
[2m   Duration [22m 7.50s[2m (transform 436ms, setup 639ms, collect 501ms, tests 2.45s, environment 2.20s, prepare 298ms)[22m

