#!/bin/sh
echo "ğŸš€ DooDates - Validation pre-push..."

# Ressources accrues pour Ã©viter OOM et fiabiliser Vitest
export NODE_OPTIONS="--max-old-space-size=4096"
export VITEST_MAX_THREADS=1
export VITEST_POOL=forks

# 1. Suite complÃ¨te de tests unitaires
echo "ğŸ§ª Tests unitaires complets..."
npm run test:unit
if [ $? -ne 0 ]; then
  echo "âŒ Tests unitaires complets Ã©chouÃ©s - Push bloquÃ©"
  exit 1
fi

# 2. Tests d'intÃ©gration
echo "ğŸ”— Tests d'intÃ©gration..."
npm run test:integration
if [ $? -ne 0 ]; then
  echo "âŒ Tests d'intÃ©gration Ã©chouÃ©s - Push bloquÃ©"
  exit 1
fi

# 3. Build de production
echo "ğŸ—ï¸ Build production..."
npm run build
if [ $? -ne 0 ]; then
  echo "âŒ Build production Ã©chouÃ© - Push bloquÃ©"
  exit 1
fi

echo "âœ… Pre-push validÃ© - Push autorisÃ©" 