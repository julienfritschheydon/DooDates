# DooDates – Évolution "Sondage Dates" OU "Formulaire/Questions"

Document de cadrage avant implémentation.


## 1) Portée et critères de succès (MOST IMPORTANT)

- __Objectif__
  - Permettre la création de sondages de deux types: 
    - Date-based (Sondage de dates/horaires – existant)
    - Form-based (Questions – choix unique, choix multiples, réponse libre)
  - Conserver l’ADN DooDates: simplicité, mobile-first, extension progressive sans changement de page.

- __Terminologie__
  - PollType: `date` | `form`
  - DatePoll: sondage de dates/horaires (PollCreator actuel)
  - FormPoll: sondage de questions (MCQ, multi-select, texte)

- __MVP – Périmètre__
  - Création: sélectionner le type (Date ou Form) au démarrage (ou via bouton + puis choix).
  - DatePoll (inchangé côté MVP): sélection de dates, option horaires, titre, partage, vote.
  - FormPoll (MVP minimal): 
    - 1 à 5 questions max
    - Types supportés: Single choice, Multiple choice, Short text
    - Pas de logique conditionnelle entre questions
    - Pas d’édition après publication
  - Partage: lien unique, même mécanique que les sondages actuels.
  - Vote/Réponse: 
    - DatePoll: UI actuelle
    - FormPoll: liste de questions avec validations simples (obligatoire / max choix)
  - Identité répondant: champ Nom optionnel (pas de compte requis)
  - Anti-abus: throttle léger par IP + limite 1 réponse par navigateur (localStorage); pas de CAPTCHA
  - Feature flag: `enableFormPoll` pour activer le type "Formulaire" (d’abord en dev)
  - Résultats: 
    - DatePoll: identique
    - FormPoll: agrégations simples (compte par option, liste anonymisée pour texte)

- __Non-objectifs (MVP)__
  - Pas de logique conditionnelle entre questions (branching)
  - Pas de pages longues type Typeform
  - Pas de scoring, pas de quotas
  - Pas de fichiers uploadés
  - Pas d’auth forcée des répondants

- __Critères de succès (mesurables)__
  - Taux de complétion des FormPoll ≥ 80% sur mobile
  - Temps médian de création < 60s pour un FormPoll à 3 questions
  - Aucune régression UX pour DatePoll (tests E2E verts)
  - 0 erreur JavaScript critique en production


## 2) Flows UX (MOST IMPORTANT)

- __Principes__
  - Extension progressive (mémoire: `DooDates-UX-Flow`): pas de changement de page, sections qui se déplient
  - Mobile-first, gestes simples, boutons explicites

- __Création__
  - Étape 0: Bouton "+" (ou carte “Nouveau”) → choix du type: `Date` ou `Formulaire`
  - Si `Date`:
    - Calendrier direct (dates à partir d’aujourd’hui), puis bouton « Ajouter des horaires » (optionnel), puis Titre/Partage
  - Si `Formulaire`:
    - Champ Titre
    - Bloc Questions (ajouter une question):
      - Type: Single | Multiple | Texte court
      - Pour Single/Multiple: liste d’options (min 2, max 10)
      - Pour Multiple: paramètre max de choix (ex: 2/3)
      - Obligatoire oui/non
    - Section Partage

- __Partage__
  - Même composant que DatePoll (lien, copier, envoyer email plus tard)

- __Vote / Réponse__
  - DatePoll: UI existante (sélection date/horaires, nom, envoyer)
  - FormPoll:
    - Rendu par question
    - Validations inline (ex: “Sélectionnez au moins 1 option”)
    - CTA “Envoyer mes réponses”

- __Résultats__
  - DatePoll: inchangé (tableau disponibilités)
  - FormPoll:
    - Single/Multiple: histogramme simple (compteurs par option)
    - Texte: liste des réponses (anonymisées, 2 lignes max + bouton “Voir tout”)


## 3) Modèle de domaine unifié (LATER)

- __Types principaux__
  - Poll { id, type, title, createdAt, ... }
  - For type `date`: options = Date + TimeSlots
  - For type `form`: questions[]
    - Question { id, kind: single|multiple|text, title, required, options?, maxChoices? }
  - Response { pollId, respondentName?, items[] }
    - ResponseItem { questionId|dateSlotId, value }

- __Règles__
  - Validation côté client pour types single/multiple (maxChoices) et required
  - Type-safety via TypeScript unions discriminants pour `kind`


## 4) Schéma DB (Supabase) et parité localStorage (LATER, sans migration)

- __Tables (proposition)__
  - polls(id, type, title, slug, created_at, ...)
  - date_options(poll_id, date)
  - time_slots(poll_id, date_option_id, start, end)
  - questions(poll_id, question_id, kind, title, required, max_choices)
  - question_options(poll_id, question_id, option_id, label)
  - responses(id, poll_id, respondent_name, created_at)
  - response_items(response_id, question_id?, date_option_id?, time_slot_id?, value_text?, option_id?)

- __Local dev__
  - Structure JSON miroir pour `dev-polls` dans localStorage afin de tester sans Supabase.


## 5) Impact API & composants (LATER)

- __Front__
  - `src/components/polls/` : ajouter un créateur FormPoll (questions)
  - `src/components/voting/` : rendu FormPoll (single/multiple/text)
  - `src/hooks/usePolls.ts` : étendre pour gérer `type: 'date' | 'form'`
  - `src/pages/Results.tsx` : afficher aggrégations FormPoll
  - Feature flag léger: `enableFormPoll` pour gating UI

- __Tests existants__
  - Vérifier `data-testid` sur nouveaux composants


## 6) Stratégie de tests (LATER)

- __Unit__
  - Validation questions (required, maxChoices)
  - Sérialisation/parsings (localStorage <-> modèles)

- __E2E Playwright__
  - Création FormPoll (3 questions), partage, réponse, résultats
  - Non-régression DatePoll (scénarios actuels)

- __Fixtures__
  - Jeux de données FormPoll simples (1, 3, 5 questions)


## 7) Spike/Prototype (LATER)

- Branche: `feature/form-poll-spike`
- Timebox: 1–2 jours ouvrés
- Objectif: prouver la faisabilité UX/tech minimale de FormPoll sans régression DatePoll
- Implémenter Minimum Viable:
  - Création FormPoll avec Single/Multiple/Text
  - Réponse avec validations inline (required, maxChoices) et stockage localStorage
  - Résultats en lecture seule (compteurs + liste texte anonymisée)
  - Feature flag activé uniquement en développement
- Critères d’acceptation:
  - Un FormPoll à 3 questions peut être créé, partagé (copie de lien), recevoir au moins 1 réponse et afficher des résultats lisibles
  - Aucun test E2E DatePoll existant ne casse
  - Aucune erreur console critique en création / réponse / résultats


## 8) Rollout (LATER)

- UI toggle: activer FormPoll pour 100% des users après tests
- Analytics: taux de complétion, erreurs validation
- Documentation: mise à jour `Docs/DooDates-UX-Flow.md` et README
