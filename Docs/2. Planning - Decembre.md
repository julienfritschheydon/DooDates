# ğŸš€ DOODATES - PLANNING BÃŠTA DÃ‰TAILLÃ‰
***



## NOUVELLES IDEES
  ### HIGH
    - Revenir Ã  CrewAI, oui et pourquoi ? Test surtout.
  ### MEDIUM
    - Suivre les release de Google Form Enteprise pour nous et faire pareil voir mieux pour les gens n'ayant pas accÃ¨s 
  ### LOW
  - Comparer : Asana
  - Ã‰tudier commetaire calendly et le prix

## ğŸ“‹ OBJECTIF STRATÃ‰GIQUE

**ğŸ¯ Deadline BÃªta :** Fin dÃ©cembre 2025  
**ğŸ‘¥ Objectif :** Lancer une bÃªta fonctionnelle avec 10-20 utilisateurs testeurs  
**â±ï¸ Rythme :** **3h par jour** (2h critiques + 1h travail de fond)  
**ğŸŒ Vision :** Architecture internationale "privacy-by-design" et "security-by-design"

---

## PLAN D'EXÃ‰CUTION - 3H/JOUR (2H + 1H TRAVAIL DE FOND)

### Semaine 1 : Architecture Structurante + StabilitÃ© Critique

- âœ… **Lundi :** **Architecture Backend Commun** (2h) â­
  - âœ… **AJOUT :** DÃ©tection gÃ©ographique (Cloudflare + IPinfo) - TERMINÃ‰
    - [x] Choisir API (IPinfo vs Cloudflare Geo)
    - [x] CrÃ©er service `geo-detection.ts`
    - [x] IntÃ©grer middleware Express
    - [?? ] Tests E2E localisation (VPN test)
  - âœ… **AJOUT :** Pricing multi-rÃ©gions (price lists) - TERMINÃ‰
    - [x] CrÃ©er tables `regions` + `price_lists`
    - [x] Service `pricing-service.ts`
    - [x] IntÃ©grer dÃ©tection auto-rÃ©gion
    - [x] Tests conversion devises
  - âœ… **AJOUT :** Tests dÃ©tection gÃ©ographique
    - [x] Test dÃ©tection pays via IP
    - [x] Test VPN detection (optionnel)
    - [x] Test fallback rÃ©gion par dÃ©faut
    - [x] Test pricing par rÃ©gion automatique
  - [x]**Tester les changements sur les formulaires**

**Mardi :** **Finalisation + SÃ©curitÃ© Backend** (2h) â­
  - âœ… **INTÃ‰GRATION GOOGLE SIGN-IN** - TERMINÃ‰
    - [x] Boutons Google dans SignInForm et SignUpForm
    - [x] Gestion des Ã©tats de chargement et erreurs
    - [x] Connexion via OAuth avec Supabase
    - [x] Tests de compilation et build rÃ©ussis    
  - âœ… **RÃ‰SOLUTION DES CONFLITS DE TYPES GEMINI** - TERMINÃ‰
    - [x] CrÃ©ation d'un fichier `poll-suggestions.ts` centralisÃ©
    - [x] Unification des types `PollSuggestion`, `FormPollSuggestion` et `DatePollSuggestion`
    - [x] Correction des imports dans `GeminiChatInterface.tsx` et `ConversationService.ts`
    - [x] Gestion du type `"date"` dans `QuestionType`
    - [x] RÃ©solution des conflits de types avec `dateGroups`
    - [x] Correction de `setLastAIProposalAdapter`
  - âœ… BUG - Alignement des jours et des horaires (select lots of days to show it) (15 min)
  - âœ… **â° Bloc 2 : SÃ©curitÃ© & RGPD (TERMINÃ‰) âœ…** ğŸ”’
  - âœ… **IMPLÃ‰MENTÃ‰ :** SÃ©curitÃ© quotas & rate limiting
      - [x] Service `rate-limiter.ts` (10 req/min) - 30 min
        - Gestion des fenÃªtres de temps
        - Blocage aprÃ¨s dÃ©passement
        - Tests unitaires complets
      - [x] Middleware protection quotas - 20 min
        - IntÃ©gration avec l'API
        - Gestion des erreurs
  - âœ… **IMPLÃ‰MENTÃ‰ :** Logs RGPD (consentement, IP hash)
      - [x] Service `consent-logger.ts` - 15 min
        - Journalisation des consentements
        - Export des donnÃ©es utilisateur
        - Suppression des donnÃ©es
      - [x] IP hash SHA-256 (jamais en clair) - 10 min
        - Hachage sÃ©curisÃ©
        - Anonymisation des adresses IP
        - Gestion des erreurs
  - âœ… **â° Bloc 3 : Architecture Backend (1h)** ğŸ—ï¸
    - [x] **SÃ©parer services par produit**
        - [x] Identifier API partagÃ©e (auth, quotas, conversations)
        - [x] Documentation architecture backend â†’ **Voir @[Analyse - SÃ©paration Services par Produit.md]**
        - [x] CrÃ©er structure dossiers backend commune - 15 min
        - [x] **Scission structure progressive** - 25 min
          - [x] CrÃ©er dossiers products/shared/ai (5 min)
          - [x] DÃ©placer gemini.ts dans ai/ (5 min)
          - [x] CrÃ©er wrappers pollStorage (10 min)
          - [x] Mettre Ã  jour imports critiques (5 min)
    - âœ… **Scission pollStorage.ts** â†’ **COMPLÃ‰TÃ‰ AVEC SUCCÃˆS**
      - âœ… SÃ©parer date-polls/form-polls/quizz services
      - âœ… Maintenir interface unifiÃ©e via index.ts
      - âœ… Tests validation rapides (E2E: 11/11 passÃ©s)
      - âœ… **RÃ‰SULTAT :** 1343 lignes â†’ 3 services spÃ©cialisÃ©s (1204 lignes total)
  - âœ… **AMÃ‰LIORATION DOCUMENTATION MOBILE**
    - [x] Menu hamburger pour navigation mobile
    - [x] Backdrop pour fermeture au clic
    - [x] Animation fluide d'ouverture/fermeture
    - [x] Correction du padding et de la mise en page
  - âœ… **REFACTORISATION TYPES GEMINI**
    - [x] DÃ©placer les types `PollSuggestion` vers `poll-suggestions.ts`
    - [x] Mettre Ã  jour les imports dans `useGeminiAPI.ts`
    - [x] Ajouter le typage correct pour la rÃ©ponse de l'API

  - âŒ **BUG GOOGLE AUTH - NON RÃ‰SOLU**
    - [x] Modification `AuthContext.tsx` ligne 275 : `redirectTo: ${window.location.origin}/DooDates/auth/callback`
    - [x] Configuration Supabase : URLs de redirection ajoutÃ©es
    - âŒ **PROBLÃˆME PERSISTANT** : URL finale contient `/DooDates/DooDates/dashboard` (duplication)
    - **CAUSE** : Conflit entre `vite.config.ts` (`base: "/DooDates/"`) et `BrowserRouter` (`basename="/DooDates"`)
    - **Ã€ INVESTIGUER** : Trouver la source de la duplication du path

### ğŸ“Œ MERCREDI 4 DÃ‰CEMBRE - JOUR 3

## ğŸš¨ ACTIONS PRIORITAIRES IMMÃ‰DIATEMENT

### âœ… **CE QUI EST DÃ‰JÃ€ FAIT (Lundi/Mardi)**
- âœ… Services sÃ©curitÃ© implÃ©mentÃ©s (rate-limiter, ip-hash, consent-logger)
- âœ… Tests unitaires complets (704 lignes de tests)
- âœ… Architecture services par produit (date-polls, form-polls, quizz)
- âœ… Middleware sÃ©curitÃ© (244 lignes)

### âš ï¸ **CE QUI MANQUE (Ã€ Faire Mercredi)**
- âŒ Tests E2E sÃ©curitÃ© (rate limiting, RGPD)
- âŒ Tests API partagÃ©es (auth, quotas, conversations)
- âŒ Documentation types partagÃ©s services
- âŒ Structure frontend multi-produits

### ğŸ”´ **BUGS CRITIQUES Ã€ CORRIGER (Semaine 2)**
1. **Bug Quota IncohÃ©rent** - Dashboard vs Edge Function (4-6h)
2. **Tests E2E Ã‰chouent** - `end-to-end-with-backend.spec.ts` (10 test.skip)
3. **Discussions DupliquÃ©es** - 5x mÃªme sondage aprÃ¨s refresh

---

ğŸ”¹ **TESTS BACKEND CRITIQUES** (2h) â­
- [ ] **Tests SÃ©curitÃ© Quotas & Rate Limiting** (45 min)
  - [ ] Test rate limiting (10 req/min par IP) - IntÃ©gration E2E
  - [ ] Test injection quotas manuels
  - [ ] Test contournement guest limits
  - [ ] Test protection DDoS basique
  - âœ… **EXISTANT :** Tests unitaires rate-limiter.test.ts (180 lignes) - COMPLETS
  - âœ… **EXISTANT :** Service rate-limiter.ts (247 lignes) - IMPLÃ‰MENTÃ‰
  - âœ… **EXISTANT :** Middleware middleware.ts (244 lignes) - IMPLÃ‰MENTÃ‰

- [ ] **Tests ConformitÃ© RGPD** (45 min)
  - [ ] Test IP hash SHA-256 (jamais en clair) - Validation E2E
  - [ ] Test logs consentement horodatÃ©s
  - [ ] Test export donnÃ©es utilisateur
  - [ ] Test suppression complÃ¨te donnÃ©es
  - âœ… **EXISTANT :** Tests unitaires ip-hash.test.ts (266 lignes) - COMPLETS
  - âœ… **EXISTANT :** Tests unitaires consent-logger.test.ts (258 lignes) - COMPLETS
  - âœ… **EXISTANT :** Service ip-hash.ts (226 lignes) - IMPLÃ‰MENTÃ‰
  - âœ… **EXISTANT :** Service consent-logger.ts (307 lignes) - IMPLÃ‰MENTÃ‰

- [ ] **Tests API PartagÃ©es** (30 min)
  - [ ] Tests API auth (authentification)
  - [ ] Tests API quotas (consommation)
  - [ ] Tests API conversations (CRUD)
  - [ ] VÃ©rifier couverture tests backend

ğŸ”¹ **VÃ‰RIFICATION STRUCTURE SERVICES PAR PRODUIT** (1h)
- [ ] **Valider Architecture ScindÃ©e** (30 min)
  - âœ… **EXISTANT :** `src/lib/products/date-polls/date-polls-service.ts` (314 lignes)
  - âœ… **EXISTANT :** `src/lib/products/form-polls/form-polls-service.ts` (434 lignes)
  - âœ… **EXISTANT :** `src/lib/products/quizz/quizz-service.ts` (456 lignes)
  - âœ… **EXISTANT :** Interface unifiÃ©e `src/lib/products/index.ts`
  - [ ] VÃ©rifier rÃ©trocompatibilitÃ© des wrappers
  - [ ] Documenter types partagÃ©s et points d'extension

- [ ] **Planifier Tests Manquants** (30 min)
  - [ ] Identifier tests unitaires manquants par service
  - [ ] CrÃ©er plan tests intÃ©gration services
  - [ ] Documenter cas edge Ã  tester

**+1h Travail de fond :** **Structure Frontend Multi-Produits**
- [ ] CrÃ©er structure dossiers frontend par produit
- [ ] Mettre en place routage par produit
- [ ] PrÃ©parer landing pages sÃ©parÃ©es

### ğŸ“Œ JEUDI 5 DÃ‰CEMBRE - JOUR 4
ğŸ”¹ **INTERNATIONALISATION (i18n)**
- [ ] Installer `react-i18next` + `i18next`
- [ ] Configurer `i18n/index.ts` avec dÃ©tection de langue
- [ ] CrÃ©er dossiers `locales/` (en/fr/de/hi)
- [ ] Traduire composants critiques (TopNav, auth)
- [ ] Ajouter sÃ©lecteur de langue dans TopNav

### ğŸ“Œ VENDREDI 6 DÃ‰CEMBRE - JOUR 5
ğŸ”¹ **DÃ‰PLOIEMENT ET TESTS**
- [ ] DÃ©ploiement sur l'environnement de test
- [ ] Tests utilisateur finaux
- [ ] Correction des bugs critiques

## ğŸ“… SEMAINE 2 - 9-13 DÃ‰CEMBRE 2024

### ğŸ“Œ LUNDI 9 DÃ‰CEMBRE - JOUR 6
ğŸ”¹ **DÃ‰PLOIEMENT EN PRODUCTION**
- [ ] DÃ©ploiement progressif
- [ ] Monitoring des erreurs
- [ ] Support utilisateur

**+1h Travail de fond :** **Fingerprinting Phase 3 - Tests Dashboard Admin**
- AccÃ¨s `/admin/quotas` avec compte admin
- VÃ©rifier affichage quotas guests, filtres, statistiques
- Tester rafraÃ®chissement automatique et recherche
- ğŸ› BUG - Alignement horaires KO â†’ **PRIORITÃ‰ 2 (aprÃ¨s calendar_conflict)**

**+1h Travail de fond :** **Google Calendar - DÃ©tection conflits** ğŸ—“ï¸
- [/] Feature/calendar_conflict Ã  finir > en cours de push sur sa branche (30 min)
- [ ] Tester flux complet connexion Google Calendar (30 min)
- [ ] VÃ©rifier dÃ©tection conflits dates/heures avec sondages (20 min)
- [ ] Identifier cas d'usage et amÃ©liorations UX (10 min)

**Jeudi :** **Architecture Frontend & i18n** (2h) â­
- [ ] **COMPOSANTS COMMUNS**
  - [ ] Extraire TopNav, auth, quotas en composants partagÃ©s
  - [ ] CrÃ©er systÃ¨me de thÃ¨me unifiÃ©
  - [ ] ImplÃ©menter chargement paresseux (lazy loading)

- [ ] **INTERNATIONALISATION (i18n)**
  - [ ] Configurer `i18next` avec dÃ©tection automatique
  - [ ] CrÃ©er fichiers de traduction de base
  - [ ] IntÃ©grer avec le hook `useLanguage`
  - [ ] Tester le changement de langue dynamique
- âœ… **AJOUT :** GeoBanner (conformitÃ© UE 2018/302)
  - [ ] Composant `GeoBanner.tsx` pour utilisateurs UE
  - [ ] Message conformitÃ© cookies/localisation
  - [ ] Condition affichage par dÃ©tection IP
  - [ ] Tests affichage banner UE vs non-UE
- âœ… **AJOUT :** Security headers & rate limiting UI
  - [ ] Indicateur visuel rate limiting atteint
  - [ ] Messages erreur sÃ©curitÃ© clairs
  - [ ] Tests UX limites quotas dÃ©passÃ©s
- CrÃ©er lib/shared components
- Tests composants partagÃ©s
**+1h Travail de fond :** **Fingerprinting Phase 3 - Tests Migration**
- CrÃ©er conversations/polls en mode guest
- Se connecter et vÃ©rifier migration fingerprint â†’ compte
- VÃ©rifier prÃ©servation compteurs et idempotence

**+1h Travail de fond :** **Bug Quota IncohÃ©rent**
- Analyser flux Dashboard vs Edge Function
- Unifier systÃ¨me de quotas
- âœ… **AJOUT :** SÃ©curisation quotas (dÃ©jÃ  implÃ©mentÃ©)
- âœ… **AJOUT :** Documentation sÃ©curitÃ© & monitoring
- Tests E2E cohÃ©rence quotas
- Documentation flux consommation
**+1h Travail de fond :** **Test Refactoring - Validation Tests RÃ©activÃ©s** âœ…
- [x] GeminiChatInterface (tests de types rÃ©solus)
- [ ] unified-flow, useIntentDetection
- [ ] AuthContext, OnboardingContext, useFreemiumQuota
- [ ] ConversationSearch, ConversationList, ConversationCard
- Diagnostic h1 page vote

### Semaine 2 : StabilitÃ© + Refactors CiblÃ©s
**Lundi :** Tests E2E restants (2h)
- RÃ©parer `end-to-end-with-backend.spec.ts`
- RÃ©activer `ultra-simple-form.spec.ts`
- Diagnostic h1 page vote
**+1h Travail de fond :** **Tests manuels corrections**
- Tests manuels corrections UX
- Validation UX post-publication
- Tests parsing Gemini
- PROBLEME - dashboard-complete.spec.ts en mode 'serial'

**Mardi :** Bugs UX Bloquants (2h)
- DisponibilitÃ©s : exiger un compte utilisateur (sÃ©curitÃ© + traÃ§abilitÃ©)
- Discussions dupliquÃ©es (5x mÃªme sondage)
- Message quota incorrect
- Tests manuels corrections
**+1h Travail de fond :** **Documentation Screenshots**
- Page `03-Sondages-Dates.md` : Ajouter screenshot manquant
- Corriger alignement tableau + "Horaires par Date" â†’ "Horaires par date"
- Simplifier grandement la documentation

**Mercredi :** **Refactor PollCreator Hook** (2h) â­
- Extraire usePollCreatorState (500 lignes)
- RÃ©duire PollCreator de 1650 â†’ 1150 lignes
- Tests validation refactor
**+1h Travail de fond :** **Tests Antigravity**
- Tests regroupement visuel mobile
- Tests navigation dashboard â†’ discussions
- Tests parsing Gemini avancÃ©

**Jeudi :** **Refactor gemini.ts Modules** (2h) â­
- Scinder en 3 modules (service/prompts/utils)
- RÃ©duire 2072 â†’ 3x700 lignes
- Tests modules isolÃ©s

**+1h Travail de fond :** **Google Calendar - Documentation**
- Documenter comportements attendus vs observÃ©s
- AmÃ©liorer affichage conflits utilisateur
- Cas d'usage avancÃ©s

**Vendredi :** **Refactor useConversationSearch Service** (2h) â­
- Extraire debouncing + regex dans service
- RÃ©duire complexitÃ© hook
- Tests unitaires service

**+1h Travail de fond :** **Fingerprinting - Tests approfondis**
- Tests multiples fingerprints diffÃ©rents
- Validation accÃ¨s non-admin ("Access Denied")
- Tests formatage dates et badges confidence

### Semaine 3 : Gemini Debug + Tests
**Lundi :** `test-gemini-comprehensive.js` (2h)
- Tests complets cas edge
- Validation hints conditionnels

**Mardi :** `debug-isolation.js` (2h)
- Debug rule-by-rule
- Isolation problÃ¨mes spÃ©cifiques

**Mercredi :** `system-comparison.js` (2h)
- Comparaison ancien vs nouveau systÃ¨me
- Benchmarks performance

**Jeudi :** **Architecture isComplexCase()** (2h) â­
- ImplÃ©menter logique conditionnelle hints
- Tests validation performance
- Documentation architecture

**Vendredi :** `gemini-date-polls.test.ts` (2h)
- 48 tests dates avec annÃ©es futures
- Tests parsing complexe

### Semaine 4 : Tests Gemini + Finalisation BÃªta

**Lundi :** `gemini-form-polls.test.ts` (2h)
- 10 tests formulaires
- Tests IA gÃ©nÃ©ration

**Mardi :** `gemini-comprehensive.test.ts` (2h)
- Tests combinÃ©s cross-produits
- Validation architecture

**Mercredi :** **Prototype Aide aux Devoirs** (2h + 1h)
- Interface quizz simple (photo â†’ questions)
- â­ Architecture mobile-ready
- â­ Support multi-langues (fr/en)
- Logique correction basique
- IntÃ©gration backend commun
- **+1h :** Analytics IA DatePolls
  - Adapter PollAnalyticsService pour dates (2h)
    - [ ] Adapter algorithmes consensus pour dates
    - [ ] Calculer conflits horaires automatiquement
    - [ ] GÃ©nÃ©rer insights "Meilleure date ?"
  - Insights consensus/conflits automatiques (1h)
    - [ ] DÃ©tection automatique des conflits
    - [ ] Suggestions de dates alternatives
    - [ ] Visualisation heatmap disponibilitÃ©
  - UI panneau analytics (1h)
    - [ ] Composant `DateAnalyticsPanel.tsx`
    - [ ] Graphiques consensus/conflits
    - [ ] Export suggestions PDF

**Jeudi :** **Tests Transverses** (2h + 1h)
- Tests E2E cross-produits
- â­ Tests sÃ©curitÃ© multi-rÃ©gions
- â­ Tests conformitÃ© RGPD
- **+1h :** Tests Analytics DatePolls
- Validation architecture sÃ©parÃ©e
- Tests intÃ©gration finaux

**Vendredi :** **Finalisation BÃªta** (2h + 1h)
- Documentation utilisateur
- â­ Page "Transparence & Impact"
- â­ Configuration Supabase production
- â­ Documentation SÃ©curitÃ© & RGPD
- **+1h :** Consolidation Tests E2E
- PrÃ©paration bÃªta
- Checklist lancement
- Tests finaux

---
## ğŸ“Š RÃ‰CAPITULATIF PAR SEMAINE

| Semaine | Focus Critical | Travail Fond | Livrables |
|---------|----------------|--------------|-----------|
| **S1** | Architecture Backend | Tests FormPoll | Backend multi-rÃ©gions |
| **S2** | StabilitÃ© UX | Documentation | Refactors majeurs |
| **S3** | Debug Gemini | - | Tests complets |
| **S4** | Finalisation | Analytics IA | BÃªta prÃªte |

---
## ğŸ¯ SUCCÃˆS GARANTI

âœ… **Architecture internationale** (Backend multi-rÃ©gions + i18n)  
âœ… **SÃ©curitÃ© RGPD** (IP hash, consent logs, rate limiting)  
âœ… **Analytics IA avancÃ©s** (Consensus dates, conflits, heatmap)  
âœ… **Tests complets** (UnitÃ©s, E2E, sÃ©curitÃ©, RGPD)  
âœ… **Documentation** (Transparence, sÃ©curitÃ©, utilisateur)  

---
## ğŸš€ PRÃŠT POUR DEMAIN !

**Le planning est maintenant 100% dÃ©taillÃ© avec :**
- âœ… Sous-tÃ¢ches prÃ©cises et actionnables
- âœ… Temps rÃ©alistes et vÃ©rifiÃ©s
- âœ… Architecture internationale complÃ¨te
- âœ… ZÃ©ro surprises - tout est spÃ©cifiÃ©

**Tu peux dÃ©marrer sereinement demain matin !** ğŸŒŸ

## ğŸ—ï¸ IMPACTS ARCHITECTURAUX CRITIQUES

### 1. **Backend Commun Multi-RÃ©gions**
```typescript
// Architecture cible
src/lib/backend/
â”œâ”€â”€ geo-detection.ts      (Cloudflare + IPinfo)
â”œâ”€â”€ pricing-service.ts    (Price lists par rÃ©gion)
â”œâ”€â”€ rate-limiter.ts       (10 req/min par IP)
â””â”€â”€ gdpr/
    â”œâ”€â”€ consent-logger.ts (IP hash SHA-256)
    â””â”€â”€ data-export.ts    (Export utilisateur)
```

### 2. **Frontends SÃ©parÃ©s + i18n**
```
src/
â”œâ”€â”€ i18n/
â”‚   â”œâ”€â”€ locales/ (en/fr/de/hi)
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ components/shared/ (multi-langues)
â””â”€â”€ products/ (date-polls/forms/quizz)
```

### 3. **Base de DonnÃ©es Multi-RÃ©gions**
- `regions` (EU, US, CA...)
- `price_lists` (tarifs par rÃ©gion)
- `geo_detection_logs` (RGPD)
- Extensions `users` (detected_country, preferences)

### 4. **SÃ©curitÃ© & RGPD**
**Architecture sÃ©curisÃ©e :**
```typescript
src/lib/security/
â”œâ”€â”€ gdpr/
â”‚   â”œâ”€â”€ consent-logger.ts (logs horodatÃ©s)
â”‚   â”œâ”€â”€ data-export.ts (export utilisateur)
â”‚   â”œâ”€â”€ data-deletion.ts (suppression complÃ¨te)
â”‚   â””â”€â”€ ip-hash.ts (SHA-256, jamais en clair)
â””â”€â”€ privacy/
    â”œâ”€â”€ anonymization.ts
    â””â”€â”€ retention-policy.ts
```

### 5. **Timezone Management**
**Support multi-timezones :**
```typescript
// Backend commun doit supporter
- Choix timezone lors crÃ©ation
- Stocker "Europe/Paris" dans polls
- Afficher "Horaires en heure de Paris"
- Utiliser date-fns-tz pour conversion
```

---

## PRIORITÃ‰S CRITIQUES (Ã€ FAIRE IMMÃ‰DIATEMENT)

### URGENT - StabilitÃ© Production (Semaine 1)

#### 1. Bug Critique - SystÃ¨me Quota IncohÃ©rent (4-6h)
**ProblÃ¨me :** Dashboard et Edge Function utilisent des sources diffÃ©rentes
- Dashboard calcule depuis conversations/messages 
- Edge Function lit depuis `user_quotas.credits_remaining`
- Impact : Affichage incohÃ©rent (96/1020 vs 0 crÃ©dits)

**Actions :**
- [ ] Unifier le systÃ¨me : faire lire Dashboard depuis `user_quotas`
- [ ] Synchroniser les deux systÃ¨mes
- [ ] Tests E2E cohÃ©rence quotas
- [ ] Documenter flux consommation

#### 2. Tests E2E Restants (2-3h)
**ProblÃ¨me :** Tests Ã©chouent bloquant la CI
- [ ] `end-to-end-with-backend.spec.ts` - ProblÃ¨me navigation dashboard â†’ chat
- [ ] `ultra-simple-form.spec.ts` - RÃ©activer et analyser diagnostic h1

#### 3. Bugs UX Bloquants (2h)
- [ ] Discussions dupliquÃ©es (5x mÃªme sondage aprÃ¨s refresh)
- [ ] Message quota incorrect ("CrÃ©dits Ã©puisÃ©s" vs "Limite 20 polls")

---

### HAUTE - Gemini Debug Plan (Semaine 1-2) âœ… En cours
- [x] RÃ©solution des conflits de types entre les diffÃ©rentes implÃ©mentations de `PollSuggestion`
- [x] CrÃ©ation d'une source unique de vÃ©ritÃ© pour les types de sondages
- [ ] AmÃ©lioration de la gestion des erreurs de validation des donnÃ©es Gemini

#### Phase 1 : Tests Manquants (8h)
**Objectif :** RÃ©implÃ©menter architecture debug Gemini manquante

**LUNDI - Tests (3h) :**
- [ ] CrÃ©er `test-gemini-comprehensive.js` (3h)
  - Tests complets tous cas edge
  - Couverture simple + complex prompts  
  - Validation hints conditionnels

**MARDI - Debug Isolation (2h) :**
- [ ] CrÃ©er `debug-isolation.js` (2h)
  - Debug rule-by-rule
  - Isolation problÃ¨mes spÃ©cifiques
  - Mode verbose dÃ©taillÃ©

**MERCREDI - Comparaison (3h) :**
- [ ] CrÃ©er `system-comparison.js` (3h)
  - Comparaison ancien vs nouveau systÃ¨me
  - Benchmarks performance
  - RÃ©gressions detection

#### Phase 2 : Architecture Modulaire (12h)
**JEUDI-VENDREDI :**
- [x] âœ… **Scission gemini.ts** dÃ©placÃ©e vers Vendredi (2h) â†’ **Voir @[Analyse - SÃ©paration Services par Produit.md]**
- [x] âœ… **Scission pollStorage.ts** dÃ©placÃ©e vers Vendredi (30 min) â†’ **Voir @[Analyse - SÃ©paration Services par Produit.md]**
- [ ] Scinder `gemini.ts` en modules (6h) â†’ **REPORTÃ‰ Vendredi (1h30)**
  ```
  src/lib/ai/gemini/
  â”œâ”€â”€ gemini-service.ts          (orchestration)
  â”œâ”€â”€ prompts/
  â”‚   â”œâ”€â”€ simple-prompts.ts      (sans hints)
  â”‚   â”œâ”€â”€ complex-prompts.ts     (avec hints)
  â”‚   â””â”€â”€ prompt-builder.ts      (logique choix)
  â””â”€â”€ hints/
      â”œâ”€â”€ hints-service.ts       (gÃ©nÃ©ration)
      â””â”€â”€ hints-validator.ts     (validation)
  ```
- [ ] ImplÃ©menter `isComplexCase()` (2h) â†’ **REPORTÃ‰ Vendredi (15 min)**
- [ ] Logique conditionnelle hints (2h) â†’ **REPORTÃ‰ Vendredi (10 min)**
- [ ] Tests unitaires modules (2h) â†’ **REPORTÃ‰ Vendredi (5 min)**

---

## PRIORITÃ‰S MOYENNES (Semaine 2-3)

#### 2. **Refactors CiblÃ©s Ã  BÃ©nÃ©fice Rapide (4h)**

**Objectif :** RÃ©duire le code monolithique sans risque massif

**1. PollCreator.tsx - Hook d'Ã‰tat (1h)**
- Extraire `usePollCreatorState` (500 lignes)
- RÃ©duire PollCreator : 1650 â†’ 1150 lignes
- BÃ©nÃ©fice : Debug 10x plus facile

**2. gemini.ts - Modules Simples (1h)** â†’ **âœ… pollStorage.ts SCINDÃ‰ AVEC SUCCÃˆS**
- âœ… Scinder pollStorage.ts en 3 services (date-polls/form-polls/quizz)
- âœ… RÃ©duire : 1343 â†’ 3x400 lignes (moyenne)
- âœ… BÃ©nÃ©fice : Navigation instantanÃ©e, tests isolÃ©s
- â­ï¸ **Reste Ã  faire :** Scinder `gemini.ts` en modules (service/prompts/utils)
  - RÃ©duire : 2072 â†’ 3x700 lignes
  - BÃ©nÃ©fice : Navigation instantanÃ©e

**3. useConversationSearch.ts - Service (1h)**
- Extraire debouncing + regex dans service
- RÃ©duire complexitÃ© hook
- BÃ©nÃ©fice : Testable unitairement

**4. Finalisation Mini-Refactors (1h)**
- Nettoyage restant
- Documentation refactors
- PrÃ©paration bÃªta

**StratÃ©gie :**
- 1 refactor par session 1h
- Tests immÃ©diats aprÃ¨s chaque refactor
- Branch Git isolÃ©e par refactor
- Rollback facile si problÃ¨me

### MOYENNE - Restoration Tests Gemini (7h)

**Objectif :** RecrÃ©er les 58 tests manquants

**Analyse templates (1h) :**
- [ ] Identifier patterns rÃ©utilisables
- [ ] Extraire cas commentÃ©s dans gemini-professional.test.ts

**CrÃ©ation fichiers tests (6h) :**
- [ ] `gemini-date-polls.test.ts` (2h) - 48 tests dates
- [ ] `gemini-form-polls.test.ts` (1.5h) - 10 tests formulaires  
- [ ] `gemini-comprehensive.test.ts` (2h) - 57+ tests combinÃ©s
- [ ] `vitest.config.gemini.ts` (0.5h)
- [ ] Mettre Ã  jour guide tests (0.5h)

**RÃ©sultat :** 9% â†’ 92% couverture Gemini (5 â†’ 58 tests)

### MOYENNE - Bugs UX Restants (4h)

**Weekend Grouping :**
- [ ] Calendar ne montre pas dates groupÃ©es visuellement
- [ ] SÃ©lection manuelle dates impossible sur sondage

**Navigation & Chat :**
- [ ] Chat vide + sondage quand arrive via /poll
- [ ] Discussions passÃ©es non visibles depuis dashboard
- [ ] **Documentation - AmÃ©lioration Screenshots (1h)** 
  - Page `03-Sondages-Dates.md` : Ajouter screenshot manquant
  - Corriger alignement tableau + "Horaires par Date" â†’ "Horaires par date"
  - Simplifier grandement la documentation

**Navigation calendrier vers le passÃ© :**
- [ ] BUG Navigation calendrier vers le passÃ© - PARTIELLEMENT CORRIGÃ‰
- ProblÃ¨me : Bouton "prev" ne montre pas mois prÃ©cÃ©dent (scroll nÃ©cessaire)
- Correction : useEffect + scrollLeft = 0 dans Calendar.tsx
- Restant : ExpÃ©rience visuelle diffÃ©rente entre prev/next
- Fichiers : Calendar.tsx, PollCreator.tsx, usePollCreatorState.ts
- Tests : Calendar-navigation.test.tsx crÃ©Ã©s

**Antigravity - Tests manuels requis :**
- [ ] En case de regroupement, cacher et interdire de dÃ©finir des horaires et griser le bouton
- [ ] Quand on reprend depuis le dashboard, on ne voit pas les discussions passÃ©es et on ne voit pas le sondage non plus
- [ ] "Sondage pour un week-end de ski en dÃ©cembre" crÃ©Ã© un formulaire (devrait Ãªtre dates)
- [ ] "fais-moi un sondage pour un dÃ©jeuner la semaine prochaine" â†’ une seule date (devrait Ãªtre plusieurs)
- [ ] Regroupement visuel des dates ne fonctionne pas sur mobile (fond bleu continu)

**Parsing Gemini :**
- [ ] "Sondage pour week-end ski dÃ©cembre" â†’ formulaire (devrait Ãªtre dates)
- [ ] "dÃ©jeuner semaine prochaine" â†’ une seule date (devrait Ãªtre plusieurs)

---

## PRIORITÃ‰S FAIBLES (Semaine 3-4)

### FAIBLE - Features ReportÃ©es (POST-BÃŠTA)

**NE PAS implÃ©menter maintenant :**
- âŒ Templates prÃ©dÃ©finis (l'IA suffit)
- âŒ Multi-step flow Typeform-style  
- âŒ ThÃ¨mes visuels premium
- âŒ Simulation IA rÃ©ponses
- âŒ Google Sheets export
- âŒ Calendar integration
- âŒ PWA / Mobile native
- âŒ Analytics avancÃ©s
- âŒ SSO Enterprise

### ğŸŸµ FAIBLE - Architecture Perdue (INVESTIGATION)

**Refactors marquÃ©s terminÃ©s mais perdus :**
- PollCreator.tsx : 1650 lignes (pas 240)
- AICreationWorkspace.tsx : 1112 lignes (pas 259)  
- gemini.ts : 2072 lignes (pas 1296)
- pollStorage.ts : 1343 lignes (pas 4)

**Actions :**
- [ ] RÃ©cupÃ©rer depuis Google Drive Backup
- [ ] Investiguer pourquoi refactors non conservÃ©s
- [ ] Documenter pertes pour Ã©viter rÃ©gressions

---

