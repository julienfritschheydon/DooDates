# ğŸš€ DOODATES - PLANNING BÃŠTA DÃ‰TAILLÃ‰
***

## NOUVELLES IDEES
  ### HIGH
    - Revenir Ã  CrewAI, oui et pourquoi ? Test surtout.
  ### MEDIUM
    - Suivre les release de Google Form Enteprise pour nous et faire pareil voir mieux pour les gens n'ayant pas accÃ¨s 
  ### LOW
  - Comparer : Asana
  - Ã‰tudier commetaire calendly et le prix

## ğŸ“‹ OBJECTIF STRATÃ‰GIQUE

**ğŸ¯ Deadline BÃªta :** Fin dÃ©cembre 2025  
**ğŸ‘¥ Objectif :** Lancer une bÃªta fonctionnelle avec 10-20 utilisateurs testeurs  
**â±ï¸ Rythme :** **3h par jour** (2h critiques + 1h travail de fond)  
**ğŸŒ Vision :** Architecture internationale "privacy-by-design" et "security-by-design"

---

## PLAN D'EXÃ‰CUTION - 3H/JOUR (2H + 1H TRAVAIL DE FOND)

### ğŸ“Œ SEMAINE 1

### ğŸ“Œ LUNDI 2 DÃ‰CEMBRE - JOUR 1
  - âœ… **AJOUT :** DÃ©tection gÃ©ographique (Cloudflare + IPinfo) - TERMINÃ‰
    - [x] Choisir API (IPinfo vs Cloudflare Geo)
    - [x] CrÃ©er service `geo-detection.ts`
    - [x] IntÃ©grer middleware Express
    - [?? ] Tests E2E localisation (VPN test)
  - âœ… **AJOUT :** Pricing multi-rÃ©gions (price lists) - TERMINÃ‰
    - [x] CrÃ©er tables `regions` + `price_lists`
    - [x] Service `pricing-service.ts`
    - [x] IntÃ©grer dÃ©tection auto-rÃ©gion
    - [x] Tests conversion devises
  - âœ… **AJOUT :** Tests dÃ©tection gÃ©ographique
    - [x] Test dÃ©tection pays via IP
    - [x] Test VPN detection (optionnel)
    - [x] Test fallback rÃ©gion par dÃ©faut
    - [x] Test pricing par rÃ©gion automatique
  - [x]**Tester les changements sur les formulaires**

### ğŸ“Œ MARDI 3 DÃ‰CEMBRE - JOUR 2

  - âœ… **INTÃ‰GRATION GOOGLE SIGN-IN** - TERMINÃ‰
    - [x] Boutons Google dans SignInForm et SignUpForm
    - [x] Gestion des Ã©tats de chargement et erreurs
    - [x] Connexion via OAuth avec Supabase
    - [x] Tests de compilation et build rÃ©ussis    
  - âœ… **RÃ‰SOLUTION DES CONFLITS DE TYPES GEMINI** - TERMINÃ‰
    - [x] CrÃ©ation d'un fichier `poll-suggestions.ts` centralisÃ©
    - [x] Unification des types `PollSuggestion`, `FormPollSuggestion` et `DatePollSuggestion`
    - [x] Correction des imports dans `GeminiChatInterface.tsx` et `ConversationService.ts`
    - [x] Gestion du type `"date"` dans `QuestionType`
    - [x] RÃ©solution des conflits de types avec `dateGroups`
    - [x] Correction de `setLastAIProposalAdapter`
  - âœ… BUG - Alignement des jours et des horaires (select lots of days to show it) (15 min)
  - âœ… **â° Bloc 2 : SÃ©curitÃ© & RGPD (TERMINÃ‰) âœ…** ğŸ”’
  - âœ… **IMPLÃ‰MENTÃ‰ :** SÃ©curitÃ© quotas & rate limiting
      - [x] Service `rate-limiter.ts` (10 req/min) - 30 min
        - Gestion des fenÃªtres de temps
        - Blocage aprÃ¨s dÃ©passement
        - Tests unitaires complets
      - [x] Middleware protection quotas - 20 min
        - IntÃ©gration avec l'API
        - Gestion des erreurs
  - âœ… **IMPLÃ‰MENTÃ‰ :** Logs RGPD (consentement, IP hash)
      - [x] Service `consent-logger.ts` - 15 min
        - Journalisation des consentements
        - Export des donnÃ©es utilisateur
        - Suppression des donnÃ©es
      - [x] IP hash SHA-256 (jamais en clair) - 10 min
        - Hachage sÃ©curisÃ©
        - Anonymisation des adresses IP
        - Gestion des erreurs
  - âœ… **â° Bloc 3 : Architecture Backend (1h)** ğŸ—ï¸
    - [x] **SÃ©parer services par produit**
        - [x] Identifier API partagÃ©e (auth, quotas, conversations)
        - [x] Documentation architecture backend â†’ **Voir @[Analyse - SÃ©paration Services par Produit.md]**
        - [x] CrÃ©er structure dossiers backend commune - 15 min
        - [x] **Scission structure progressive** - 25 min
          - [x] CrÃ©er dossiers products/shared/ai (5 min)
          - [x] DÃ©placer gemini.ts dans ai/ (5 min)
          - [x] CrÃ©er wrappers pollStorage (10 min)
          - [x] Mettre Ã  jour imports critiques (5 min)
    - âœ… **Scission pollStorage.ts** â†’ **COMPLÃ‰TÃ‰ AVEC SUCCÃˆS**
      - âœ… SÃ©parer date-polls/form-polls/quizz services
      - âœ… Maintenir interface unifiÃ©e via index.ts
      - âœ… Tests validation rapides (E2E: 11/11 passÃ©s)
      - âœ… **RÃ‰SULTAT :** 1343 lignes â†’ 3 services spÃ©cialisÃ©s (1204 lignes total)
  - âœ… **AMÃ‰LIORATION DOCUMENTATION MOBILE**
    - [x] Menu hamburger pour navigation mobile
    - [x] Backdrop pour fermeture au clic
    - [x] Animation fluide d'ouverture/fermeture
    - [x] Correction du padding et de la mise en page
  - âœ… **REFACTORISATION TYPES GEMINI**
    - [x] DÃ©placer les types `PollSuggestion` vers `poll-suggestions.ts`
    - [x] Mettre Ã  jour les imports dans `useGeminiAPI.ts`
    - [x] Ajouter le typage correct pour la rÃ©ponse de l'API
  - âœ… **TESTS BACKEND CRITIQUES** âœ… **DÃ‰JÃ€ IMPLÃ‰MENTÃ‰S** â­
    - âœ… ğŸ”’ **SÃ©curitÃ© Quotas & Rate Limiting**
      - âœ… **Tests unitaires** : `rate-limiter.test.ts` (180 lignes)
      - âœ… **Service** : `rate-limiter.ts` (247 lignes)
      - âœ… **Middleware** : `middleware.ts` (244 lignes)
      - âœ… **Tests E2E** : `security-rate-limiting-rgpd.spec.ts` (lignes 21-147)
        - Rate limiting (10 req/min par IP)
      - Injection quotas manuels
      - Contournement guest limits
      - Protection DDoS basique
    - âœ… ğŸ“œ **ConformitÃ© RGPD**
      - âœ… **IP Hashing** : `ip-hash.test.ts` (266 lignes)
      - âœ… **Consentement** : `consent-logger.test.ts` (258 lignes)
      - âœ… **Tests E2E** : `security-rate-limiting-rgpd.spec.ts` (lignes 150-254)
        - BanniÃ¨re consentement
        - Protection donnÃ©es personnelles
        - Droit Ã  l'oubli
    - âœ… ğŸ”„ **API PartagÃ©es**
      - âœ… **Tests d'intÃ©gration** : `api-security-performance.spec.ts` (319 lignes)
        - Authentification (Supabase)
        - Gestion des quotas (RPC)
        - CRUD conversations
        - Performance (<2s lecture, <1s crÃ©ation)
        - SÃ©curitÃ© RLS (Row Level Security)
    - âœ… ğŸ“Š **Couverture des Tests**
      - âœ… Tests unitaires complets
      - âœ… Tests d'intÃ©gration critiques
      - âœ… Tests E2E sÃ©curitÃ©
      - âœ… VÃ©rification RLS et permissions
  - âœ… Tests E2E sÃ©curitÃ© (rate limiting, RGPD) - **9/9 passÃ©s**
  - âœ… Tests API partagÃ©es (auth, quotas, conversations) - **DÃ©jÃ  implÃ©mentÃ©s**
  - âœ… Documentation types partagÃ©s services
  - âœ… Structure frontend multi-produits - **100% TERMINÃ‰E** - **100% TERMINÃ‰E**

  - [x] ğŸ” Tests Unitaires Manquants
    **1. Date Polls Service**
    - [x] Tests de validation des crÃ©neaux horaires
    - [x] Gestion des fuseaux horaires
    - [x] Tests de performance avec un grand nombre de dates

    **2. Form Polls Service**
    - [x] Tests de performance avec de nombreux rÃ©pondants
    - [x] Gestion des rÃ©ponses partielles

  - [ ] ğŸ”— Tests d'IntÃ©gration
    **Structure Frontend Multi-Produits**
    - [x] Validation des wrappers de rÃ©trocompatibilitÃ©
    - [x] Validation des types de questions personnalisÃ©es
    - [x] CrÃ©er structure dossiers frontend par produit
    - [x] Tests edge cases (localStorage, conflits)
    - [x] Tests de charge avec l'interface unifiÃ©e
    - [x] Mettre en place routage par produit

### ğŸ“Œ MERCREDI 4 DÃ‰CEMBRE - JOUR 3

  - [x] **Structure Frontend Multi-Produits**
    - [x] Landing pages sÃ©parÃ©es par types
    - [x] Optimisation des imports/bundles
    - [x] Documentation utilisateur finale

### ğŸ“Œ JEUDI 5 DÃ‰CEMBRE - JOUR 4

  - [x] **Tests de rÃ©gression post-scission** (2h) â­ **PRIORITÃ‰ APRÃˆS SCISSION**
    - [x] Mettre les pages de confirmations aux couleurs du reste de l'interface ![alt text](image.png)
    - [x] Finaliser les tests 
    - [x] VÃ©rifier que les imports fonctionnent correctement âœ…
    - [x] Valider les wrappers de rÃ©trocompatibilitÃ© âœ…

  - [x] **Refactor gemini.ts Modules** (2h) - **REFACTOR** â­ (TERMINÃ‰ LE 04/12)
    - [x] Scinder en 3 modules (service/prompts/utils)
    - [x] RÃ©duire 2072 â†’ ~1200 lignes (nettoyage code mort et extraction services)
    - [x] Extraction `DatePollService` et `FormPollService`
    - [x] Nettoyage imports et types inutilisÃ©s
    - [x] VÃ©rification type-check stricte (0 erreurs)

  - [x] **CONSOLIDATION TYPES POLLSUGGESTION** (04/12/2024) âœ…
    - [x] RÃ©-export des types depuis `FormPollService.ts` et `DatePollService.ts`
    - [x] Mise Ã  jour `src/types/poll-suggestions.ts` (source unique)
    - [x] Mise Ã  jour `src/lib/gemini.d.ts` (rÃ©-export depuis services)
    - [x] Ajout `"availability"` dans `pollType` pour `ChatInput.tsx`, `ChatMessageList.tsx`, `poll.d.ts`
    - [x] Tests E2E `strict-poll-type-enforcement.spec.ts` : 2/2 passent
    - [x] Compilation TypeScript : 0 erreurs
    
  - [x] **Base de donnÃ©es**
      - âœ… Tables `quota_tracking` et `guest_quotas` : 4 compteurs sÃ©parÃ©s ajoutÃ©s (`date_polls_created`, `form_polls_created`, `quizz_created`, `availability_polls_created`)
      - âœ… Fonction SQL `consume_quota_credits` : Validation stricte par type, limites sÃ©parÃ©es
      - âœ… Trigger SQL : Maintien automatique de `polls_created` = somme des 4 compteurs (pour affichage uniquement)
      - âœ… Script de migration : `migrate-quota-separation.sql` crÃ©Ã©
      - âœ… VÃ©rifications globales supprimÃ©es dans SQL

  - [x] **Code TypeScript**
      - âœ… Interfaces mises Ã  jour : `QuotaConsumedData`, `CreditJournalEntry` (4 types)
      - âœ… `incrementPollCreated` : `pollType` obligatoire avec validation stricte
      - âœ… `pollStorage.ts` : Validation et transmission de `poll.type`
      - âœ… `guestQuotaService.ts` : Gestion compteurs sÃ©parÃ©s, vÃ©rification globale supprimÃ©e, validation stricte
      - âœ… `quotaTracking.ts` : Fallback localStorage adaptÃ© avec migration automatique
      - âœ… Edge Function : RÃ©ponses API incluent les 4 compteurs sÃ©parÃ©s

  - [x] **Hooks et UI**
      - âœ… `useFreemiumQuota` : AdaptÃ© pour compteurs sÃ©parÃ©s
      - âœ… `useQuota` : Interface mise Ã  jour
      - âœ… `QuotaIndicator` : Support des 4 types de polls
      - âœ… Constantes : `POLL_TYPE_QUOTAS` ajoutÃ© (valeurs temporaires)

  - [x] **Scripts et monitoring**
      - âœ… Scripts SQL de monitoring : Mis Ã  jour (`view-user-quotas.sql`, `monitor-guest-quotas.sql`, `create-monitoring-report-function-FIXED.sql`)
      - âœ… Scripts PowerShell/Bash : Mis Ã  jour (`view-quotas.ps1`, `view-quotas.sh`)
      - âœ… Migration localStorage : AdaptÃ©e (`migrate-localstorage-to-quota-tracking.ts`)

  - [x] **VÃ©rifications**
      - âœ… VÃ©rifications globales supprimÃ©es : Plus de limite globale `pollsCreated >= LIMIT`
      - âœ… Cache invalidation : `quotaCache.delete(userId)` aprÃ¨s consommation rÃ©ussie
      - âœ… Flux Dashboard â†’ Edge Function : VÃ©rifiÃ© et cohÃ©rent

  - [x] **Tests E2E - Adaptation pour nouveaux compteurs** âœ…
      - `tests/e2e/quota-tracking-complete.spec.ts`
      - `tests/e2e/guest-quota.spec.ts`
      - `Date poll creation increments datePollsCreated only`
      - `Form poll creation increments formPollsCreated only`
      - `Quizz creation increments quizzCreated only`
      - `Availability poll creation increments availabilityPollsCreated only`
      - `Multiple poll types increment correct counters separately`

  - [x] **Tests E2E - CohÃ©rence Dashboard â†” Edge Function** âœ…
      - `tests/e2e/quota-tracking-complete.spec.ts`
      - `Dashboard and Edge Function show same quota values after separation`

  - [x] **Tests de charge - Adaptation** âœ…
      - `tests/load/quota-tracking-load-test.js`
      - Action changÃ©e de `'other'` Ã  `'poll_created'`
      - Ajout de `pollType` dans les mÃ©tadonnÃ©es (rotation alÃ©atoire entre les 4 types)
      - Ajout de vÃ©rification que la rÃ©ponse inclut les compteurs sÃ©parÃ©s

  - [x] **Documentation** âœ…
    - [x] `Docs/ARCHITECTURE/2025-11-12-PHASE3-QUOTA-MIGRATION.md` - Mis Ã  jour avec colonnes sÃ©parÃ©es
    - [x] `Docs/ARCHITECTURE/2025-11-12-FINGERPRINT-QUOTAS.md` - Mis Ã  jour avec colonnes sÃ©parÃ©es
    - [x] `Docs/QUOTAS&PRICING/2025-11-06-CREDITS-CONSUMPTION-LIST.md` - Mis Ã  jour avec note sur sÃ©paration
    - [x] `Docs/ARCHITECTURE/2025-11-14-PHASE3-PRODUCTION-MONITORING.md` - Pas de rÃ©fÃ©rence aux quotas, pas de mise Ã  jour nÃ©cessaire
    - [x] `Docs/ARCHITECTURE/2025-12-04-QUOTA-SEPARATION-BY-PRODUCT.md` - Documentation complÃ¨te crÃ©Ã©e
    - [x] Architecture de la sÃ©paration des quotas par produit
    - [x] Flux unifiÃ© Dashboard â†’ Edge Function â†’ `quota_tracking`
    - [x] Les 4 types de polls et leurs limites sÃ©parÃ©es
    - [x] Migration des donnÃ©es existantes
    - [x] Plan EOL de `polls_created` (janvier 2025)
    - [x] Guide pour dÃ©veloppeurs : comment utiliser les nouveaux compteurs
    - [x] Exemples de code pour consommer des crÃ©dits par type de poll

  - [x] VÃ©rifier que tous les E2E passent encore (11/11)

  - [x] **ImplÃ©mentation Favoris & Dashboard**
    - [x] Migration DB : Ajouter champ `is_favorite` ou table `favorites`
    - [x] API : Endpoints toggle favorite
    - [x] UI : Bouton Ã©toile sur les cartes de sondage
    - [x] Dashboard : Filtre "Favoris"

  - [x] **ğŸ”¥ URGENT - Discussions DupliquÃ©es** (1-2h) - 5x mÃªme sondage aprÃ¨s refresh
      - Impact : UX cassÃ©e, confusion utilisateur
      - Risque : Perte de confiance utilisateur

  - [x] **âš ï¸ HAUTE - Tests E2E Ã‰chouent** (2-3h) - `end-to-end-with-backend.spec.ts` (10 test.skip)
      - Impact : Bloque la CI/CD
      - Risque : RÃ©gressions non dÃ©tectÃ©es

### ğŸ“Œ VENDREDI 6 DÃ‰CEMBRE - JOUR 5

  - [x] **Tests Gemini - SIMPLIFICATION MODE DIRECT** âœ… **TERMINÃ‰**
      
  **Objectif :** Restaurer la qualitÃ© Gemini aprÃ¨s refactoring
  
  **Analyse effectuÃ©e :**
  - [x] Benchmark complet Mode Direct vs Mode Normal (10 tests)
  - [x] Comparaison prÃ©cision, vitesse, taux de succÃ¨s
  
  **RÃ©sultats Benchmark :**
  | MÃ©trique | Mode Direct | Mode Normal |
  |----------|-------------|-------------|
  | PrÃ©cision moyenne | 97.5% | 98.8% |
  | Vitesse moyenne | 1662ms | 2693ms |
  | Taux de succÃ¨s | 100% | 100% |
  | Victoires | 7/10 | 3/10 |
  
  **DÃ©cision :** Mode Direct activÃ© par dÃ©faut
  - âš¡ 38% plus rapide
  - ğŸ§¹ ~200 lignes de code archivÃ©es (temporalParser, contextualHints)
  - ğŸ¯ L'utilisateur peut affiner via l'UX si besoin
  
  **Modifications code :**
  - [x] `gemini.ts` : Pipeline complexe commentÃ©, prompt direct utilisÃ©
  - [x] `pollPrompts.ts` : buildDirectPrompt() toujours utilisÃ© pour Date Polls
  - [x] Parsing robuste conservÃ© (fallback timeSlots â†’ dates)

  **Ajustements tests :**
  - [x] `brunch-samedi-dimanche` : Prompt corrigÃ© (sans dates 23/24)
  - [x] `reunion-parents-profs` : expectTimeSlots: false (pas d'heure mentionnÃ©e)
  - [x] `aide-devoirs-mercredi-vendredi` : expectTimeSlots: false
  - [x] `call-visio-parents` : Ajout "en soirÃ©e" pour dÃ©clencher timeSlots
  - [x] `bug-brunch-samedi-ou-dimanche` : SupprimÃ© (doublon)
  
  **Tests finaux :** 59 tests, tous passent (aprÃ¨s ajustements)

  - [x] **PROBLEME - dashboard-complete.spec.ts en mode 'serial'** - RÃ‰SOLU
      - **FICHIER** : `tests/e2e/dashboard-complete.spec.ts`

### ğŸ“Œ SAMEDI 6 DÃ‰CEMBRE - JOUR 6

  - [x] **âœ… Prototype Aide aux Devoirs (Quizz) - TERMINÃ‰** ğŸ¯
    
    **Specs :** `Docs/SPECS/Aide-aux-Devoirs-Quizz.md`
    
    **âœ… Phase 1 : Backend & Service (FAIT)**
    - [x] `quizz-service.ts` (476 lignes) - CRUD + scoring
    - [x] `QuizzVisionService.ts` (312 lignes) - Gemini Vision + texte
    - [x] Stockage sÃ©parÃ© `doodates_quizz` (localStorage)
    - [x] Types complets : `QuizzQuestion`, `QuizzResponse`, `QuizzResults`
    
    **âœ… Phase 2 : Frontend (FAIT)**
    - [x] `QuizzApp.tsx` - Routeur simplifiÃ©
    - [x] `QuizzCreate.tsx` (411 lignes) - CrÃ©ation texte + image
    - [x] `QuizzList.tsx` (140 lignes) - Liste des quiz
    - [x] `QuizzVote.tsx` (721 lignes) - Vote multi-step avec feedback
    - [x] Routes : `/quizz/*`, `/quizz/:slug/vote`
    - [x] Lien depuis `MainLanding.tsx` (4Ã¨me carte)
    
    **âœ… Phase 3 : UX (FAIT)**
    - [x] Confettis ğŸ‰ sur score > 75%
    - [x] Bouton "Partager ce quiz" (copier lien)
    - [x] DictÃ©e vocale ğŸ¤ sur rÃ©ponses texte
    - [x] Couleurs unifiÃ©es (thÃ¨me violet)
    - [x] Bug fix : texte invisible sur choix unique/multiples
    - [x] Type `text-ai` : validation Gemini pour rÃ©ponses longues
    
    **ğŸ“Š MÃ©triques :**
    - ~800 nouvelles lignes de code
    - 13 fonctionnalitÃ©s implÃ©mentÃ©es
    - RÃ©utilisation : hooks existants (useVoiceRecognition), services Gemini

  - [x] **ğŸ§ª Tester le proto Quizz complet** (prioritÃ©)
    - [x] CrÃ©ation quiz via image (photo de devoir)
    - [x] CrÃ©ation quiz via texte
    - [x] Vote + score + confettis
    - [X] Partage lien

  - [x] ~~**Architecture isComplexCase()**~~ â†’ **ANNULÃ‰** (06/12)
    - DÃ©cision : Mode Direct activÃ© par dÃ©faut, pas de logique conditionnelle
    - Benchmark : 97.5% prÃ©cision suffisante, 38% plus rapide
    - L'UX permet modifications â†’ pas de sur-ingÃ©nierie nÃ©cessaire

## ğŸ“… SEMAINE 2 - 9-13 DÃ‰CEMBRE 2024

### ğŸ“Œ LUNDI 9 DÃ‰CEMBRE - JOUR 6

  - [ ] **REFACTOR - Factorisation Layouts Produits** (2h) âš ï¸ **ATTENTION : NE PAS CASSER**
    
    **Contexte :**
    - 4 layouts identiques (DatePollsLayout, FormPollsLayout, AvailabilityPollsLayout, QuizzLayout)
    - 312 lignes de code dupliquÃ© (4 Ã— 78 lignes)
    - Maintenance difficile (modifier 4 fichiers pour 1 changement)
    
    **âš ï¸ CONTRAINTE CRITIQUE :**
    - **Date Polls & Form Polls** : Utilisent `AICreator` avec agent IA Ã  gauche + Ã©diteur Ã  droite
    - **Availability & Quizz** : N'utilisent PAS l'agent IA, juste le sidebar + contenu
    - **NE PAS CASSER** les diffÃ©rences d'expÃ©rience entre produits
    
    **Architecture actuelle (App.tsx) :**
    ```tsx
    // Date Polls & Form Polls - AVEC agent IA
    <DatePollsLayout>
      <AICreator hideSidebar />  // Agent IA + Ã©diteur
    </DatePollsLayout>
    
    // Availability & Quizz - SANS agent IA
    <AvailabilityPollsLayout>
      <AvailabilityPollsDashboard />  // Juste le contenu
    </AvailabilityPollsLayout>
    ```
    
    **Plan de factorisation SAFE :**
    
    1. **CrÃ©er GenericProductLayout.tsx** (1h)
       - Layout gÃ©nÃ©rique avec sidebar + overlay + responsive
       - Props : `productType` + `children`
       - Logique sidebar identique pour tous
       - **NE TOUCHE PAS** au contenu (children)
    
    2. **Simplifier les 4 layouts** (30min)
       ```tsx
       export const DatePollsLayout = ({ children }) => (
         <GenericProductLayout productType="date">{children}</GenericProductLayout>
       );
       ```
    
    3. **CrÃ©er useSidebarState.ts** (20min)
       - Extraire logique `isSidebarOpen`, `toggleSidebar`, `closeSidebar`
       - RÃ©utilisable dans GenericProductLayout
    
    4. **Tests de validation** (10min)
       - âœ… Date Polls : Agent IA visible + Ã©diteur Ã  droite
       - âœ… Form Polls : Agent IA visible + Ã©diteur Ã  droite
       - âœ… Availability : Pas d'agent IA, juste dashboard
       - âœ… Quizz : Pas d'agent IA, juste dashboard
       - âœ… Sidebar fonctionne sur tous les produits
       - âœ… Mobile : Overlay + fermeture au clic
    
    **Fichiers Ã  crÃ©er :**
    - `src/components/layout/products/GenericProductLayout.tsx`
    - `src/hooks/useSidebarState.ts`
    
    **Fichiers Ã  modifier :**
    - `src/components/layout/products/DatePollsLayout.tsx` (78 â†’ 5 lignes)
    - `src/components/layout/products/FormPollsLayout.tsx` (78 â†’ 5 lignes)
    - `src/components/layout/products/AvailabilityPollsLayout.tsx` (79 â†’ 5 lignes)
    - `src/components/layout/products/QuizzLayout.tsx` (78 â†’ 5 lignes)
    
    **Gain :**
    - 312 lignes â†’ ~120 lignes (62% rÃ©duction)
    - 1 fichier Ã  maintenir au lieu de 4
    - Aucun impact sur l'expÃ©rience utilisateur
    
    **Risques identifiÃ©s :**
    - âŒ Casser l'agent IA sur Date/Form Polls
    - âŒ Afficher l'agent IA sur Availability/Quizz par erreur
    - âœ… **Mitigation** : Les layouts ne touchent QUE au sidebar, pas au contenu
    
    **Validation finale :**
    - [ ] Naviguer sur `/date-polls/workspace/date` â†’ Agent IA visible
    - [ ] Naviguer sur `/form-polls/workspace/form` â†’ Agent IA visible
    - [ ] Naviguer sur `/availability-polls/dashboard` â†’ Pas d'agent IA
    - [ ] Naviguer sur `/quizz/dashboard` â†’ Pas d'agent IA
    - [ ] Tester mobile : Sidebar + overlay sur tous les produits

  - [ ] Les menus de gauches doivents se fermer automatiquements et Ãªtre facile Ã  ouvrirs

  - [ ] **Navigation calendrier vers le passÃ© :** (reportÃ©)
    - [ ] BUG Navigation calendrier vers le passÃ© - PARTIELLEMENT CORRIGÃ‰
    - [ ] ProblÃ¨me : Bouton "prev" ne montre pas mois prÃ©cÃ©dent (scroll nÃ©cessaire)
    - [ ] Correction : useEffect + scrollLeft = 0 dans Calendar.tsx
    - [ ] Restant : ExpÃ©rience visuelle diffÃ©rente entre prev/next
    - [ ] Fichiers : Calendar.tsx, PollCreator.tsx, usePollCreatorState.ts
    - [ ] Tests : Calendar-navigation.test.tsx crÃ©Ã©s

  - [ ] **Navigation & Chat :** (reportÃ©)
    - [ ] Discussions passÃ©es non visibles depuis dashboard
    - [ ] Bug  Nouveau sondage - on reste sur l'ancien , idem pour les autres ?

  - [ ] **Documentation - AmÃ©lioration Screenshots (1h)** 
    - [ ] Page `03-Sondages-Dates.md` : Ajouter screenshot manquant
    - [ ] Corriger alignement tableau + "Horaires par Date" â†’ "Horaires par date"
    - [ ] Simplifier grandement la documentation

  - [ ] Est-ce que Fix Test 5: Fusion localStorage + Supabase de end-to-end-with-backend.spec.ts marche ?

ğŸ”¹ **DÃ‰PLOIEMENT EN PRODUCTION**
  - [ ] DÃ©ploiement progressif
  - [ ] Monitoring des erreurs
  - [ ] Support utilisateur


- [ ] **ğŸ“Š MOYENNE - Bug Quota IncohÃ©rent** (4-6h) - Dashboard vs Edge Function
      - Impact : Affichage incorrect mais fonctionnel
      - Risque : Confusion mais pas bloquant

  - [ ] âŒ **BUG GOOGLE AUTH - NON RÃ‰SOLU**
    - [x] Modification `AuthContext.tsx` ligne 275 : `redirectTo: ${window.location.origin}/DooDates/auth/callback`
    - [x] Configuration Supabase : URLs de redirection ajoutÃ©es
    - **PROBLÃˆME PERSISTANT** : URL finale contient `/DooDates/DooDates/dashboard` (duplication)
        - **CAUSE** : Conflit entre `vite.config.ts` (`base: "/DooDates/"`) et `BrowserRouter` (`basename="/DooDates"`)
        - **Ã€ INVESTIGUER** : Trouver la source de la duplication du path
        
  - [x] **Refaire les landing pages sÃ©rieusement avec Gemini et le prompt X**
        Design a dark-themed AI SaaS landing page with hero, features, testimonials, pricing, and footer. Clean layout. Neon accents.
        @websitePrompt.jpg

  - [ ] **Faire comparer les 4 expÃ©riences avec l'ancienne et noter toutes les diffÃ©rences: naviguer partout, et essayer l'expÃ©rience totale**

  - [ ] **Tester Ã  la main aussi les 4 produits (date/form/availability/quiz)**
        - [ ] favories Ã  tester
          - [ ] Verification
            - [ ] Verify database changes
            - [ ] Verify API endpoints
            - [ ] Verify UI interactions
          - [ ] 

**Fingerprinting Phase 3 - Tests Dashboard Admin**
  - [ ] AccÃ¨s `/admin/quotas` avec compte admin
  - [ ] VÃ©rifier affichage quotas guests, filtres, statistiques
  - [ ] Tester rafraÃ®chissement automatique et recherche
  - [ ] CrÃ©er conversations/polls en mode guest
  - [ ] Se connecter et vÃ©rifier migration fingerprint â†’ compte
  - [ ] VÃ©rifier prÃ©servation compteurs et idempotence



### ğŸ“Œ MARDI 10 DÃ‰CEMBRE - JOUR 7

ğŸ”¹ **Extraction Composants Communs** (2h) â­

- [ ] **AJOUT :** TopNav avec sÃ©lecteur langue
  - [ ] Ajouter dropdown langues (ğŸ‡«ğŸ‡· ğŸ‡¬ğŸ‡§ ğŸ‡©ğŸ‡ª ğŸ‡®ğŸ‡³)
  - [ ] Hook `useLanguage()` avec persistence localStorage
  - [ ] Tests changement langue dynamique
  - [ ] Mise Ã  jour traductions instantanÃ©es

- [ ] **AJOUT :** GeoBanner (conformitÃ© UE 2018/302)
  - [ ] Composant `GeoBanner.tsx` pour utilisateurs UE
  - [ ] Message conformitÃ© cookies/localisation
  - [ ] Condition affichage par dÃ©tection IP
  - [ ] Tests affichage banner UE vs non-UE

- [ ] **AJOUT :** Security headers & rate limiting UI
  - [ ] Indicateur visuel rate limiting atteint
  - [ ] Messages erreur sÃ©curitÃ© clairs
  - [ ] Tests UX limites quotas dÃ©passÃ©s

ğŸ”¹ **Bug Quota IncohÃ©rent**
  - [ ] Analyser flux Dashboard vs Edge Function
  - [ ] Unifier systÃ¨me de quotas
  - [ ] **AJOUT :** SÃ©curisation quotas (dÃ©jÃ  implÃ©mentÃ©)
  - [ ] **AJOUT :** Documentation sÃ©curitÃ© & monitoring
  - [ ] Tests E2E cohÃ©rence quotas
  - [ ] Documentation flux consommation

ğŸ”¹ **Test Refactoring - Validation Tests RÃ©activÃ©s** âœ…
  - [x] GeminiChatInterface (tests de types rÃ©solus)
  - [ ] unified-flow, useIntentDetection
  - [ ] AuthContext, OnboardingContext, useFreemiumQuota
  - [ ] ConversationSearch, ConversationList, ConversationCard
  - [ ] Diagnostic h1 page vote

### ğŸ“Œ MERCREDI 11 DÃ‰CEMBRE - JOUR 8

ğŸ”¹ **Tests E2E restants (2h) - **STABILITÃ‰** ğŸ›¡ï¸
- [ ] RÃ©parer `end-to-end-with-backend.spec.ts`
- [ ] RÃ©activer `ultra-simple-form.spec.ts`
- [ ] Diagnostic h1 page vote

ğŸ”¹ **Tests manuels corrections**
    - [ ] Tests manuels corrections UX
    - [ ] Validation UX post-publication
    - [ ] Tests parsing Gemini
      - [ ] "Sondage pour week-end ski dÃ©cembre" â†’ formulaire (devrait Ãªtre dates)
    - [ ] "dÃ©jeuner semaine prochaine" â†’ une seule date (devrait Ãªtre plusieurs)
    - [ ] En case de regroupement, cacher et interdire de dÃ©finir des horaires et griser le bouton
    - [ ] "Sondage pour un week-end de ski en dÃ©cembre" crÃ©Ã© un formulaire (devrait Ãªtre dates)
    - [ ] "fais-moi un sondage pour un dÃ©jeuner la semaine prochaine" â†’ une seule date (devrait Ãªtre plusieurs)
    - [ ] Regroupement visuel des dates ne fonctionne pas sur mobile (fond bleu continu)

### ğŸ“Œ JEUDI 12 DÃ‰CEMBRE - JOUR 9

  - [ ] DisponibilitÃ©s : exiger un compte utilisateur (sÃ©curitÃ© + traÃ§abilitÃ©)
  - [ ] Discussions dupliquÃ©es (5x mÃªme sondage)
  - [ ] Message quota incorrect
  - [ ] Tests manuels corrections

- [ ] **Documentation Screenshots**
  - [ ] Page `03-Sondages-Dates.md` : Ajouter screenshot manquant
  - [ ] Corriger alignement tableau + "Horaires par Date" â†’ "Horaires par date"
  - [ ] Simplifier grandement la documentation

ğŸ”¹ **Refactor PollCreator Hook** (2h) - **REFACTOR** â­
  - [ ] Extraire usePollCreatorState (500 lignes)
  - [ ] RÃ©duire PollCreator de 1650 â†’ 1150 lignes
  - [ ] Tests validation refactor immÃ©diate
  - [ ] Branch Git isolÃ©e pour rollback facile

ğŸ”¹ **Tests Antigravity**
  - [ ] Tests regroupement visuel mobile
  - [ ] Tests navigation dashboard â†’ discussions

### ğŸ“Œ VENDREDI 13 DÃ‰CEMBRE - JOUR 10

  - [ ] Valider refactor PollCreator (tests E2E complets)
  - [ ] Documentation architecture refactorÃ©e
  - [ ] Tests de performance post-refactor
  - [x] ~~PrÃ©paration refactor gemini.ts~~ â†’ **TERMINÃ‰** (06/12) - SimplifiÃ© en mode direct

  **Google Calendar - Documentation**
  - [ ] Documenter comportements attendus vs observÃ©s
  - [ ] AmÃ©liorer affichage conflits utilisateur
  - [ ] Cas d'usage avancÃ©s

  **Fingerprinting - Tests approfondis**
  - [ ] Tests multiples fingerprints diffÃ©rents
  - [ ] Validation accÃ¨s non-admin ("Access Denied")
  - [ ] Tests formatage dates et badges confidence


### SEMAINE 3 : STABILITÃ‰ + REFACTOR CIBLÃ‰S

### ğŸ“Œ LUNDI 16 DÃ‰CEMBRE - JOUR 11

  - [ ] Documentation utilisateur
  - [ ] Page "Transparence & Impact"
  - [ ] Configuration Supabase production
  - [ ] Documentation SÃ©curitÃ© & RGPD

**Consolidation Tests E2E**
  - [ ] PrÃ©paration bÃªta
  - [ ] Checklist lancement
  - [ ] Tests finaux

**Analytics IA DatePolls**
  - [ ] Adapter PollAnalyticsService pour dates (2h)
    - [ ] Adapter algorithmes consensus pour dates
    - [ ] Calculer conflits horaires automatiquement
    - [ ] GÃ©nÃ©rer insights "Meilleure date ?"
    - Insights consensus/conflits automatiques (1h)
      - [ ] DÃ©tection automatique des conflits
      - [ ] Suggestions de dates alternatives
      - [ ] Visualisation heatmap disponibilitÃ©
    - UI panneau analytics (1h)
      - [ ] Composant `DateAnalyticsPanel.tsx`
      - [ ] Graphiques consensus/conflits
      - [ ] Export suggestions PDF

### ğŸ“Œ MARDI 17 DÃ‰CEMBRE - JOUR 12

**Tests Transverses** (2h + 1h)
  - [ ] Tests E2E cross-produits
  - [ ] Tests sÃ©curitÃ© multi-rÃ©gions
  - [ ] Tests conformitÃ© RGPD

**Tests Analytics DatePolls**
  - [ ] Validation architecture sÃ©parÃ©e
  - [ ] Tests intÃ©gration finaux

### ğŸ“Œ MERCREDI 18 DÃ‰CEMBRE - JOUR 13

### 5. DÃ©finir limites exactes par type de poll
**Fichier concernÃ© :**
- `src/constants/quotas.ts`

**Valeurs actuelles (temporaires) :**
```typescript
export const POLL_TYPE_QUOTAS = {
  ANONYMOUS: {
    DATE_POLLS: 5,           // âš ï¸ Ã€ dÃ©finir dans planning dÃ©cembre
    FORM_POLLS: 5,           // âš ï¸ Ã€ dÃ©finir dans planning dÃ©cembre
    QUIZZ: 5,                // âš ï¸ Ã€ dÃ©finir dans planning dÃ©cembre
    AVAILABILITY_POLLS: 5,   // âš ï¸ Ã€ dÃ©finir dans planning dÃ©cembre
  },
  AUTHENTICATED: {
    DATE_POLLS: 50,          // âš ï¸ Ã€ dÃ©finir dans planning dÃ©cembre
    FORM_POLLS: 50,          // âš ï¸ Ã€ dÃ©finir dans planning dÃ©cembre
    QUIZZ: 50,               // âš ï¸ Ã€ dÃ©finir dans planning dÃ©cembre
    AVAILABILITY_POLLS: 50,  // âš ï¸ Ã€ dÃ©finir dans planning dÃ©cembre
  },
} as const;
```

**Ã€ faire dans le planning de dÃ©cembre :**
- [ ] DÃ©cider des limites exactes selon la stratÃ©gie produit
- [ ] Mettre Ã  jour les constantes dans `src/constants/quotas.ts`
- [ ] Mettre Ã  jour les limites dans `GUEST_LIMITS` (`src/lib/guestQuotaService.ts`)
- [ ] Mettre Ã  jour les limites dans la fonction SQL `consume_quota_credits` (`sql-scripts/create-quota-tracking-table.sql`)

### ğŸ“Œ JEUDI 19 DÃ‰CEMBRE - JOUR 14

### ğŸ“Œ VENDREDI 20 DÃ‰CEMBRE - JOUR 15

SEO agent AgentSEO.jpg

---

## ğŸ”„ EOL (END OF LIFE) - ANCIENNE EXPÃ‰RIENCE QUOTAS UNIFIÃ‰S

### Contexte
Avec la sÃ©paration complÃ¨te des quotas par produit (date-polls, form-polls, quizz, availability), l'ancienne expÃ©rience oÃ¹ les 3 produits partageaient un quota global `polls_created` est obsolÃ¨te.

### Ã‰tat actuel
- âœ… **SÃ©paration technique complÃ¨te** : Compteurs sÃ©parÃ©s dans la base de donnÃ©es
- âœ… **Limites par type** : Chaque produit a sa propre limite indÃ©pendante
- âš ï¸ **RÃ©trocompatibilitÃ© maintenue** : `polls_created` existe encore pour affichage uniquement (via trigger SQL)
- âš ï¸ **VÃ©rifications globales supprimÃ©es** : Plus de limite globale `polls_created >= LIMIT`

### Actions EOL Ã  planifier

#### Phase 1 : Nettoyage code (Janvier 2025)
- [ ] Supprimer colonne `polls_created` de `quota_tracking` et `guest_quotas`
- [ ] Supprimer trigger SQL `sync_polls_created_trigger`
- [ ] Supprimer fonction SQL `sync_polls_created_from_separated_counters`
- [ ] Retirer `pollsCreated` de toutes les interfaces TypeScript
- [ ] Mettre Ã  jour tous les scripts de monitoring pour ne plus utiliser `polls_created`
- [ ] Mettre Ã  jour documentation pour reflÃ©ter la sÃ©paration complÃ¨te

#### Phase 2 : Migration donnÃ©es (Janvier 2025)
- [ ] Script de migration pour supprimer `polls_created` (colonne calculable Ã  la volÃ©e si besoin)
- [ ] VÃ©rifier que tous les clients utilisent les compteurs sÃ©parÃ©s
- [ ] Tests de rÃ©gression complets

#### Phase 3 : Documentation (FÃ©vrier 2025)
- [ ] Documenter la dÃ©cision d'EOL dans `Docs/ARCHITECTURE/`
- [ ] Mettre Ã  jour guides dÃ©veloppeur
- [ ] Communiquer le changement aux utilisateurs (si impact visible)

### Notes importantes
- `polls_created` est actuellement maintenu uniquement pour l'affichage dans l'UI
- Les limites sont maintenant **uniquement** vÃ©rifiÃ©es par type de poll
- Le trigger SQL maintient `polls_created = somme des 4 compteurs` automatiquement
- **Aucune action immÃ©diate requise** : L'EOL peut Ãªtre planifiÃ© aprÃ¨s la bÃªta







