# DooDates - Development Planning
---

- Comparer : Asana
- On-boarding : soit on bouge pour montrer ou est quoi, soit on bouge pas et la taille est toujours la meme  /facile Ã  cliquer.
- 2 secrets to hid https://dashboard.gitguardian.com/workspace/785397/incidents/secrets?view=177be640-c105-432e-9e53-3b3216273cc6&sort_date=true
- Message IA que le premier message ?
- release note easy to find


## ğŸš¨  BÃŠTA
**âš ï¸ NOUVELLE DEADLINE : Fin novembre 2025** (dÃ©calage d'une semaine)

**Objectif :** Lancer une bÃªta fonctionnelle avec 10-20 utilisateurs testeurs  
**Deadline initiale :** ~~Mi-novembre 2025~~ â†’ **Fin novembre 2025**  
**Raison du dÃ©calage :** Tests d'intÃ©gration et tests manuels non terminÃ©s  
**Documents de rÃ©fÃ©rence :**
- `2025-10-30-ANALYSE-PRE-BETA.md` - Analyse stratÃ©gique complÃ¨te
- `BUGS-PRE-BETA.md` - Tracking bugs et features manquantes
- `TESTS-MANUELS-PRE-BETA.md` - Protocole de tests
- `INTERNATIONAL-LAUNCH-STRATEGY.md` - Lancement international (POST BÃŠTA)



---

### Semaine 1 : Tests Analytics IA + Corrections (12h)
- [X] **Jour 1 (8h) :** Tests fonctionnels complets 
   - [X] CohÃ©rence des croix pour fermer (design et placement)
   - [X] Mettre l'application sur GitHub Pages â†’ rendre le repo public et vÃ©rifier que tout fonctionne
   - [X] Optimisations CI
   - [X] Quotas freemium (5 anonyme, 1000 authentifiÃ©, blocage) âœ…
   - [X] Test manuels
   - [X] **VÃ©rifier coÃ»ts API rÃ©els (monitoring Gemini)** âœ… 03 Nov 2025
   - [X] **Quota IA - Documentation : Aligner code, UI, doc et tests** âœ… 03 Nov 2025
   - [X] **Supprimer QuotaExplanation et utiliser la page /pricing** âœ… 03 Nov 2025
      - Composant QuotaExplanation.tsx supprimÃ© (249 lignes Ã©liminÃ©es)
      - Dashboard.tsx utilise dÃ©sormais un simple bouton vers `/pricing`
      - Page pricing dÃ©jÃ  existante (src/pages/Pricing.tsx) avec tous les dÃ©tails
      - Calcul dÃ©taillÃ© des marges ajoutÃ© au pricing (99.4% Premium, 98.3% Pro)


- [X] **Jour 2 :** Fixer les tests          

- [X] **Jour 3 :** Fixer les bugs identifiÃ©s lors des tests
   - [X] Tests
      - [X] **PRIORITÃ‰ 4 - Tests Manquants **
        - âœ… Tests E2E cas limites Dashboard (60-65) - CrÃ©Ã©s et validÃ©s âœ…           
        - âœ… **Tests E2E - Optimisations Phase 1 & 2 TERMINÃ‰ES** âœ… (Voir `Docs/PERFORMANCE/E2E-OPTIMIZATION-ANALYSIS.md`)
        - âœ… Phase 1 validÃ©e: Workers CI (1â†’3), cache optimisÃ©, ~5 occurrences optimisÃ©es
        - âœ… Phase 2 complÃ©tÃ©e et validÃ©e CI: 10 fichiers optimisÃ©s (~55 occurrences waitForTimeout/networkidle supprimÃ©es)
        - [X] **ğŸ”§ Option 5 - AmÃ©lioration Tests Dashboard E2E (TERMINÃ‰)** âœ…
          - âœ… Tous les tests E2E Dashboard passent maintenant en CI (05 Nov 2025)
          - âœ… Corrections appliquÃ©es : sÃ©lecteurs robustes (getByRole, getByText), allowlist erreurs modules dynamiques
          - âœ… Tests corrigÃ©s : SÃ©lectionner/dÃ©sÃ©lectionner conversations, Assigner tags/dossiers, Afficher tags/dossiers, Retirer tags/dossiers, GÃ©rer tags/dossiers sans existants
        - [X] **Tests Gemini AutomatisÃ©s - Phase 1 (TERMINÃ‰)** âœ…
          - âœ… 25 tests implÃ©mentÃ©s (15 Date Polls + 10 Form Polls)
          - âœ… Score : 94% (EXCELLENT)
   - [x] Tests Form Polls : Simples, Rating, NPS, Matrix, Validation, Mix Types, Event, Feedback, Complex
   - [x] FonctionalitÃ© Dashboard : organisation des centaines de fichiers + pagination
   - [X] OPTIMISATIONS PERFORMANCE TERMINÃ‰ES (05 Nov 2025)
         **RÃ©sultat :** -62% de temps de chargement (1633 ms â†’ 628 ms)
         ### Phase 1 : Lazy Load DÃ©pendances Lourdes âœ… TERMINÃ‰
         ### Phase 4 : Quick Wins âœ… TERMINÃ‰
   - [X] Finir les fonctionalitÃ©s dashboard âœ… TERMINÃ‰ (2025-01-XX)       

- [X] **Jour 4 (6-7h) :** AccÃ¨s rÃ©sultats FormPoll + Email âœ…
    **Voir documentation utilisateur : `USER-DOCUMENTATION/04-Formulaires-Questionnaires.md` et `USER-DOCUMENTATION/06-Gestion-Resultats.md`**

   - [X] **Corrections tests critiques ğŸ”´** - Voir `TESTS-GUIDE.md` PrioritÃ© 1
      - [x] IntentDetectionService - âœ… 29/29 tests passent (corrigÃ©)
      - [x] DashboardFilters.test.tsx - âœ… 20/20 tests passent (corrigÃ©)
      - [x] ManageTagsFolderDialog.test.tsx - âœ… 11/11 tests passent (corrigÃ©)
      - [x] utils.test.ts dashboard - âœ… 30/30 tests passent (corrigÃ©)
      - [x] RÃ©activer useAiMessageQuota.test.ts - âœ… Partiellement corrigÃ© (17/22 tests passent - 77%)
         - [x] RenommÃ© fichier `.test.skip.ts` â†’ `.test.ts`
         - [x] CorrigÃ© valeurs attendues avec mock quotas (1 pour guest/auth - valeurs de test)
         - [x] CorrigÃ© cooldown: 2s â†’ 3s (MIN_DELAY_BETWEEN_MESSAGES = 3000ms)
         - [x] CorrigÃ© import async ligne 22
         - [x] RefactorisÃ© logique reset mensuel â†’ fonction pure `processMonthlyQuotaReset()`
         - [x] AjoutÃ© 4 tests unitaires pour `processMonthlyQuotaReset()` âœ… (tous passent)
         - [x] 17/22 tests passent âœ… (77%)

   - [x] **Setup & Configuration (30min)** âœ…
      - [x] PrÃ©parer structure EmailService (console.log MVP, Resend API pour Phase 2) âœ…
      - [x] **Note :** Stockage FormPolls vs Supabase âœ…
        - **FormPolls** : StockÃ©s en `localStorage` (mÃªme avec comptes bÃªta)
        - **Email** : GÃ©nÃ©ration HTML uniquement (console.log MVP), Resend API en Phase 2
        - **Supabase (Jour 5)** : NÃ©cessaire pour auth/comptes bÃªta + quotas IA, mais pas pour stocker les FormPolls
        - `getCurrentUserId()` : Retourne `user.id` si authentifiÃ©, sinon `deviceId` (localStorage)
   
   - [x] **VisibilitÃ© des rÃ©sultats (3h)** âœ…
      - [x] Ajouter champ `resultsVisibility` dans `Poll` (creator-only, voters, public) âœ…
      - [x] UI radio buttons dans `FormPollCreator.tsx` âœ…
      - [x] Helpers `getCurrentUserId()` et `checkIfUserHasVoted()` âœ…
      - [x] ContrÃ´le d'accÃ¨s dans `FormPollResults.tsx` âœ…
      - [x] Bouton conditionnel "Voir les rÃ©sultats" post-vote âœ…
      - [x] Message explicatif si accÃ¨s refusÃ© âœ…
      - [x] Support MultiStepFormVote âœ…

   - [x] **Email de confirmation (3h)** âœ…
      - [x] Champ `respondentEmail` dans `FormResponse` âœ…
      - [x] Checkbox "Recevoir une copie par email" dans vote âœ…
      - [x] Input email conditionnel âœ…
      - [x] Service `EmailService.ts` avec template HTML âœ…
      - [x] IntÃ©gration post-soumission (console.log MVP) âœ…
      - [x] Support MultiStepFormVote âœ…

   - [x] **Tests automatisÃ©s (2h)** âœ…
      - [x] Tests unitaires : getCurrentUserId, checkIfUserHasVoted (9 tests) âœ…
      - [x] Tests unitaires : addFormResponse avec respondentEmail (3 tests) âœ…
      - [x] Tests unitaires : EmailService (5 tests) âœ…
      - [x] Tests E2E : VisibilitÃ© des rÃ©sultats (3 tests) âœ… - **CorrigÃ©s (crÃ©ation directe localStorage)**
      - [x] Tests E2E : Email de confirmation (2 tests) âœ… - **CorrigÃ©s (crÃ©ation directe localStorage)**
      - [x] **Total : 14 tests unitaires + 5 tests E2E = 19 tests** âœ…
      - [x] **Tests E2E validÃ©s : 5/5 passent (100%)** âœ…

   - [x] Configuration Supabase pour bÃªta âš¡ **AVANCÃ‰** (nÃ©cessaire avant tests manuels avec comptes) âœ…
      - [x] VÃ©rification Supabase production (crÃ©er projet si nÃ©cessaire) âœ…
      - [x] Configurer variables d'environnement (VITE_SUPABASE_URL, VITE_SUPABASE_ANON_KEY) âœ…
      - [x] ExÃ©cuter migrations SQL (beta_keys, user_quotas si nÃ©cessaire) âœ…
      - [X] VÃ©rifier auth Supabase fonctionnel - **Ã€ tester maintenant**
      - [X] Tests smoke : crÃ©er compte + activer clÃ© bÃªta - **Ã€ faire maintenant**
      - [x] Mettre Ã  jour `getCurrentUserId()` pour utiliser `user.id` si authentifiÃ© âœ…
      - [x] Activer Supabase dans `supabase.ts` (dÃ©commenter la config) âœ…
      - [X] **Puis** : Faire les tests manuels du Jour 4 avec comptes rÃ©els

   - [X] Synchronisation Conversations Supabase (1-2 jours) âš ï¸ CRITIQUE POUR BETA
      **Objectif:** Permettre aux utilisateurs connectÃ©s de retrouver leurs conversations aprÃ¨s reconnexion et sur tous leurs appareils

        **Backend (Supabase):**
        - [x] Tables `conversations` et `conversation_messages` dÃ©jÃ  crÃ©Ã©es âœ…
        - [x] RLS policies dÃ©jÃ  configurÃ©es âœ…
        - [x] VÃ©rifier que les indexes sont optimaux pour les requÃªtes frÃ©quentes

        **Frontend:**
        - [x] CrÃ©er `ConversationStorageSupabase.ts` (classe similaire Ã  `ConversationStorageSimple.ts`) âœ…
          - [x] MÃ©thodes CRUD : `getConversations()`, `getConversation()`, `createConversation()`, `updateConversation()`, `deleteConversation()` âœ…
          - [x] MÃ©thodes messages : `getMessages()`, `saveMessages()`, `addMessages()` âœ…
          - [x] Gestion des erreurs et retry logic âœ…
          - [x] Cache local pour performance âœ…
        - [x] Modifier `useConversations.ts` pour utiliser Supabase quand `user?.id` existe âœ…
          - [x] Charger depuis Supabase au dÃ©marrage si connectÃ© âœ…
          - [x] Fusionner avec localStorage (garder le plus rÃ©cent) âœ…
          - [x] Sauvegarder automatiquement dans Supabase Ã  chaque modification âœ…
          - [x] Fallback sur localStorage si Supabase Ã©choue âœ…
        - [x] Modifier `useAutoSave.ts` pour sauvegarder dans Supabase âœ…
          - [x] Sauvegarder conversation dans Supabase lors de la crÃ©ation âœ…
          - [x] Sauvegarder messages dans Supabase Ã  chaque ajout âœ…
          - [x] Sauvegarder titre gÃ©nÃ©rÃ© dans Supabase âœ…
          - [x] Charger depuis Supabase lors de la reprise âœ…
        - [x] Migration automatique localStorage â†’ Supabase Ã  la connexion âœ…
          - [x] CrÃ©er `autoMigrateGuestConversations.ts` âœ…
          - [x] DÃ©tecter conversations localStorage avec `userId === null` ou `"guest"` âœ…
          - [x] Migrer automatiquement au premier login âœ…
          - [x] Marquer comme migrÃ©es pour Ã©viter doublons âœ…
          - [x] IntÃ©grer dans `AuthContext` (session initiale + onAuthStateChange) âœ…

        **TEST AMIS**
           - [X] Faire tester par Nathalie et Diego et Erwan : EN COURS

        - [X] ClÃ©s Beta Testeurs (1 jour) ğŸ âœ… TERMINÃ‰
          **Objectif:** Permettre aux beta testeurs d'utiliser l'app sans limites
          **Backend (Supabase):**
          - [x] Migration SQL: Table `beta_keys` (code, status, assigned_to, expires_at) âœ…
          - [x] Function `generate_beta_key()` â†’ Format BETA-XXXX-XXXX-XXXX âœ…
          - [x] Function `redeem_beta_key(user_id, code)` â†’ Activation + upgrade tier âœ…
          - [x] RLS policies (admin peut tout voir, user voit ses clÃ©s) âœ…
          - [x] Table `user_quotas` avec tier `beta` âœ…
          - [x] Fonctions `consume_credits`, `reset_monthly_quotas`, `check_and_expire_beta_keys` âœ…
          **Frontend:**
          - [x] Service `BetaKeyService.ts` (generateKeys, redeemKey, listKeys, exportCSV, stats) âœ…
          - [x] Modal `BetaKeyModal.tsx` pour activation clÃ© (intÃ©grÃ© dans WorkspaceLayoutPrototype) âœ…
          - [x] CSV export des clÃ©s gÃ©nÃ©rÃ©es (mÃ©thode `downloadCSV()` dans BetaKeyService) âœ…
          **Livrable:** âœ… Backend + Service + Modal terminÃ©s. Manque: Page admin + Badge TopBar

- [X] **Jour 5 :** 

   - [X] **ğŸ”¥ Protection Production - Phase 1 (CRITIQUE)** âœ… 07 Nov 2025
      - **Contexte :** Suite Ã  incident (application en ligne mais ne marchait plus)
      - **Objectif :** Plus jamais de dÃ©ploiement cassÃ© non dÃ©tectÃ©
      - **ProblÃ¨me identifiÃ© :** Tests sur-mockÃ©s (179 `vi.mock()`) masquant problÃ¨mes rÃ©els
      - **ImplÃ©mentation Phase 1 :**
        - âœ… Tests de smoke post-dÃ©ploiement (`production-smoke.spec.ts`)
        - âœ… Workflow automatique (`.github/workflows/5-production-smoke-tests.yml`)
        - âœ… Scripts locaux (Windows + Linux/Mac)
        - âœ… Blocage merge automatique dans PR validation (`1-pr-validation.yml`)
        - âœ… Issue critique auto si Ã©chec en prod
        - âœ… DÃ©tection < 3 minutes (vs heures/jours avant)
        - âœ… ProcÃ©dure claire (rollback ou hotfix)
        - âœ… Tests sans mocks = vraie dÃ©tection des problÃ¨mes
      - **Documentation :** `Docs/PROTECTION-PRODUCTION.md` et `Docs/TESTS/TESTS-GUIDE.md`
      
   - [X] **Tests manuels Supabase** â†’ **DÃ‰PLACÃ‰S Ã€ SEMAINE 2** (voir ci-dessous)
     - âœ… Test 1 & 3 terminÃ©s (crÃ©ation conversation + reconnexion)
     - â³ Tests 2, 4-12 Ã  complÃ©ter la semaine prochaine

        **Fichiers Ã  crÃ©er/modifier:**
        - [x] `src/lib/storage/ConversationStorageSupabase.ts` (NOUVEAU) âœ…
        - [x] `src/hooks/useConversations.ts` (MODIFIER) âœ…
        - [x] `src/hooks/useAutoSave.ts` (MODIFIER) âœ…
        - [x] `src/lib/storage/autoMigrateGuestConversations.ts` (NOUVEAU) âœ…
        - [x] `src/contexts/AuthContext.tsx` (MODIFIER - migration auto) âœ…
   
    - [x] **Documentation et validation finale** âœ…
      - [x] Documentation utilisateur mise Ã  jour avec nouvelles fonctionnalitÃ©s âœ…
      - [x] VÃ©rifier que tous les tests passent en CI âœ… (19 tests : 14 unitaires + 5 E2E)
     - [ ] **Test Pierre (en attente des tests manuels avec comptes)** â†’ **DÃ‰PLACÃ‰ SEMAINE 2**

   - [X] **ğŸ”¥ Protection Production - Phase 2 (EN COURS)** ğŸ”„ 07 Nov 2025
      - **Objectif :** RÃ©duire dÃ©pendance aux mocks, tester vraies intÃ©grations AVANT production
      - **ImplÃ©mentation :**
        - [X] Tests d'intÃ©gration rÃ©els (`tests/integration/real-supabase.test.ts`) - 12 tests simplifiÃ©s
        - [X] Compte de test crÃ©Ã© (`test-integration@doodates.com` - User ID: 451d736c)
        - [X] Tests auth, DB, connexion, performance (0 mocks)
        - [X] Workflow GitHub Actions (`.github/workflows/6-integration-tests.yml`)
        - [X] Blocage merge si Ã©chec + issue auto crÃ©Ã©e
        - [X] Documentation complÃ¨te (`Docs/TESTS/PROTECTION-PRODUCTION-PHASE2.md`)
        - [X] Scripts de vÃ©rification (Windows + Linux/Mac)
        - [X] Tests adaptÃ©s au schÃ©ma Supabase rÃ©el
      
      - **Ã‰tat actuel (07 Nov 2025 - 19h08):**
        - âœ… **4 tests passent** (33% de couverture)
          - AUTH-01: Token Supabase valide dans localStorage âœ…
          - AUTH-02: User ID correspond au compte de test âœ…
          - PERF-01: Lecture conversations < 2s âœ…
          - CONN-01: Client Supabase peut se connecter âœ…
        - âŒ **8 tests Ã©chouent** (CRUD conversations)
          - CONV-01 Ã  CONV-05: OpÃ©rations CRUD (erreurs structure donnÃ©es)
          - RLS-01 Ã  RLS-02: Tests sÃ©curitÃ© (dÃ©pendent de CRUD)
          - PERF-02: CrÃ©ation conversation (dÃ©pend de CRUD)
        
      - **RÃ©sultats :**
        - âœ… Authentification fonctionne (token valide, user ID correct)
        - âœ… Connexion Supabase opÃ©rationnelle
        - âœ… Performance lecture < 2s validÃ©e
        - âš ï¸ CRUD conversations nÃ©cessite ajustements schÃ©ma
        - âœ… 100% rÃ©duction mocks (0 dans tests intÃ©gration)
        - âœ… DurÃ©e exÃ©cution: ~56s (12 tests)
      




---


### Semaine 2 : Finalisation Tests & Corrections (14-16 Nov 2025)

**Objectif :** Terminer tous les tests avant la bÃªta  
**DurÃ©e estimÃ©e :** 12-16h  

ğŸ‘¤ User ID: 3b1802f9-db46-48c7-86b0-199830f56f53
VM819:4 ğŸ“§ Email: julien.fritsch+doodates2@gmail.com
VM819:5 ğŸ” Token expires at: 07/11/2025 18:53:53
VM819:9 
âœ… User ID sauvegardÃ©: 3b1802f9-db46-48c7-86b0-199830f56f53

- [ ] **Demain :** Test complet consommation des quotas (2-3h)

      - **TESTING SANS MOCK :**
        - [ ] **Option A (RecommandÃ© pour bÃªta):** Garder 4 tests qui passent + documenter
        - [ ] **Option B (Plus tard):** Debugger CRUD + ajuster structure donnÃ©es (30-45 min)
        - [ ] Configurer secrets GitHub (`INTEGRATION_TEST_PASSWORD`)
        - [ ] Pusher et vÃ©rifier workflow CI
        - [ ] Mettre Ã  jour documentation avec tests finaux
      
      - [ ] **ğŸš€ GitHub pages Deployments (Phase 3 - Nice to have)**
          - [ ] Configurer GitHub pages  pour preview automatique sur chaque PR
          - [ ] Ajouter workflow `.github/workflows/netlify-preview.yml`
          - [ ] Commentaire automatique dans PR avec URL preview
          - [ ] **Objectif :** Partager URLs de preview aux testeurs (non-bloquant)
          - [ ] **Gratuit** et automatique (100% gratuit sur GitHub pages )
          - [ ] **Temps estimÃ© :** 1-2h setup + documentation
      - **MÃ©triques :** 80% rÃ©duction mocks, 10 fonctionnalitÃ©s critiques testÃ©es, < 5 min

   - [ ] RÃ©flechir Ã  la sauvegarde et l'avenir \Docs\AUTOSAVE-EXPLANATION.md


   - [ ] **Test systÃ¨me de tracking des crÃ©dits consommÃ©s**
      
        !!!! BUG - effacer le local storage remet Ã  0 les crÃ©dits consommÃ©s.

      **1. Test crÃ©ation conversation (1 crÃ©dit)**
      - [ ] CrÃ©er une nouvelle conversation (guest)
      - [ ] VÃ©rifier dans localStorage (`doodates_quota_consumed`) que `conversationsCreated` = 1
      - [ ] VÃ©rifier dans le journal (`doodates_quota_journal`) qu'une entrÃ©e existe avec `action: "conversation_created"` et `credits: 1`
      - [ ] VÃ©rifier que le total `totalCreditsConsumed` = 1
      - [ ] VÃ©rifier dans le dashboard que la barre de progression affiche 1 crÃ©dit utilisÃ©
      - [ ] Cliquer sur la barre de progression â†’ VÃ©rifier que le journal s'affiche avec l'entrÃ©e

      **2. Test crÃ©ation poll (1 crÃ©dit)**
      - [ ] CrÃ©er un nouveau poll (guest)
      - [ ] VÃ©rifier que `pollsCreated` = 1
      - [ ] VÃ©rifier dans le journal qu'une entrÃ©e existe avec `action: "poll_created"` et `credits: 1`
      - [ ] VÃ©rifier que le total `totalCreditsConsumed` = 2 (1 conversation + 1 poll)
      - [ ] VÃ©rifier que la mise Ã  jour d'un poll existant ne consomme PAS de crÃ©dit

      **3. Test message IA (1 crÃ©dit)**
      - [ ] Envoyer un message dans une conversation
      - [ ] VÃ©rifier que `aiMessages` = 1
      - [ ] VÃ©rifier dans le journal qu'une entrÃ©e existe avec `action: "ai_message"` et `credits: 1`
      - [ ] VÃ©rifier que le total `totalCreditsConsumed` = 3
      - [ ] Envoyer 3 messages supplÃ©mentaires â†’ VÃ©rifier que `aiMessages` = 4 et total = 6

      **4. Test query analytics IA (1 crÃ©dit)**
      - [ ] CrÃ©er un poll avec des rÃ©ponses
      - [ ] Poser une question analytique (ex: "Quel est le taux de rÃ©ponse ?")
      - [ ] VÃ©rifier que `analyticsQueries` = 1
      - [ ] VÃ©rifier dans le journal qu'une entrÃ©e existe avec `action: "analytics_query"` et `credits: 1`
      - [ ] VÃ©rifier que le total `totalCreditsConsumed` = 7
      - [ ] Poser la mÃªme question deux fois â†’ VÃ©rifier que seul le premier appel consomme un crÃ©dit (cache)

      **5. Test insights auto-gÃ©nÃ©rÃ©s (1 crÃ©dit)**
      - [ ] GÃ©nÃ©rer les insights automatiques d'un poll
      - [ ] VÃ©rifier que `analyticsQueries` = 2 (1 query manuelle + 1 insight auto)
      - [ ] VÃ©rifier dans le journal qu'une entrÃ©e existe avec `action: "analytics_query"` et mÃ©tadonnÃ©es appropriÃ©es
      - [ ] VÃ©rifier que le total `totalCreditsConsumed` = 8

      **6. Test simulation complÃ¨te (5 crÃ©dits)**
      - [ ] Lancer une simulation complÃ¨te sur un poll
      - [ ] VÃ©rifier que `simulations` = 1 (mais crÃ©dits = 5)
      - [ ] VÃ©rifier dans le journal qu'une entrÃ©e existe avec `action: "simulation"` et `credits: 5`
      - [ ] VÃ©rifier que le total `totalCreditsConsumed` = 13 (8 prÃ©cÃ©dents + 5 simulation)

      **7. Test journal de consommation**
      - [ ] AccÃ©der Ã  `/dashboard/journal`
      - [ ] VÃ©rifier que toutes les entrÃ©es sont affichÃ©es (groupÃ©es par date)
      - [ ] VÃ©rifier que les statistiques par action sont correctes
      - [ ] VÃ©rifier que la recherche fonctionne (par action, poll, conversation)
      - [ ] VÃ©rifier que les mÃ©tadonnÃ©es sont affichÃ©es (conversationId, pollId, etc.)
      - [ ] VÃ©rifier que le total affichÃ© correspond au total rÃ©el

      **8. Test sÃ©paration utilisateurs (guest vs auth)**
      - [ ] CrÃ©er des crÃ©dits en mode guest (3 crÃ©dits)
      - [ ] Se connecter avec un compte
      - [ ] VÃ©rifier que les crÃ©dits guest ne sont PAS visibles pour l'utilisateur connectÃ©
      - [ ] CrÃ©er des crÃ©dits en Ã©tant connectÃ© (2 crÃ©dits)
      - [ ] VÃ©rifier que seuls les 2 crÃ©dits de l'utilisateur connectÃ© sont visibles
      - [ ] Se dÃ©connecter â†’ VÃ©rifier que les crÃ©dits guest sont toujours lÃ  (3 crÃ©dits)

      **9. Test reset mensuel (utilisateurs authentifiÃ©s)**
      - [ ] Se connecter avec un compte
      - [ ] Consommer 5 crÃ©dits
      - [ ] VÃ©rifier la date de reset dans `subscriptionStartDate` et `lastResetDate`
      - [ ] Simuler le passage de la date de reset (modifier manuellement `lastResetDate` dans localStorage)
      - [ ] Recharger la page â†’ VÃ©rifier que les crÃ©dits sont rÃ©initialisÃ©s Ã  0
      - [ ] VÃ©rifier que le journal est conservÃ© (pas supprimÃ©)
      - [ ] VÃ©rifier que la nouvelle date de reset est calculÃ©e correctement

      **10. Test dashboard - barre de progression**
      - [ ] VÃ©rifier que la barre de progression affiche le bon nombre de crÃ©dits utilisÃ©s
      - [ ] VÃ©rifier que le texte affiche "X crÃ©dits utilisÃ©s" (pas "conversations utilisÃ©es")
      - [ ] Cliquer sur la barre de progression â†’ VÃ©rifier la redirection vers `/dashboard/journal`
      - [ ] Cliquer sur le bouton "Journal" â†’ VÃ©rifier la redirection vers `/dashboard/journal`
      - [ ] VÃ©rifier que le bouton "En savoir plus" redirige vers `/pricing`

      **11. Test limites et blocage**
      - [ ] Consommer tous les crÃ©dits disponibles (5 pour guest, 1000 pour auth)
      - [ ] VÃ©rifier que les nouvelles actions sont bloquÃ©es avec un message appropriÃ©
      - [ ] VÃ©rifier que le journal continue de fonctionner mÃªme Ã  la limite
      - [ ] VÃ©rifier que la barre de progression affiche 100%

      **12. Test performance et limites du journal**
      - [ ] CrÃ©er 100+ entrÃ©es dans le journal
      - [ ] VÃ©rifier que seules les 1000 derniÃ¨res entrÃ©es sont conservÃ©es (limite localStorage)
      - [ ] VÃ©rifier que la page du journal charge rapidement mÃªme avec beaucoup d'entrÃ©es
      - [ ] VÃ©rifier que la recherche fonctionne rapidement

      **13. Test suppression - crÃ©dits non remboursÃ©s (CRITIQUE)**
      - [ ] CrÃ©er 3 conversations (3 crÃ©dits consommÃ©s)
      - [ ] CrÃ©er 2 polls (2 crÃ©dits consommÃ©s)
      - [ ] Envoyer 2 messages IA (2 crÃ©dits consommÃ©s)
      - [ ] VÃ©rifier que le total = 7 crÃ©dits consommÃ©s
      - [ ] **Supprimer les 3 conversations** depuis le dashboard
      - [ ] VÃ©rifier que `totalCreditsConsumed` reste Ã  7 (PAS de remboursement)
      - [ ] VÃ©rifier que `conversationsCreated` reste Ã  3 (pas de diminution)
      - [ ] VÃ©rifier que le journal contient toujours les 3 entrÃ©es "conversation_created"
      - [ ] **Supprimer les 2 polls** depuis le dashboard
      - [ ] VÃ©rifier que `totalCreditsConsumed` reste Ã  7 (PAS de remboursement)
      - [ ] VÃ©rifier que `pollsCreated` reste Ã  2 (pas de diminution)
      - [ ] VÃ©rifier que le journal contient toujours les 2 entrÃ©es "poll_created"
      - [ ] VÃ©rifier dans le dashboard que la barre de progression affiche toujours 7 crÃ©dits utilisÃ©s
      - [ ] VÃ©rifier dans le journal que toutes les entrÃ©es sont toujours prÃ©sentes
      - [ ] VÃ©rifier que les mÃ©tadonnÃ©es (conversationId, pollId) dans le journal pointent vers des IDs supprimÃ©s (c'est normal)
      - [ ] **Test avec utilisateur authentifiÃ© :**
        - [ ] Se connecter avec un compte
        - [ ] Consommer 5 crÃ©dits (2 conversations + 1 poll + 2 messages IA)
        - [ ] Supprimer toutes les conversations et polls
        - [ ] VÃ©rifier que les crÃ©dits restent Ã  5 (pas de remboursement)
        - [ ] VÃ©rifier que le reset mensuel fonctionne toujours correctement aprÃ¨s suppression

      **14. Test reconnaissance vocale (ne doit PAS consommer de crÃ©dits)**
      - [ ] Activer la reconnaissance vocale
      - [ ] Parler pour transcrire du texte
      - [ ] VÃ©rifier que `totalCreditsConsumed` reste inchangÃ© (la transcription est gratuite)
      - [ ] VÃ©rifier qu'aucune entrÃ©e n'est ajoutÃ©e au journal pendant la transcription
      - [ ] Envoyer le texte transcrit Ã  l'IA
      - [ ] VÃ©rifier que SEULEMENT l'envoi Ã  Gemini consomme 1 crÃ©dit (pas la transcription)

      **15. Test cas limites et erreurs**
      - [ ] Tester avec localStorage plein (quota exceeded) â†’ VÃ©rifier que le systÃ¨me gÃ¨re l'erreur gracieusement
      - [ ] Tester avec des valeurs corrompues dans localStorage â†’ VÃ©rifier que le systÃ¨me se rÃ©initialise correctement
      - [ ] Tester avec des dates invalides dans `lastResetDate` â†’ VÃ©rifier que le reset fonctionne quand mÃªme
      - [ ] Tester avec `userId` null/undefined â†’ VÃ©rifier que Ã§a utilise "guest" par dÃ©faut
      - [ ] Tester avec des mÃ©tadonnÃ©es manquantes dans le journal â†’ VÃ©rifier que l'affichage ne plante pas

      **16. Test synchronisation multi-onglets**
      - [ ] Ouvrir l'application dans 2 onglets (mÃªme utilisateur)
      - [ ] Consommer 2 crÃ©dits dans l'onglet 1
      - [ ] VÃ©rifier que l'onglet 2 affiche aussi 2 crÃ©dits consommÃ©s (aprÃ¨s rafraÃ®chissement)
      - [ ] Consommer 1 crÃ©dit dans l'onglet 2
      - [ ] VÃ©rifier que l'onglet 1 affiche 3 crÃ©dits consommÃ©s (aprÃ¨s rafraÃ®chissement)
      - [ ] VÃ©rifier que le journal est synchronisÃ© entre les deux onglets

      **17. Test persistance aprÃ¨s fermeture navigateur**
      - [ ] Consommer 5 crÃ©dits
      - [ ] Fermer complÃ¨tement le navigateur
      - [ ] Rouvrir l'application
      - [ ] VÃ©rifier que les 5 crÃ©dits sont toujours consommÃ©s
      - [ ] VÃ©rifier que le journal contient toujours toutes les entrÃ©es
      - [ ] VÃ©rifier que la barre de progression affiche le bon total

      **18. Test cohÃ©rence UI vs localStorage**
      - [ ] Consommer des crÃ©dits via l'interface
      - [ ] Ouvrir la console et vÃ©rifier directement localStorage
      - [ ] VÃ©rifier que les valeurs affichÃ©es dans l'UI correspondent exactement Ã  localStorage
      - [ ] Modifier manuellement localStorage (pour tester)
      - [ ] Recharger la page â†’ VÃ©rifier que l'UI affiche les nouvelles valeurs
      - [ ] VÃ©rifier que le journal affiche les mÃªmes totaux que le dashboard

      **Fichiers Ã  vÃ©rifier:**
      - [ ] `src/lib/quotaTracking.ts` - Toutes les fonctions de tracking
      - [ ] `src/pages/ConsumptionJournal.tsx` - Affichage du journal
      - [ ] `src/components/Dashboard.tsx` - Barre de progression et liens
      - [ ] `src/hooks/useMessageSender.ts` - Appel `consumeAiMessageCredits`
      - [ ] `src/hooks/useSimulation.ts` - Appel `consumeSimulationCredits`
      - [ ] `src/services/PollAnalyticsService.ts` - Appels `consumeAnalyticsCredits`
      - [ ] `src/hooks/useConversations.ts` - Appel `incrementConversationCreated`
      - [ ] `src/lib/pollStorage.ts` - Appel `incrementPollCreated`

        **Tests FormPoll - VisibilitÃ© & Email (1h15)**
      
      - [ ] **Test 1 : VisibilitÃ© "creator-only" (15min)**
        - [ ] CrÃ©er FormPoll avec visibilitÃ© "Moi uniquement"
        - [ ] VÃ©rifier que crÃ©ateur voit les rÃ©sultats
        - [ ] VÃ©rifier qu'autre utilisateur ne voit PAS le bouton "Voir rÃ©sultats" aprÃ¨s vote
        - [ ] VÃ©rifier message "AccÃ¨s restreint" si accÃ¨s direct Ã  `/results`
      
      - [ ] **Test 2 : VisibilitÃ© "voters" (15min)**
        - [ ] CrÃ©er FormPoll avec visibilitÃ© "Personnes ayant votÃ©"
        - [ ] Utilisateur 1 vote â†’ VÃ©rifier bouton "Voir rÃ©sultats" apparaÃ®t
        - [ ] Utilisateur 1 accÃ¨de aux rÃ©sultats â†’ OK
        - [ ] Utilisateur 2 (n'a pas votÃ©) accÃ¨de `/results` â†’ Message "Votez pour voir"
      
      - [ ] **Test 3 : VisibilitÃ© "public" (10min)**
        - [ ] CrÃ©er FormPoll avec visibilitÃ© "Public"
        - [ ] VÃ©rifier accÃ¨s rÃ©sultats SANS voter
        - [ ] Voter puis vÃ©rifier accÃ¨s rÃ©sultats toujours OK
      
      - [ ] **Test 4 : Email de confirmation (15min)**
        - [ ] CrÃ©er FormPoll (2+ questions)
        - [ ] Voter en cochant "Recevoir copie email"
        - [ ] VÃ©rifier champ email apparaÃ®t
        - [ ] VÃ©rifier console.log "ğŸ“§ Email Ã  envoyer" avec bon contenu
        - [ ] VÃ©rifier HTML contient titre, nom, rÃ©ponses, lien rÃ©sultats
      
      - [ ] **Test 5 : Validation email (5min)**
        - [ ] Cocher "Recevoir copie" SANS remplir email
        - [ ] VÃ©rifier message erreur "Veuillez entrer votre email"
        - [ ] VÃ©rifier formulaire non soumis
      
      - [ ] **Test 6 : Workflow complet (10min)**
        - [ ] CrÃ©er FormPoll visibilitÃ© "voters"
        - [ ] Voter avec email + vÃ©rifier console.log
        - [ ] Cliquer "Voir rÃ©sultats" â†’ VÃ©rifier affichage
        - [ ] VÃ©rifier email contient toutes les rÃ©ponses
      
      - [ ] **Test 7 : CompatibilitÃ© mode invitÃ© (5min)**
        - [ ] Navigation privÃ©e : crÃ©er poll et voter
        - [ ] VÃ©rifier tous les tests ci-dessus fonctionnent sans compte
        - [ ] VÃ©rifier deviceId utilisÃ© pour identification
      
      **Documentation Ã  vÃ©rifier:**
      - [ ] `Docs/QUOTAS&PRICING/2025-11-06-CREDITS-CONSUMPTION-LIST.md` - Liste complÃ¨te des actions consommant des crÃ©dits

- [ ] **Jour 8 :** 
      - [ ] 5 tests Ã©chouent encore :
            - `should persist quota in localStorage` - localStorage null (effet ne sauvegarde pas)
            - `should restore quota from localStorage` - aiMessagesUsed = 0 au lieu de 1
            - `should persist poll counts in localStorage` - localStorage null
            - `should allow message after cooldown expires` - isInCooldown reste true (setInterval problÃ¨me)
            - `should initialize reset date for authenticated users` - localStorage null (guest au lieu de auth)
         - Solutions appliquÃ©es : real timers pour localStorage, avancement progressif pour cooldown
         - Note : La logique mÃ©tier est testÃ©e via `processMonthlyQuotaReset()` (100% couverture)

#### Tests d'intÃ©gration Supabase
- [ ] **Option A (RecommandÃ©) :** Garder 4 tests qui passent + documenter
  - âœ… AUTH-01: Token Supabase valide
  - âœ… AUTH-02: User ID correct  
  - âœ… PERF-01: Lecture conversations < 2s
  - âœ… CONN-01: Connexion Supabase
  - [ ] Documenter les 8 tests CRUD non fonctionnels
  - [ ] Mettre Ã  jour README avec Ã©tat actuel
  
- [ ] **Option B (Si temps) :** DÃ©bugger CRUD conversations (3-4h)
  - [ ] Ajuster structure donnÃ©es tests
  - [ ] Corriger tests CONV-01 Ã  CONV-05
  - [ ] Corriger tests RLS-01 Ã  RLS-02
  - [ ] Corriger test PERF-02

#### Tests manuels Supabase (4-6h)
- [ ] **2. Test ajout de messages**
  - [ ] Ajouter plusieurs messages dans une conversation
  - [ ] VÃ©rifier sauvegarde dans Supabase
  - [ ] VÃ©rifier `message_count` mis Ã  jour
  - [ ] VÃ©rifier cache localStorage

- [ ] **4. Test migration automatique localStorage â†’ Supabase**
  - [ ] CrÃ©er conversations en mode guest
  - [ ] Se connecter avec un compte
  - [ ] VÃ©rifier logs migration dans console
  - [ ] VÃ©rifier migration dans Supabase
  - [ ] VÃ©rifier messages migrÃ©s

- [ ] **5. Test fusion localStorage + Supabase**
  - [ ] CrÃ©er conversation sur appareil A
  - [ ] Modifier sur appareil B (mÃªme compte)
  - [ ] VÃ©rifier version plus rÃ©cente affichÃ©e
  - [ ] VÃ©rifier pas de doublons

- [ ] **6. Test fallback localStorage si Supabase Ã©choue**
  - [ ] DÃ©sactiver internet
  - [ ] CrÃ©er conversation
  - [ ] VÃ©rifier sauvegarde localStorage
  - [ ] RÃ©activer internet
  - [ ] VÃ©rifier synchronisation

- [ ] **7. Test multi-appareils** (CRITIQUE)
  - [ ] Appareil A : crÃ©er conversation + messages
  - [ ] Appareil B : vÃ©rifier apparition
  - [ ] Appareil B : ajouter message
  - [ ] Appareil A : rafraÃ®chir et vÃ©rifier

- [ ] **8. Test mise Ã  jour conversation**
  - [ ] Modifier titre, favoris, tags
  - [ ] VÃ©rifier Supabase
  - [ ] Se dÃ©connecter/reconnecter
  - [ ] VÃ©rifier persistence

- [ ] **9. Test suppression conversation**
  - [ ] Supprimer conversation
  - [ ] VÃ©rifier Supabase
  - [ ] VÃ©rifier localStorage
  - [ ] VÃ©rifier non rÃ©apparition

- [ ] **10. Test gÃ©nÃ©ration automatique titre**
  - [ ] CrÃ©er conversation + messages
  - [ ] Attendre 1.5s (debounce)
  - [ ] VÃ©rifier titre dans Supabase
  - [ ] VÃ©rifier historique

- [ ] **11. Test mode guest**
  - [ ] CrÃ©er conversations sans connexion
  - [ ] VÃ©rifier uniquement dans localStorage
  - [ ] VÃ©rifier PAS dans Supabase

- [ ] **12. Test performance et limites**
  - [ ] CrÃ©er 50+ conversations
  - [ ] VÃ©rifier chargement rapide
  - [ ] VÃ©rifier pagination
  - [ ] VÃ©rifier pas de timeout

#### Bugs Ã  corriger
- [ ] **BUG: Messages incomplets lors reprise conversation** (2-3h)
  - Diagnostic: 4 messages chargÃ©s depuis Supabase mais affichage partiel
  - Fichiers: `ConversationService.ts`, `GeminiChatInterface.tsx`
  - Ã€ investiguer: Ordre messages, conversion Supabaseâ†’UI, Ã©tat React

#### Tests Pierre
- [ ] Faire tester par Pierre avec comptes multiples
- [ ] Recueillir feedback
- [ ] Corriger bugs identifiÃ©s

---


### Semaine 3 : Features manquantes + Setup Production (21-28 Nov 2025)

#### Outils recommandÃ©s avant Beta (6-8h)
- [ ] **Changesets (3-4h)** - Gestion versions et changelogs automatiques
- [ ] **Zod upgrade v3.23+ (1-2h)** - Meilleurs messages d'erreur franÃ§ais
- [ ] **@axe-core/playwright (2h)** - Tests accessibilitÃ© automatisÃ©s

#### Landing page (2h)
- [ ] Value proposition claire
- [ ] CTA "Essayer gratuitement"
- [ ] Screenshots de l'app
- [ ] Section "Comment Ã§a marche" (3 Ã©tapes)

#### Couverture tests critiques (12-20h)
- [ ] Tests GeminiChatInterface (8-12h)
- [ ] Tests services/hooks/lib critiques (4-12h)

### Semaine 4 : BÃªta Launch ğŸš€ (28 Nov - 5 DÃ©c 2025)
- **Jour 1 :** Recruter 10-20 beta testers
- [ ] Poster sur Reddit (r/SideProject, r/productivity)
- [ ] Partager sur LinkedIn/Twitter
- [ ] Contacter rÃ©seau personnel (10-20 personnes)
- [ ] CrÃ©er formulaire feedback Google Forms

- **Jour 2-7 :** Monitoring, feedback, itÃ©rations rapides
- [ ] RÃ©ponse feedback utilisateurs (< 24h)
- [ ] Corrections bugs critiques dÃ©couverts
- [ ] ItÃ©rations rapides sur UX
- [ ] **ğŸ”¥ Protection Production - Phase 3 (Post-Beta)** ğŸ“… PLANIFIÃ‰
      - **Objectif :** Monitoring proactif et tests de charge pour anticiper problÃ¨mes
      - **Actions prÃ©vues :**
        - [ ] Monitoring prod (Sentry ou similaire)
        - [ ] Tests de charge (k6, Artillery)
        - [ ] Tests de rÃ©gression visuels (Percy)
        - [ ] Health checks continus (ping /5min)
        - [ ] Logs & Analytics structurÃ©s
      - **MÃ©triques :** MTTR < 30min, Uptime > 99.5%, Chargement < 2s, 0 incidents non dÃ©tectÃ©s

**Total estimÃ© :** ~40-52h sur 4 semaines
- Semaine 1 (âœ… TerminÃ©e) : Tests Analytics IA + Corrections + Protection Prod Phase 1
- Semaine 2 (14-16 Nov) : Finalisation tests Supabase (12-16h)
- Semaine 3 (21-28 Nov) : Features + Setup Production (20-28h)
- Semaine 4 (28 Nov - 5 DÃ©c) : BÃªta Launch + Monitoring

### MÃ©triques de succÃ¨s
**Acquisition :**
- [ ] 10-20 beta testers recrutÃ©s
- [ ] 50-100 visiteurs landing page

**Activation :**
- [ ] 10+ sondages crÃ©Ã©s
- [ ] 50+ votes reÃ§us
- [ ] 5+ exports rÃ©alisÃ©s
- [ ] 20+ queries Analytics IA effectuÃ©es
- [ ] 3+ utilisateurs atteignant quota Analytics

**QualitÃ© :**
- [ ] < 5 bugs critiques remontÃ©s
- [ ] Temps rÃ©ponse moyen < 2s
- [ ] 0 erreurs Sentry critiques

**Feedback :**
- [ ] 70%+ feedback positif
- [ ] 3+ suggestions d'amÃ©lioration concrÃ¨tes
- [ ] Identification top 3 features demandÃ©es

---



---

### âŒ CE QUI N'EST PAS DANS LA BÃŠTA

### Features ReportÃ©es APRÃˆS BÃªta

**NE PAS implÃ©menter maintenant** : Ces features ajoutent de la complexitÃ© sans valeur immÃ©diate pour valider le concept. Elles seront ajoutÃ©es APRÃˆS avoir collectÃ© du feedback rÃ©el.
- âŒ Templates prÃ©dÃ©finis (l'IA suffit)
- âŒ Multi-step flow Typeform-style
- âŒ ThÃ¨mes visuels premium (3 thÃ¨mes basiques OK)
- âŒ Simulation IA des rÃ©ponses
- âŒ Analyse temporelle continue
- âŒ Validation d'objectifs IA
- âŒ Google Sheets export
- âŒ Calendar integration
- âŒ PWA / Mobile native
- âŒ Analytics avancÃ©s
- âŒ Scoring system
- âŒ Quotas par option
- âŒ File uploads
- âŒ SSO Enterprise

---

## ğŸ’° QUOTAS & PRICING (POST BÃŠTA)

**Timeline:** Ã€ implÃ©menter immÃ©diatement aprÃ¨s validation bÃªta  
**DurÃ©e totale estimÃ©e:** 6-8 jours  
**PrioritÃ©:** ğŸ”´ CRITIQUE pour monÃ©tisation

### ğŸ”’ SÃ©curisation Quotas & Protection Anti-Abus

**Date analyse :** 03 Novembre 2025  
**ProblÃ¨me identifiÃ© :** SystÃ¨me actuel vulnÃ©rable aux abus (localStorage + clÃ© API exposÃ©e)

#### âš ï¸ FAILLES ACTUELLES

**1. Quotas localStorage (cÃ´tÃ© client uniquement)**
- âŒ Stockage dans `localStorage.getItem('doodates_ai_quota')`
- âŒ Bypass trivial : `localStorage.setItem('doodates_ai_quota', JSON.stringify({aiMessagesUsed: 0}))`
- âŒ Mode navigation privÃ©e = nouveau quota Ã  chaque fois
- âŒ Pas de vÃ©rification serveur avant appel Gemini API

**2. ClÃ© API Gemini exposÃ©e**
- âŒ `VITE_GEMINI_API_KEY` dans le bundle client (visible par tous)
- âŒ Extraction possible : DevTools â†’ Sources â†’ Rechercher "GEMINI_API_KEY"
- âŒ Utilisation directe de la clÃ© pour appels illimitÃ©s
- âŒ CoÃ»t illimitÃ© possible pour vous

**3. Impact financier**
- 1 utilisateur malveillant = 10 000+ appels API/mois
- CoÃ»t estimÃ© : 50-100â‚¬/mois par abus
- Risque : faillite si plusieurs abus simultanÃ©s

#### âœ… SOLUTION : ARCHITECTURE SÃ‰CURISÃ‰E

**Principe :** Toute vÃ©rification de quota + appel API doit passer par serveur (Supabase Edge Function)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CLIENT (React)                          â”‚
â”‚ âŒ Plus de clÃ© API Gemini              â”‚
â”‚ âŒ Plus de vÃ©rification quota locale   â”‚
â”‚ âœ… Token JWT Supabase (authentifiÃ©)     â”‚
â”‚ âœ… Tous appels â†’ Edge Function          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SUPABASE EDGE FUNCTION (/api/chat)       â”‚
â”‚ âœ… VÃ©rifie JWT (auth.uid())              â”‚
â”‚ âœ… VÃ©rifie quota DB (transaction atomique)â”‚
â”‚ âœ… Consomme crÃ©dit avant appel API       â”‚
â”‚ âœ… ClÃ© Gemini = variable serveur (safe)  â”‚
â”‚ âœ… Rate limiting userId + IP             â”‚
â”‚ âœ… Logs audit (qui a fait quoi)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GEMINI API                               â”‚
â”‚ âœ… ClÃ© jamais exposÃ©e au client          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ImplÃ©mentation :**

**Backend (Supabase Edge Function):**
- [x] CrÃ©er `/supabase/functions/check-quota-and-chat/index.ts` âœ… COMPLÃ‰TÃ‰
- [x] VÃ©rifier JWT : `const userId = await verifyJWT(request)` âœ…
- [x] VÃ©rifier quota DB : `SELECT credits_remaining FROM user_quotas WHERE user_id = $1 FOR UPDATE` âœ…
- [x] Consommer atomiquement : `UPDATE user_quotas SET credits_remaining = credits_remaining - 1` âœ…
- [x] Appeler Gemini API (clÃ© dans `Deno.env.get('GEMINI_API_KEY')`) âœ…
- [x] Retourner rÃ©ponse uniquement si succÃ¨s âœ…
- [x] Rate limiting : 100 messages/heure par userId, 20/heure par IP (invitÃ©s) âœ…

**Frontend :**
- [x] Supprimer `VITE_GEMINI_API_KEY` du `.env` âœ…
- [x] Modifier `GeminiChatInterface.tsx` : appeler Edge Function au lieu de Gemini directement âœ…
- [x] GÃ©rer erreurs quota (affichage modal upgrade) âœ…
- [x] Cache localStorage = UI uniquement (pas source de vÃ©ritÃ©) âœ…

**Protection additionnelle :**
- [x] Rate limiting par IP (Cloudflare/Vercel) : 100 req/h pour invitÃ©s âœ…
- [x] DÃ©tection anomalies : alerte si > 50 crÃ©dits/heure par userId âœ…
- [ ] Restrictions Gemini (Google Cloud) : quota max 1000 req/jour par clÃ©
- [ ] Rotation clÃ©s API : changer si compromis

#### ğŸ›¡ï¸ DÃ‰FENSE EN PROFONDEUR

**Couche 1 : Authentification**
- JWT Supabase obligatoire (expiration 15 min)
- Impossible d'appeler Edge Function sans compte valide

**Couche 2 : Quotas en DB (source de vÃ©ritÃ©)**
- Transaction atomique (FOR UPDATE) = pas de race condition
- VÃ©rification + consommation = une seule opÃ©ration

**Couche 3 : Rate limiting**
- Par userId : 100 messages/heure (authentifiÃ©), 20/heure (invitÃ©)
- Par IP : 100 req/heure (protection anti-multi-comptes)

**Couche 4 : Monitoring**
- Logs toutes les requÃªtes (userId, timestamp, crÃ©dits consommÃ©s)
- Alertes si usage suspect (> 50 crÃ©dits/heure)

**Couche 5 : Restrictions API externe**
- Quotas Gemini dans Google Cloud Console
- Alertes si dÃ©passement

#### ğŸ“Š COÃ›TS MAÃTRISÃ‰S

**Avec sÃ©curisation :**
- 1 utilisateur gratuit = max 20 crÃ©dits/mois = 0.01â‚¬
- 1 utilisateur Premium = max 100 crÃ©dits/mois = 0.05â‚¬
- Protection contre abus = impossible de bypass

**Sans sÃ©curisation :**
- 1 utilisateur malveillant = illimitÃ© = 50-100â‚¬/mois
- Risque : faillite

#### âœ… OFFRE GRATUITE AVEC SÃ‰CURISATION

**StratÃ©gie :** Maintenir offre gÃ©nÃ©reuse (20 crÃ©dits/mois) car :
- âœ… Quotas vÃ©rifiÃ©s cÃ´tÃ© serveur (impossible bypass)
- âœ… Rate limiting protÃ¨ge contre abus massifs
- âœ… CoÃ»t maÃ®trisÃ© mÃªme avec quelques abus isolÃ©s
- âœ… Conversion optimisÃ©e (offre gÃ©nÃ©reuse = meilleure adoption)

**Quotas proposÃ©s :**
- **Gratuit :** 20 crÃ©dits/mois (â‰ˆ 0.01â‚¬/mois)
- **Premium :** 100 crÃ©dits/mois (â‰ˆ 0.05â‚¬/mois)
- **Pro :** 1000 crÃ©dits/mois (â‰ˆ 0.50â‚¬/mois)

**Protection invitÃ©s (sans compte) :**
- Rate limiting strict : 10 messages max par IP/jour
- Forcer authentification aprÃ¨s 5 messages
- CoÃ»t nÃ©gligeable : 5 Ã— 0.0005â‚¬ = 0.0025â‚¬/visiteur

**Risques rÃ©siduels acceptables :**
- Utilisateurs trÃ¨s techniques (reverse engineering) = coÃ»t maÃ®trisÃ© par rate limiting
- Attaques coordonnÃ©es = dÃ©tectables via monitoring
- Comparaison : mÃªme Netflix/GitHub ont des contournements (objectif = rendre abus non rentable)

#### ğŸ“‹ CHECKLIST SÃ‰CURISATION

**Phase 1 : Migration Edge Function (1 jour)** âœ… COMPLÃ‰TÃ‰
- [x] CrÃ©er Edge Function `/check-quota-and-chat`
- [x] DÃ©placer clÃ© Gemini â†’ variable serveur
- [x] ImplÃ©menter vÃ©rification quota DB
- [x] Tester consommation atomique

**Phase 2 : Migration frontend (4h)** âœ… COMPLÃ‰TÃ‰
- [x] Modifier `GeminiService` â†’ appeler Edge Function
- [x] Supprimer `VITE_GEMINI_API_KEY` du client
- [x] GÃ©rer erreurs quota (modals)

**Phase 3 : Rate limiting (2h)** âœ… COMPLÃ‰TÃ‰
- [x] ImplÃ©menter rate limiting userId (Edge Function)
- [x] ImplÃ©menter rate limiting IP (Edge Function)
- [x] Tester limites

**Phase 4 : Monitoring (2h)** âœ… COMPLÃ‰TÃ‰
- [x] Logs audit dans Edge Function
- [ ] Dashboard monitoring (Supabase logs) - Optionnel
- [ ] Alertes anomalies (email/webhook) - Optionnel

**Tests :**
- [x] Tentative bypass localStorage (doit Ã©chouer) - âœ… VÃ©rifiÃ© cÃ´tÃ© serveur
- [x] Tentative extraction clÃ© API (doit Ãªtre impossible) - âœ… ClÃ© cÃ´tÃ© serveur uniquement
- [x] Test rate limiting (blocage aprÃ¨s limite) - âœ… ImplÃ©mentÃ©
- [x] Test consommation atomique (pas de race condition) - âœ… FOR UPDATE dans SQL

**DÃ©ploiement :**
- [x] Edge Function crÃ©Ã©e et prÃªte
- [x] Script SQL crÃ©Ã©
- [x] Documentation complÃ¨te

---

### SystÃ¨me CrÃ©dits UnifiÃ©s (3 jours)

**Objectif:** Remplacer quotas sÃ©parÃ©s par crÃ©dits IA unifiÃ©s en DB

**Backend (Supabase):**
- [ ] Migration SQL: Table `user_quotas`
  ```sql
  - tier (free, premium, pro, beta)
  - plan (monthly, annual)
  - credits_total (20, 100, 1000, 1000)
  - credits_used
  - credits_remaining
  - max_polls (20, 100, unlimited, unlimited)
  - period_start, period_end, reset_date
  ```
- [ ] Function `consume_credits(user_id, amount)` avec transaction
- [ ] Function `reset_monthly_quotas()` + cron job (1er du mois)
- [ ] Function `check_and_expire_beta_keys()` + cron job (quotidien)
- [ ] RLS policies (user voit uniquement ses quotas)
- [ ] Index performance (user_id, tier)

**Migration donnÃ©es:**
- [ ] Script conversion localStorage â†’ Supabase
- [ ] Mapping ancien systÃ¨me:
  ```
  aiMessages + analyticsQueries + (simulations Ã— 5) = crÃ©dits
  ```
- [ ] Bonus 20% goodwill pour utilisateurs existants
- [ ] Grace period 30 jours (ancien systÃ¨me actif en parallÃ¨le)

**Frontend:**
- [ ] Service `QuotaService.ts` (getQuota, consumeCredits, purchasePack)
- [ ] Hook `useCredits()` unifiÃ© (remplace useAiMessageQuota, useAnalyticsQuota)
- [ ] Modifier consommation dans:
  - `GeminiChatInterface.tsx`: 1 crÃ©dit/message
  - `PollAnalyticsPanel.tsx`: 1 crÃ©dit/query + 1 crÃ©dit/insight
  - `SimulationService.ts`: 5 crÃ©dits/simulation
- [ ] Indicateur TopBar: "42/100 crÃ©dits âš¡" avec tooltip dÃ©tails
- [ ] Modal `QuotaReachedModal.tsx`:
  - Tier actuel + usage
  - Recommandation (pack crÃ©dits vs upgrade)
  - Boutons CTA (Acheter pack / Voir plans)
- [ ] Page `/pricing` avec comparaison tiers

**Tests:**
- [ ] Consommation crÃ©dits (chat, analytics, simulation)
- [ ] Blocage Ã  0 crÃ©dits
- [ ] Reset mensuel (simulation date)
- [ ] Rollover annuel (simulation)
- [ ] Performance: 100 users simultanÃ©s consommant crÃ©dits

---

### UI Pricing & Conversion (2 jours)

**Page Pricing (`/pricing`):** âœ… CRÃ‰Ã‰
- [X] Composant `PricingPage.tsx`
- [X] Toggle Monthly/Annual avec badge Ã©conomie
- [X] 3 cards tiers (Gratuit, Premium, Pro)
- [X] Section Beta Testeurs (comment rejoindre)
- [X] Comparaison features (tableau)
- [X] FAQ pricing (6 questions)
- [X] CTA final "Commencer gratuitement"
- [X] Responsive mobile + Dark mode
- [X] Route `/pricing` configurÃ©e

**Modal Upgrade in-app:**
- [ ] Trigger automatique Ã  100% quota
- [ ] Afficher tier actuel + recommandation personnalisÃ©e
- [ ] Boutons:
  - "Voir les plans" â†’ /pricing
  - "Acheter pack crÃ©dits" â†’ Modal achat
  - "Plus tard" â†’ Fermer (re-trigger dans 7 jours)
- [ ] Tracking analytics (ouverture, clics, conversion)

**Packs crÃ©dits (Phase 2 - aprÃ¨s Stripe):**
- [ ] Modal `CreditPackPurchase.tsx`
- [ ] 3 packs (50/3â‚¬, 100/5â‚¬, 500/20â‚¬)
- [ ] Integration Stripe Checkout
- [ ] Confirmation email avec rÃ©cap
- [ ] Ajout crÃ©dits immÃ©diat aprÃ¨s paiement
- [ ] ValiditÃ© 6 mois (tracking expiration)

---

### Programme Beta Testeurs (1 semaine)

**Recrutement (20 testeurs):**
- [ ] Formulaire candidature Google Forms
- [ ] Posts recrutement:
  - [ ] Reddit r/SideProject, r/productivity
  - [ ] LinkedIn (post personnel)
  - [ ] Twitter/X thread
  - [ ] RÃ©seau personnel (10 clÃ©s rÃ©servÃ©es)
- [ ] SÃ©lection profils (diversitÃ© usage, engagement)
- [ ] GÃ©nÃ©ration 20 clÃ©s beta
- [ ] Email bienvenue avec clÃ© + instructions

**Setup infrastructure:**
- [ ] Discord serveur privÃ© beta
- [ ] Canaux: #annonces, #bugs, #feedback, #showcase
- [ ] RÃ´le "Beta Tester" automatique
- [ ] Bot notifications (nouveau bug, feedback)

**Suivi engagement:**
- [ ] Questionnaire Semaine 1 (premiÃ¨re impression)
- [ ] Questionnaire Semaine 4 (mi-parcours)
- [ ] Questionnaire Semaine 8 (feedback dÃ©taillÃ©)
- [ ] Questionnaire Semaine 12 (final + testimonials)
- [ ] Interviews 1-on-1 avec 5 power users
- [ ] Calendrier relances (inactifs > 7 jours)

**MÃ©triques tracking:**
- [ ] Dashboard admin: Usage beta testeurs
- [ ] Sondages crÃ©Ã©s (objectif: 100+ collectif)
- [ ] Bugs reportÃ©s (objectif: 50+)
- [ ] Feedback score moyen (objectif: 4+/5)
- [ ] Testimonials collectÃ©s (objectif: 10+)

**Conversion post-beta:**
- [ ] Email J-7: "Votre bÃªta se termine bientÃ´t"
- [ ] Email J-0: "Offre exclusive: Premium 50% off (4.50â‚¬/mois, 6 mois)"
- [ ] Badge permanent "Early Supporter" si upgrade
- [ ] Conversion auto tier beta â†’ free si pas d'upgrade

**Documentation:**
- [ ] `Docs/USER-DOCUMENTATION/18-QUOTAS-PRICING-FINAL.md` âœ… CRÃ‰Ã‰
- [ ] Update `Docs/USER-DOCUMENTATION/14-FAQ.md` (section quotas)
- [ ] Update `Docs/USER-DOCUMENTATION/06-Analytics-IA.md` (nouveaux quotas)
- [ ] CrÃ©er `Docs/BETA-TESTER-GUIDE.md` (guide complet beta testeurs)
- [ ] Update README.md (mention programme beta)

**Checklist Lancement Beta:**

**Technique:**
- [ ] Tables DB (user_quotas, beta_keys)
- [ ] SystÃ¨me clÃ©s fonctionnel
- [ ] 20 clÃ©s gÃ©nÃ©rÃ©es et testÃ©es
- [ ] Mode invitÃ© (5 crÃ©dits)
- [ ] SystÃ¨me crÃ©dits unifiÃ©s dÃ©ployÃ©
- [ ] Badge Beta visible
- [ ] Page /pricing live
- [ ] Discord beta crÃ©Ã©

**Communication:**
- [ ] Email template bienvenue beta
- [ ] Formulaire candidature
- [ ] Posts recrutement publiÃ©s
- [ ] Page `/beta` expliquant programme
- [ ] Questionnaires prÃ©parÃ©s

**Suivi:**
- [ ] Analytics tracking (activation clÃ©s, usage, conversion)
- [ ] Dashboard admin beta testeurs
- [ ] Alertes (bugs critiques, inactivitÃ©)
- [ ] Scripts support (FAQ beta)

**Total:** ~8 jours + 1 semaine recrutement/suivi  
**PrioritÃ©:** ğŸ”¥ CRITIQUE (permet lancement beta sans limitations)  
**CoÃ»t:** 20 testeurs Ã— $0.50/mois = $10/mois (ROI: testimonials + feedback + conversions)

---

## ğŸ§ª TESTS AVANCÃ‰S (POST BÃŠTA)

**Timeline:** AprÃ¨s validation bÃªta  
**DurÃ©e totale estimÃ©e:** 20-30h  
**PrioritÃ©:** ğŸŸ¡ MOYENNE - Important pour qualitÃ© long-terme mais pas bloquant

### Tests IntÃ©gration Supabase

**Ã‰tat actuel:** 4 tests passent (AUTH, CONN, PERF), 8 tests CRUD Ã©chouent

**Option A (RecommandÃ©) :** Garder 4 tests qui passent + documenter
- âœ… AUTH-01: Token Supabase valide
- âœ… AUTH-02: User ID correct  
- âœ… PERF-01: Lecture conversations < 2s
- âœ… CONN-01: Connexion Supabase
- [ ] Documenter les 8 tests CRUD non fonctionnels
- [ ] Mettre Ã  jour README avec Ã©tat actuel

**Option B (Si temps) :** DÃ©bugger CRUD conversations (3-4h)
- [ ] Ajuster structure donnÃ©es tests
- [ ] Corriger tests CONV-01 Ã  CONV-05
- [ ] Corriger tests RLS-01 Ã  RLS-02
- [ ] Corriger test PERF-02

**Tests manuels Supabase (4-6h):**

**2. Test ajout de messages**
- [ ] Ajouter plusieurs messages dans une conversation
- [ ] VÃ©rifier sauvegarde dans Supabase
- [ ] VÃ©rifier `message_count` mis Ã  jour
- [ ] VÃ©rifier cache localStorage

**4. Test migration automatique localStorage â†’ Supabase**
- [ ] CrÃ©er conversations en mode guest
- [ ] Se connecter avec un compte
- [ ] VÃ©rifier logs migration dans console
- [ ] VÃ©rifier migration dans Supabase
- [ ] VÃ©rifier messages migrÃ©s

**5. Test fusion localStorage + Supabase**
- [ ] CrÃ©er conversation sur appareil A
- [ ] Modifier sur appareil B (mÃªme compte)
- [ ] VÃ©rifier version plus rÃ©cente affichÃ©e
- [ ] VÃ©rifier pas de doublons

**6. Test fallback localStorage si Supabase Ã©choue**
- [ ] DÃ©sactiver internet
- [ ] CrÃ©er conversation
- [ ] VÃ©rifier sauvegarde localStorage
- [ ] RÃ©activer internet
- [ ] VÃ©rifier synchronisation

**7. Test multi-appareils (CRITIQUE)**
- [ ] Appareil A : crÃ©er conversation + messages
- [ ] Appareil B : vÃ©rifier apparition
- [ ] Appareil B : ajouter message
- [ ] Appareil A : rafraÃ®chir et vÃ©rifier

**8. Test mise Ã  jour conversation**
- [ ] Modifier titre, favoris, tags
- [ ] VÃ©rifier Supabase
- [ ] Se dÃ©connecter/reconnecter
- [ ] VÃ©rifier persistence

**9. Test suppression conversation**
- [ ] Supprimer conversation
- [ ] VÃ©rifier Supabase
- [ ] VÃ©rifier localStorage
- [ ] VÃ©rifier non rÃ©apparition

**10. Test gÃ©nÃ©ration automatique titre**
- [ ] CrÃ©er conversation + messages
- [ ] Attendre 1.5s (debounce)
- [ ] VÃ©rifier titre dans Supabase
- [ ] VÃ©rifier historique

**11. Test mode guest**
- [ ] CrÃ©er conversations sans connexion
- [ ] VÃ©rifier uniquement dans localStorage
- [ ] VÃ©rifier PAS dans Supabase

**12. Test performance et limites**
- [ ] CrÃ©er 50+ conversations
- [ ] VÃ©rifier chargement rapide
- [ ] VÃ©rifier pagination
- [ ] VÃ©rifier pas de timeout

**Bugs Ã  corriger:**
- [ ] **BUG: Messages incomplets lors reprise conversation** (2-3h)
  - Diagnostic: 4 messages chargÃ©s depuis Supabase mais affichage partiel
  - Fichiers: `ConversationService.ts`, `GeminiChatInterface.tsx`
  - Ã€ investiguer: Ordre messages, conversion Supabaseâ†’UI, Ã©tat React

**Tests Pierre:**
- [ ] Faire tester par Pierre avec comptes multiples
- [ ] Recueillir feedback
- [ ] Corriger bugs identifiÃ©s

---

### Tests Gemini AutomatisÃ©s

#### Phase 2: Enhanced Gemini (Temporal Parsing) - 5-8 tests

**Estimation:** 2-3h

**Tests:**
- "RÃ©union la semaine prochaine entre 9h et 12h" â†’ Validation contraintes temporelles prÃ©cises
- "Ã‰vÃ©nement dans 2 semaines le weekend" â†’ Validation calcul dates futures
- "Formation tous les mercredis matin" â†’ Validation dÃ©tection rÃ©currence

#### Phase 3: Simulation IA - 5 tests

**Estimation:** 2-3h

**Tests:**
- Simulation avec objectif dÃ©fini
- Validation rÃ©sultats simulÃ©s atteignent objectif
- DÃ©tection problÃ¨mes dans questionnaire

---

### Tests Performance AutomatisÃ©s (8-12h)

**DÃ©clencheur:** AprÃ¨s validation bÃªta, besoin de garantir performance Ã  l'Ã©chelle

**Objectif:** ImplÃ©menter des tests de performance automatisÃ©s avec mÃ©triques prÃ©cises pour dÃ©tecter les rÃ©gressions et garantir la scalabilitÃ©.

**Contexte:** Les tests actuels (60-65) vÃ©rifient la stabilitÃ© mais pas les mÃ©triques prÃ©cises. Phase d'implÃ©mentation de tests automatisÃ©s avec seuils mesurables.

#### 1. Lighthouse CI Integration (4-6h)

- [ ] Setup Lighthouse CI dans GitHub Actions
- [ ] Configuration thresholds (Performance > 90, LCP < 2.5s, FID < 100ms)
- [ ] **Workflow :** `.github/workflows/lighthouse.yml` (nouveau)
  - [ ] ExÃ©cution sur schedule (quotidien, ex: 3h du matin UTC)
  - [ ] ExÃ©cution manuelle possible via `workflow_dispatch`
  - [ ] Pas d'exÃ©cution sur PR (Ã©vite ralentir les validations)
  - [ ] CrÃ©ation issue GitHub si rÃ©gression > 10%
- [ ] Dashboard avec historique des mÃ©triques
- [ ] Alertes Slack/Email en cas de rÃ©gression

#### 2. Tests Performance E2E avec MÃ©triques (4-6h)

- [ ] **Workflow :** `6-nightly-regression.yml` (job dÃ©diÃ© `e2e-performance`)
  - [ ] ExÃ©cution nocturne (2h du matin UTC, mÃªme schedule que regression)
  - [ ] Tests trÃ¨s longs (10-15 min) â†’ mieux dans workflow nightly
  - [ ] ExÃ©cution manuelle possible via `workflow_dispatch`
  - [ ] CrÃ©ation issue GitHub si rÃ©gression > 20%
- [ ] Utiliser `performance-measurement.ts` existant dans les tests E2E
- [ ] Test 61 amÃ©liorÃ© : Mesurer temps chargement dashboard avec 50+ conversations
  - Seuil : < 2s pour 50 conversations, < 5s pour 200 conversations
  - Mesurer LCP (Largest Contentful Paint), FCP (First Contentful Paint)
- [ ] Test 62 amÃ©liorÃ© : Mesurer temps ouverture menu tags avec 20+ tags
  - Seuil : < 500ms pour ouverture menu
  - Mesurer temps de scroll et frame rate
- [ ] Test 63 amÃ©liorÃ© : Mesurer temps ouverture menu dossiers avec 20+ dossiers
  - Seuil : < 500ms pour ouverture menu
  - Mesurer temps de scroll et frame rate
- [ ] Tests de charge progressifs : 10, 50, 100, 200 conversations
- [ ] GÃ©nÃ©ration de rapports de performance (JSON/HTML)

#### 3. Web Vitals Monitoring (2-3h)

- [ ] IntÃ©gration Web Vitals API dans l'app
- [ ] Envoi mÃ©triques vers Supabase/Analytics
- [ ] Dashboard monitoring temps rÃ©el (p50, p75, p95)
- [ ] Alertes si dÃ©gradation > 20% sur 7 jours
- [ ] **Note :** Monitoring en production uniquement (pas de workflow CI)

**Fichiers Ã  crÃ©er/modifier :**
- [ ] `tests/e2e/dashboard-performance.spec.ts` - Tests avec mÃ©triques prÃ©cises
- [ ] `.github/workflows/lighthouse.yml` - **Nouveau workflow Lighthouse CI (schedule quotidien)**
- [ ] Modifier `.github/workflows/6-nightly-regression.yml` - Ajouter job `e2e-performance` (tests longs)
- [ ] `src/lib/web-vitals-tracker.ts` - Tracking Web Vitals (production)
- [ ] `src/lib/performance-benchmarks.ts` - Seuils et comparaisons

**MÃ©triques cibles :**
- **Dashboard chargement :** < 2s (50 conversations), < 5s (200 conversations)
- **Lighthouse Performance :** > 90
- **LCP (Largest Contentful Paint) :** < 2.5s
- **FID (First Input Delay) :** < 100ms
- **CLS (Cumulative Layout Shift) :** < 0.1
- **Menu tags/dossiers :** < 500ms ouverture
- **Scroll 60fps** : Frame rate stable lors du scroll

**Outils recommandÃ©s :**
- Lighthouse CI (GitHub Actions)
- Playwright Performance API (`page.metrics()`)
- Web Vitals library (Google)
- Performance Observer API

**PrioritÃ© :** ğŸŸ¡ MOYENNE - Important pour scalabilitÃ© mais pas bloquant bÃªta  
**Note :** Les tests de stabilitÃ© actuels (60-65) sont suffisants pour la bÃªta. Cette phase ajoute des mÃ©triques prÃ©cises pour garantir performance Ã  l'Ã©chelle.

---

## ğŸš€ POST-BÃŠTA & LANCEMENT - DiffÃ©renciateurs Produit

**Timeline:** AprÃ¨s validation bÃªta + pendant lancement public  
**DurÃ©e totale estimÃ©e:** 40-60h  
**PrioritÃ©:** Variable selon feature (P0 Ã  P2)

**Regroupement:** Cette section fusionne les diffÃ©renciateurs IA, visuels et UX qui apportent de la valeur unique au produit.

### ğŸ’° UI Pricing - IntÃ©grations AvancÃ©es (POST BETA)

#### Option C: Conversion optimisÃ©e (30 min) â­ RECOMMANDÃ‰

**Objectif:** Maximiser la conversion en affichant le pricing aux moments stratÃ©giques

**Composants:**
- [X] Sidebar: Bouton "Tarifs" aprÃ¨s "Tableau de bord" âœ… FAIT
- [ ] Modal quota: Trigger automatique Ã  80% et 100% des crÃ©dits
- [ ] Indicateur crÃ©dits: Badge cliquable dans TopBar "42/100 âš¡"
  - Tooltip: DÃ©tails consommation (messages: 20, analytics: 15, simulations: 7)
  - Click â†’ Redirect `/pricing` avec anchor #upgrade

**Fichiers Ã  crÃ©er/modifier:**
- [ ] `src/components/QuotaIndicator.tsx` - Badge crÃ©dits TopBar
- [ ] `src/components/modals/QuotaReachedModal.tsx` - Modal upgrade
- [ ] `src/hooks/useCredits.ts` - Hook unifiÃ© gestion quotas

**Triggers modal:**
- 80% crÃ©dits: "Vous approchez de votre limite" (dismissible 7 jours)
- 100% crÃ©dits: "Quota atteint" (force affichage)
- AprÃ¨s 3 blocages consÃ©cutifs: Recommandation personnalisÃ©e

**PrioritÃ©:** ğŸŸ¡ MOYENNE - Conversion important mais pas bloquant beta

---

#### Option D: ComplÃ¨te (1h)

**Objectif:** VisibilitÃ© maximale du pricing dans toute l'app

**Composants Option C +:**
- [ ] Dashboard card "Votre plan" (tier actuel, usage, upgrade CTA)
- [ ] Menu Settings: Section "Abonnement & Facturation"
- [ ] Floating button: "Upgrade" si crÃ©dits < 20%
- [ ] Banner temporaire: Promotions (ex: "-50% beta testeurs")

**Dashboard card:**
- Tier actuel + badge couleur
- Graphique usage mensuel (crÃ©dits, sondages)
- Boutons: "Voir les plans" / "Acheter crÃ©dits"

**Menu Settings:**
- Historique facturation
- MÃ©thode de paiement
- Gestion abonnement (upgrade/downgrade/cancel)
- Factures tÃ©lÃ©chargeables PDF

**Fichiers Ã  crÃ©er:**
- [ ] `src/components/dashboard/PlanCard.tsx`
- [ ] `src/components/settings/SubscriptionSettings.tsx`
- [ ] `src/components/ui/FloatingUpgradeButton.tsx`

**PrioritÃ©:** ğŸŸ¢ BASSE - Nice to have, attendre feedback beta

---

### ğŸ”¥ APRÃˆS BÃŠTA - DiffÃ©renciateurs Visuels

#### Graphiques Interactifs Recharts (5-7h) ğŸ“Š DIFFÃ‰RENCIATEUR

**Concept :** Visualisations avancÃ©es pour matrices et comparaisons dates (utilise Recharts dÃ©jÃ  installÃ©)

**PrÃ©requis :** Feedback bÃªta confirmant usage matrices + besoins comparaisons dates

**ImplÃ©mentation (5-7h) :**

**1. Matrices â†’ Heatmap interactive Recharts (3h)**
- [ ] Convertir tableau HTML Matrix en Heatmap Recharts
- [ ] Tooltip interactif au hover (ligne, colonne, valeur, %)
- [ ] Gradient de couleur dynamique (0% blanc â†’ 100% bleu saturÃ©)
- [ ] Export heatmap en PNG/SVG (feature Pro)
- [ ] Tests avec matrices 3x3, 5x5, 10x10

**2. Sondages dates â†’ Stacked Bar Chart (2-3h)**
- [ ] Chart comparatif empilÃ© (yes/maybe/no par date)
- [ ] Axe X dates, axe Y nombre de votes
- [ ] LÃ©gende interactive (toggle segments)
- [ ] Tooltip dÃ©taillÃ© au hover
- [ ] Bouton toggle "Tableau / Graphique"

**3. Dashboard â†’ Graphiques d'Ã©volution (2h - optionnel)**
- [ ] Line chart Ã©volution votes dans le temps
- [ ] RÃ©utilisation ChartContainer/Tooltip existants
- [ ] Affichage conditionnel (>10 votes minimum)

**4. Copier**
- [ ] Copier les graphiques (bouton comme Google Form)
   
**Fichiers concernÃ©s :**
- `src/components/polls/FormPollResults.tsx` - Heatmap matrices
- `src/pages/Results.tsx` - Stacked bars dates
- `src/components/ui/chart.tsx` - DÃ©jÃ  prÃªt (wrapper Recharts)
- `src/lib/chartHelpers.ts` (nouveau) - Transformations donnÃ©es

**RÃ©utilisation :**
- âœ… `ChartContainer`, `ChartTooltip`, `ChartLegend` dÃ©jÃ  codÃ©s
- âœ… Recharts 2.12.7 dÃ©jÃ  installÃ© (0 KB ajoutÃ©)
- âœ… Configuration dark mode existante

**MÃ©triques de dÃ©cision :**
- Si >30% des sondages contiennent matrices â†’ ImplÃ©menter heatmap
- Si >50% des sondages dates ont >5 options â†’ ImplÃ©menter stacked bars
- Sinon â†’ Garder visualisations simples CSS

**PrioritÃ© :** ğŸŸ¡ MOYENNE - Feature premium basÃ©e sur usage rÃ©el

---

#### 2. ğŸ¯ Validation d'Objectifs (1h) âœ… **EN COURS**

**Concept :** IntÃ©gration dans la simulation existante - l'utilisateur dÃ©finit un objectif optionnel, l'IA valide que le questionnaire permet de l'atteindre

**Cas d'usage principal :**
- Utilisateurs crÃ©ant des formulaires **manuellement** (via GUI, pas IA)
- Besoin de valider que leur questionnaire atteint leur objectif
- Safety net pour les crÃ©ations manuelles (pas de guidance IA initiale)

**Approche simplifiÃ©e (1h) :**
- Champ optionnel "Objectif" ajoutÃ© dans l'interface de simulation
- IA analyse les rÃ©sultats simulÃ©s par rapport Ã  l'objectif dÃ©fini
- Rapport enrichi avec section "Validation objectif" si objectif fourni

**Workflow :**
1. Utilisateur crÃ©e formulaire manuellement
2. Lance simulation avec objectif optionnel ("Mesurer satisfaction client")
3. IA simule rÃ©ponses + analyse adÃ©quation questionnaire â†” objectif
4. Rapport affiche : Score alignement + Points forts + Suggestions d'amÃ©lioration

**ImplÃ©mentation :**
- âœ… Champ `objective?: string` dans `SimulationRequest`
- âœ… Prompt Gemini enrichi pour analyser objectif
- âœ… UI : Input "Objectif (optionnel)" dans interface simulation
- âœ… Rapport : Section "Validation objectif" conditionnelle

**PrioritÃ© :** ğŸŸ¢ QUICK WIN - RÃ©utilise infrastructure existante, valeur immÃ©diate

---



#### 6. Sections de questions (1-2h) â³ EN DISCUSSION

**Concept :** Permettre de grouper les questions par thÃ¨mes/sections pour amÃ©liorer la lisibilitÃ©.

**Approche proposÃ©e : Sections intÃ©grÃ©es dans la liste**
- Au lieu de Q1, Q2, Q3... â†’ S1 (Section 1), Q1, Q2, S2 (Section 2), Q3...
- Type `FormItem = FormQuestion | FormSection`
- Boutons "Ajouter question" et "Ajouter section" dans la mÃªme liste
- Sections = cards visuelles avec fond diffÃ©rent + icÃ´ne

**Exemple visuel :**
```
ğŸ“‹ S1. Informations personnelles
    Vos coordonnÃ©es de base

Q1. Nom
Q2. Email

ğŸ’­ S2. Feedback
    Votre avis sur notre service

Q3. Satisfaction (1-5)
Q4. Commentaires
```

**ImplÃ©mentation (1-2h) :**
- [ ] Ajouter type `FormSection` dans `pollStorage.ts`
- [ ] Modifier `FormEditor` pour supporter sections + questions
- [ ] UI : Boutons "Ajouter question" / "Ajouter section"
- [ ] Rendu visuel : Cards sections avec style distinct
- [ ] Mode classique : Sections = sÃ©parateurs visuels
- [ ] Mode multi-step : Afficher titre section au-dessus de la question

**Avantages :**
- âœ… Simple et flexible
- âœ… AmÃ©liore lisibilitÃ© formulaires longs
- âœ… Pas de refonte majeure
- âœ… Compatible avec modes classique ET multi-step

**Statut :** â³ EN DISCUSSION - Attente dÃ©cision utilisateur

---

#### ParamÃ¨tres AvancÃ©s des Formulaires (POST BETA) (8-10h)

**FonctionnalitÃ©s prÃ©vues mais non implÃ©mentÃ©es :**

**ParamÃ¨tres de Base :**
- [ ] Personnalisation titre et description
- [ ] Option afficher/masquer logo DooDates
- [ ] Option afficher temps estimÃ© de complÃ©tion
- [ ] Option afficher nombre de questions

**ParamÃ¨tres AvancÃ©s :**
- [ ] Autoriser rÃ©ponses anonymes (toggle)
- [ ] Connexion requise (compte Google) pour voter
- [ ] Une seule rÃ©ponse par personne (cookie)
- [ ] Autoriser modification aprÃ¨s soumission
- [ ] Deadline configurable (date/heure)
- [ ] Limite nombre de rÃ©ponses (illimitÃ© ou max)

**Email confirmation :**
- [ ] Checkbox "Recevoir une copie par email"
- [ ] Input email conditionnel (visible si checkbox)
- [ ] Envoi email avec rÃ©capitulatif des rÃ©ponses

**VisibilitÃ© des RÃ©sultats :**
- [ ] Mode "CrÃ©ateur uniquement"
- [ ] Mode "Participants aprÃ¨s vote"
- [ ] Mode "Public (tout le monde)"
- [ ] UI radio buttons pour choisir la visibilitÃ©
- [ ] ContrÃ´le d'accÃ¨s dans page rÃ©sultats

**PrioritÃ© :** ğŸŸ¡ MOYENNE - Features importantes mais pas bloquantes pour beta
**Voir aussi :** Section "AccÃ¨s aux rÃ©sultats FormPoll + Email confirmation" pour implÃ©mentation partielle

---

#### AccÃ¨s aux rÃ©sultats FormPoll + Email confirmation (6h30)

**ProblÃ¨me actuel :**
- âŒ Bouton "Voir les rÃ©sultats" affichÃ© mais accÃ¨s refusÃ© (frustrant)
- âŒ Pas de contrÃ´le pour le crÃ©ateur sur qui peut voir les rÃ©sultats
- âŒ Pas de copie des rÃ©ponses par email pour le votant

**Solution :** Voir documentation utilisateur `USER-DOCUMENTATION/04-Formulaires-Questionnaires.md` et `USER-DOCUMENTATION/06-Gestion-Resultats.md`.

**1. VisibilitÃ© des rÃ©sultats (2h30)**
- [ ] Ajouter champ `resultsVisibility` dans interface `Poll` (3 modes : creator-only, voters, public)
- [ ] CrÃ©er UI radio buttons dans `FormPollCreator.tsx` pour choisir la visibilitÃ©
- [ ] ImplÃ©menter helpers `getCurrentUserId()` et `checkIfUserHasVoted()`
- [ ] Ajouter contrÃ´le d'accÃ¨s dans `FormPollResults.tsx` (vÃ©rifier permissions)
- [ ] Modifier Ã©cran post-vote pour afficher bouton conditionnel "Voir les rÃ©sultats"
- [ ] Afficher message explicatif si accÃ¨s refusÃ©

**2. Email de confirmation (3h)**
- [ ] Ajouter champ `respondentEmail` dans interface `FormResponse`
- [ ] CrÃ©er checkbox "Recevoir une copie par email" dans `FormPollVote.tsx`
- [ ] Ajouter input email conditionnel (visible si checkbox cochÃ©e)
- [ ] Modifier `addFormResponse()` pour stocker l'email
- [ ] CrÃ©er service `EmailService.ts` avec fonction `sendVoteConfirmationEmail()`
- [ ] CrÃ©er template HTML email avec rÃ©capitulatif des rÃ©ponses
- [ ] IntÃ©grer appel service aprÃ¨s soumission (console.log MVP, Resend API en Phase 2)

**3. Tests manuels (1h)**
- [ ] Tester mode "creator-only" : VÃ©rifier accÃ¨s refusÃ© pour non-crÃ©ateur
- [ ] Tester mode "voters" : Voter puis vÃ©rifier accÃ¨s autorisÃ© aux rÃ©sultats
- [ ] Tester mode "public" : VÃ©rifier accÃ¨s sans voter
- [ ] Tester email : Voter avec email et vÃ©rifier console.log
- [ ] VÃ©rifier UX complÃ¨te : Vote â†’ Email â†’ RÃ©sultats

**Fichiers modifiÃ©s :**
- `src/lib/pollStorage.ts` - Types + helpers
- `src/components/polls/FormPollCreator.tsx` - UI visibilitÃ©
- `src/components/polls/FormPollResults.tsx` - ContrÃ´le d'accÃ¨s
- `src/components/polls/FormPollVote.tsx` - Email + bouton conditionnel
- `src/services/EmailService.ts` - Service email (nouveau fichier)

**Impact utilisateur :**
- âœ… Transparence : Le crÃ©ateur contrÃ´le la visibilitÃ©
- âœ… Confiance : Le votant reÃ§oit ses rÃ©ponses par email
- âœ… Pas de frustration : Bouton "Voir rÃ©sultats" fonctionne correctement

---

#### Analytics Anonymes Simulation (3h) ğŸ¯ AMÃ‰LIORATION CONTINUE

**Concept :** Collecter mÃ©triques anonymes des simulations pour amÃ©liorer les benchmarks

**Valeur ajoutÃ©e :**
- **Benchmarks temps rÃ©el DooDates** vs moyennes industrie gÃ©nÃ©riques
- Comparaison pertinente : "Votre questionnaire : 20% abandon (moyenne DooDates : 28%)"
- AmÃ©lioration continue des seuils de dÃ©tection
- DiffÃ©renciateur compÃ©titif (SurveyMonkey ne fait pas Ã§a)

**Architecture :**
```typescript
// MÃ©triques anonymes (aucune donnÃ©e identifiable)
interface SimulationMetricsAnonymous {
  context: SimulationContext;
  questionCount: number;
  avgCompletionRate: number;
  avgTotalTime: number;
  avgDropoffRate: number;
  questionTypes: Record<string, number>;
  timestamp: Date;
}
```

**ImplÃ©mentation (3h) :**
1. **Service Analytics** (1h)
   - Fonction `trackSimulationMetrics(result)` anonyme
   - Envoi vers Supabase (table `simulation_metrics_anonymous`)
   - Aucune donnÃ©e identifiable (pas de pollId, userId, questions, rÃ©ponses)
   
2. **Service Benchmarks** (1h)
   - Fonction `getBenchmarks(context, questionCount)`
   - Calcul moyennes sur 30 derniers jours
   - Cache 24h pour performances
   - AgrÃ©gation par contexte et nombre de questions
   
3. **UI Comparaison** (1h)
   - Afficher benchmarks dans SimulationReport
   - Section "Votre questionnaire vs moyenne DooDates"
   - Indicateurs visuels (meilleur/moins bon que moyenne)

**ConformitÃ© RGPD :** âœ… 100% OK
- Aucune donnÃ©e personnelle
- Aucun identifiant
- AgrÃ©gation uniquement
- Opt-out possible dans settings

**PrÃ©requis :** Phase 1 Simulation IA terminÃ©e + retours utilisateurs

**PrioritÃ© :** ğŸŸ¡ MOYENNE - AmÃ©lioration aprÃ¨s validation MVP

---

#### Export PDF Rapport Simulation (1h) ğŸ’¼ PRO

**Concept :** Exporter le rapport de simulation en PDF (feature Pro uniquement)

**Valeur ajoutÃ©e :**
- **Partage** : Envoyer le rapport Ã  l'Ã©quipe
- **Documentation** : Garder trace des tests
- **Professionnalisme** : Format standard pour entreprises
- **MonÃ©tisation** : Feature Pro exclusive

**Contenu PDF :**
- MÃ©triques globales (complÃ©tion, temps, abandon)
- Liste des problÃ¨mes dÃ©tectÃ©s avec recommandations
- CoÃ»t estimÃ© de la simulation
- Branding DooDates

**ImplÃ©mentation (1h) :**
- RÃ©utiliser logique export PDF existante (FormPollResults)
- Template HTML pour rapport simulation
- GÃ©nÃ©ration PDF cÃ´tÃ© client (window.print)
- Bouton "Exporter PDF" dans SimulationReport (dÃ©jÃ  prÃ©sent, Ã  activer)

**PrÃ©requis :** Phase 1 Simulation IA terminÃ©e

**PrioritÃ© :** ğŸŸ¢ BASSE - Nice to have, pas bloquant pour MVP

---

#### File & Media Support (5-8h) ğŸ’¼ OPPORTUNITÃ‰ B2B

**Concept :** Upload fichiers pour gÃ©nÃ©ration intelligente de questions

**Valeur ajoutÃ©e :**
- Cas d'usage B2B : "Upload brief client â†’ questionnaire gÃ©nÃ©rÃ©"
- DiffÃ©renciation vs SurveyMonkey (qui n'a pas Ã§a)
- CoÃ»t technique faible (pas de stockage permanent)
- AccÃ©lÃ¨re crÃ©ation pour utilisateurs pros

**FonctionnalitÃ©s :**
- Upload PDF/CSV/DOCX (+ images avec OCR ?)
- IA extrait contexte et gÃ©nÃ¨re questions
- Exemple : Upload "Satisfaction Client Q3.pdf" â†’ IA gÃ©nÃ¨re questionnaire adaptÃ©
- Traitement temporaire uniquement (pas de stockage)

**ğŸ“‹ TODO :**
- Formats supportÃ©s (PDF/DOCX/CSV suffisants ? Images ?)
- Limite taille (5MB ? 10MB ?)
- Traitement (extraction texte puis prompt Gemini classique)

**PrioritÃ© :** ğŸŸ¡ MOYENNE - OpportunitÃ© B2B Ã  valider

---

### Phase 3 (Mois 4-6+) : IA Temps RÃ©el - 20-25h
**Objectif :** Analyse continue nÃ©cessitant volume de donnÃ©es

#### 5. ğŸ“ˆ Analyse Temporelle Continue (20-25h)

**Concept :** L'IA analyse l'Ã©volution des rÃ©ponses en temps rÃ©el pendant la collecte

**Valeur ajoutÃ©e :**
- DÃ©tection prÃ©coce de problÃ¨mes (baisse taux rÃ©ponse, tendances nÃ©gatives)
- Optimisation campagnes en cours
- Valeur surtout pour entreprises avec volume (500+ rÃ©ponses/poll)

**FonctionnalitÃ©s :**
- Snapshots automatiques Ã  intervalles configurables
- DÃ©tection de tendances ("RÃ©ponses nÃ©gatives +15% depuis hier")
- Alertes intelligentes (baisse taux rÃ©ponse, tendances nÃ©gatives)
- Analyse comparative temporelle (Semaine 1 vs Semaine 2)

**ğŸ“‹ TODO :** DÃ©finir frÃ©quences snapshot, seuils d'alerte, types de tendances
â†’ Voir document SurveyMonkey section 10.4 pour cas d'usage dÃ©taillÃ©s

**PrioritÃ© :** ğŸŸ¢ BASSE - NÃ©cessite volume, infrastructure lourde, valeur B2B uniquement

**Note :** Garder en Phase 3 ou post-lancement selon adoption

---

### ğŸ’° NOUVEAU SYSTÃˆME QUOTAS & PRICING (PRIORITAIRE)

### ğŸ”’ SÃ‰CURISATION QUOTAS & PROTECTION ANTI-ABUS (CRITIQUE)

**Date analyse :** 03 Novembre 2025  
**ProblÃ¨me identifiÃ© :** SystÃ¨me actuel vulnÃ©rable aux abus (localStorage + clÃ© API exposÃ©e)

#### âš ï¸ FAILLES ACTUELLES

**1. Quotas localStorage (cÃ´tÃ© client uniquement)**
- âŒ Stockage dans `localStorage.getItem('doodates_ai_quota')`
- âŒ Bypass trivial : `localStorage.setItem('doodates_ai_quota', JSON.stringify({aiMessagesUsed: 0}))`
- âŒ Mode navigation privÃ©e = nouveau quota Ã  chaque fois
- âŒ Pas de vÃ©rification serveur avant appel Gemini API

**2. ClÃ© API Gemini exposÃ©e**
- âŒ `VITE_GEMINI_API_KEY` dans le bundle client (visible par tous)
- âŒ Extraction possible : DevTools â†’ Sources â†’ Rechercher "GEMINI_API_KEY"
- âŒ Utilisation directe de la clÃ© pour appels illimitÃ©s
- âŒ CoÃ»t illimitÃ© possible pour vous

**3. Impact financier**
- 1 utilisateur malveillant = 10 000+ appels API/mois
- CoÃ»t estimÃ© : 50-100â‚¬/mois par abus
- Risque : faillite si plusieurs abus simultanÃ©s

#### âœ… SOLUTION : ARCHITECTURE SÃ‰CURISÃ‰E

**Principe :** Toute vÃ©rification de quota + appel API doit passer par serveur (Supabase Edge Function)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CLIENT (React)                          â”‚
â”‚ âŒ Plus de clÃ© API Gemini              â”‚
â”‚ âŒ Plus de vÃ©rification quota locale   â”‚
â”‚ âœ… Token JWT Supabase (authentifiÃ©)     â”‚
â”‚ âœ… Tous appels â†’ Edge Function          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SUPABASE EDGE FUNCTION (/api/chat)       â”‚
â”‚ âœ… VÃ©rifie JWT (auth.uid())              â”‚
â”‚ âœ… VÃ©rifie quota DB (transaction atomique)â”‚
â”‚ âœ… Consomme crÃ©dit avant appel API       â”‚
â”‚ âœ… ClÃ© Gemini = variable serveur (safe)  â”‚
â”‚ âœ… Rate limiting userId + IP             â”‚
â”‚ âœ… Logs audit (qui a fait quoi)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GEMINI API                               â”‚
â”‚ âœ… ClÃ© jamais exposÃ©e au client          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ImplÃ©mentation :**

**Backend (Supabase Edge Function):**
- [ ] CrÃ©er `/supabase/functions/check-quota-and-chat/index.ts`
- [ ] VÃ©rifier JWT : `const userId = await verifyJWT(request)`
- [ ] VÃ©rifier quota DB : `SELECT credits_remaining FROM user_quotas WHERE user_id = $1 FOR UPDATE`
- [ ] Consommer atomiquement : `UPDATE user_quotas SET credits_remaining = credits_remaining - 1`
- [ ] Appeler Gemini API (clÃ© dans `Deno.env.get('GEMINI_API_KEY')`)
- [ ] Retourner rÃ©ponse uniquement si succÃ¨s
- [ ] Rate limiting : 100 messages/heure par userId, 20/heure par IP (invitÃ©s)

**Frontend :**
- [ ] Supprimer `VITE_GEMINI_API_KEY` du `.env`
- [ ] Modifier `GeminiChatInterface.tsx` : appeler Edge Function au lieu de Gemini directement
- [ ] GÃ©rer erreurs quota (affichage modal upgrade)
- [ ] Cache localStorage = UI uniquement (pas source de vÃ©ritÃ©)

**Protection additionnelle :**
- [ ] Rate limiting par IP (Cloudflare/Vercel) : 100 req/h pour invitÃ©s
- [ ] DÃ©tection anomalies : alerte si > 50 crÃ©dits/heure par userId
- [ ] Restrictions Gemini (Google Cloud) : quota max 1000 req/jour par clÃ©
- [ ] Rotation clÃ©s API : changer si compromis

#### ğŸ›¡ï¸ DÃ‰FENSE EN PROFONDEUR

**Couche 1 : Authentification**
- JWT Supabase obligatoire (expiration 15 min)
- Impossible d'appeler Edge Function sans compte valide

**Couche 2 : Quotas en DB (source de vÃ©ritÃ©)**
- Transaction atomique (FOR UPDATE) = pas de race condition
- VÃ©rification + consommation = une seule opÃ©ration

**Couche 3 : Rate limiting**
- Par userId : 100 messages/heure (authentifiÃ©), 20/heure (invitÃ©)
- Par IP : 100 req/heure (protection anti-multi-comptes)

**Couche 4 : Monitoring**
- Logs toutes les requÃªtes (userId, timestamp, crÃ©dits consommÃ©s)
- Alertes si usage suspect (> 50 crÃ©dits/heure)

**Couche 5 : Restrictions API externe**
- Quotas Gemini dans Google Cloud Console
- Alertes si dÃ©passement

#### ğŸ“Š COÃ›TS MAÃTRISÃ‰S

**Avec sÃ©curisation :**
- 1 utilisateur gratuit = max 20 crÃ©dits/mois = 0.01â‚¬
- 1 utilisateur Premium = max 100 crÃ©dits/mois = 0.05â‚¬
- Protection contre abus = impossible de bypass

**Sans sÃ©curisation :**
- 1 utilisateur malveillant = illimitÃ© = 50-100â‚¬/mois
- Risque : faillite

#### âœ… OFFRE GRATUITE AVEC SÃ‰CURISATION

**StratÃ©gie :** Maintenir offre gÃ©nÃ©reuse (20 crÃ©dits/mois) car :
- âœ… Quotas vÃ©rifiÃ©s cÃ´tÃ© serveur (impossible bypass)
- âœ… Rate limiting protÃ¨ge contre abus massifs
- âœ… CoÃ»t maÃ®trisÃ© mÃªme avec quelques abus isolÃ©s
- âœ… Conversion optimisÃ©e (offre gÃ©nÃ©reuse = meilleure adoption)

**Quotas proposÃ©s :**
- **Gratuit :** 20 crÃ©dits/mois (â‰ˆ 0.01â‚¬/mois)
- **Premium :** 100 crÃ©dits/mois (â‰ˆ 0.05â‚¬/mois)
- **Pro :** 1000 crÃ©dits/mois (â‰ˆ 0.50â‚¬/mois)

**Protection invitÃ©s (sans compte) :**
- Rate limiting strict : 10 messages max par IP/jour
- Forcer authentification aprÃ¨s 5 messages
- CoÃ»t nÃ©gligeable : 5 Ã— 0.0005â‚¬ = 0.0025â‚¬/visiteur

**Risques rÃ©siduels acceptables :**
- Utilisateurs trÃ¨s techniques (reverse engineering) = coÃ»t maÃ®trisÃ© par rate limiting
- Attaques coordonnÃ©es = dÃ©tectables via monitoring
- Comparaison : mÃªme Netflix/GitHub ont des contournements (objectif = rendre abus non rentable)

#### ğŸ“‹ CHECKLIST SÃ‰CURISATION

**Phase 1 : Migration Edge Function (1 jour)** âœ… COMPLÃ‰TÃ‰
- [x] CrÃ©er Edge Function `/check-quota-and-chat`
- [x] DÃ©placer clÃ© Gemini â†’ variable serveur
- [x] ImplÃ©menter vÃ©rification quota DB
- [x] Tester consommation atomique

**Phase 2 : Migration frontend (4h)** âœ… COMPLÃ‰TÃ‰
- [x] Modifier `GeminiService` â†’ appeler Edge Function
- [x] Supprimer `VITE_GEMINI_API_KEY` du client
- [x] GÃ©rer erreurs quota (modals)

**Phase 3 : Rate limiting (2h)** âœ… COMPLÃ‰TÃ‰
- [x] ImplÃ©menter rate limiting userId (Edge Function)
- [x] ImplÃ©menter rate limiting IP (Edge Function)
- [x] Tester limites

**Phase 4 : Monitoring (2h)** âœ… COMPLÃ‰TÃ‰
- [x] Logs audit dans Edge Function
- [ ] Dashboard monitoring (Supabase logs) - Optionnel
- [ ] Alertes anomalies (email/webhook) - Optionnel

**Tests :**
- [x] Tentative bypass localStorage (doit Ã©chouer) - âœ… VÃ©rifiÃ© cÃ´tÃ© serveur
- [x] Tentative extraction clÃ© API (doit Ãªtre impossible) - âœ… ClÃ© cÃ´tÃ© serveur uniquement
- [x] Test rate limiting (blocage aprÃ¨s limite) - âœ… ImplÃ©mentÃ©
- [x] Test consommation atomique (pas de race condition) - âœ… FOR UPDATE dans SQL

**DÃ©ploiement :**
- [x] Edge Function crÃ©Ã©e et prÃªte
- [x] Script SQL crÃ©Ã©
- [x] Documentation complÃ¨te


---

### Phase 3: SystÃ¨me CrÃ©dits UnifiÃ©s (3 jours)

**Objectif:** Remplacer quotas sÃ©parÃ©s par crÃ©dits IA unifiÃ©s en DB

**Backend (Supabase):**
- [ ] Migration SQL: Table `user_quotas`
  ```sql
  - tier (free, premium, pro, beta)
  - plan (monthly, annual)
  - credits_total (20, 100, 1000, 1000)
  - credits_used
  - credits_remaining
  - max_polls (20, 100, unlimited, unlimited)
  - period_start, period_end, reset_date
  ```
- [ ] Function `consume_credits(user_id, amount)` avec transaction
- [ ] Function `reset_monthly_quotas()` + cron job (1er du mois)
- [ ] Function `check_and_expire_beta_keys()` + cron job (quotidien)
- [ ] RLS policies (user voit uniquement ses quotas)
- [ ] Index performance (user_id, tier)

**Migration donnÃ©es:**
- [ ] Script conversion localStorage â†’ Supabase
- [ ] Mapping ancien systÃ¨me:
  ```
  aiMessages + analyticsQueries + (simulations Ã— 5) = crÃ©dits
  ```
- [ ] Bonus 20% goodwill pour utilisateurs existants
- [ ] Grace period 30 jours (ancien systÃ¨me actif en parallÃ¨le)

**Frontend:**
- [ ] Service `QuotaService.ts` (getQuota, consumeCredits, purchasePack)
- [ ] Hook `useCredits()` unifiÃ© (remplace useAiMessageQuota, useAnalyticsQuota)
- [ ] Modifier consommation dans:
  - `GeminiChatInterface.tsx`: 1 crÃ©dit/message
  - `PollAnalyticsPanel.tsx`: 1 crÃ©dit/query + 1 crÃ©dit/insight
  - `SimulationService.ts`: 5 crÃ©dits/simulation
- [ ] Indicateur TopBar: "42/100 crÃ©dits âš¡" avec tooltip dÃ©tails
- [ ] Modal `QuotaReachedModal.tsx`:
  - Tier actuel + usage
  - Recommandation (pack crÃ©dits vs upgrade)
  - Boutons CTA (Acheter pack / Voir plans)
- [ ] Page `/pricing` avec comparaison tiers

**Tests:**
- [ ] Consommation crÃ©dits (chat, analytics, simulation)
- [ ] Blocage Ã  0 crÃ©dits
- [ ] Reset mensuel (simulation date)
- [ ] Rollover annuel (simulation)
- [ ] Performance: 100 users simultanÃ©s consommant crÃ©dits

---

### Phase 4: UI Pricing & Conversion (2 jours)

**Page Pricing (`/pricing`):** âœ… CRÃ‰Ã‰
- [X] Composant `PricingPage.tsx`
- [X] Toggle Monthly/Annual avec badge Ã©conomie
- [X] 3 cards tiers (Gratuit, Premium, Pro)
- [X] Section Beta Testeurs (comment rejoindre)
- [X] Comparaison features (tableau)
- [X] FAQ pricing (6 questions)
- [X] CTA final "Commencer gratuitement"
- [X] Responsive mobile + Dark mode
- [X] Route `/pricing` configurÃ©e

**Modal Upgrade in-app:**
- [ ] Trigger automatique Ã  100% quota
- [ ] Afficher tier actuel + recommandation personnalisÃ©e
- [ ] Boutons:
  - "Voir les plans" â†’ /pricing
  - "Acheter pack crÃ©dits" â†’ Modal achat
  - "Plus tard" â†’ Fermer (re-trigger dans 7 jours)
- [ ] Tracking analytics (ouverture, clics, conversion)

**Packs crÃ©dits (Phase 2 - aprÃ¨s Stripe):**
- [ ] Modal `CreditPackPurchase.tsx`
- [ ] 3 packs (50/3â‚¬, 100/5â‚¬, 500/20â‚¬)
- [ ] Integration Stripe Checkout
- [ ] Confirmation email avec rÃ©cap
- [ ] Ajout crÃ©dits immÃ©diat aprÃ¨s paiement
- [ ] ValiditÃ© 6 mois (tracking expiration)

---

### Phase 5: Programme Beta Testeurs (1 semaine)

**Recrutement (20 testeurs):**
- [ ] Formulaire candidature Google Forms
- [ ] Posts recrutement:
  - [ ] Reddit r/SideProject, r/productivity
  - [ ] LinkedIn (post personnel)
  - [ ] Twitter/X thread
  - [ ] RÃ©seau personnel (10 clÃ©s rÃ©servÃ©es)
- [ ] SÃ©lection profils (diversitÃ© usage, engagement)
- [ ] GÃ©nÃ©ration 20 clÃ©s beta
- [ ] Email bienvenue avec clÃ© + instructions

**Setup infrastructure:**
- [ ] Discord serveur privÃ© beta
- [ ] Canaux: #annonces, #bugs, #feedback, #showcase
- [ ] RÃ´le "Beta Tester" automatique
- [ ] Bot notifications (nouveau bug, feedback)

**Suivi engagement:**
- [ ] Questionnaire Semaine 1 (premiÃ¨re impression)
- [ ] Questionnaire Semaine 4 (mi-parcours)
- [ ] Questionnaire Semaine 8 (feedback dÃ©taillÃ©)
- [ ] Questionnaire Semaine 12 (final + testimonials)
- [ ] Interviews 1-on-1 avec 5 power users
- [ ] Calendrier relances (inactifs > 7 jours)

**MÃ©triques tracking:**
- [ ] Dashboard admin: Usage beta testeurs
- [ ] Sondages crÃ©Ã©s (objectif: 100+ collectif)
- [ ] Bugs reportÃ©s (objectif: 50+)
- [ ] Feedback score moyen (objectif: 4+/5)
- [ ] Testimonials collectÃ©s (objectif: 10+)

**Conversion post-beta:**
- [ ] Email J-7: "Votre bÃªta se termine bientÃ´t"
- [ ] Email J-0: "Offre exclusive: Premium 50% off (4.50â‚¬/mois, 6 mois)"
- [ ] Badge permanent "Early Supporter" si upgrade
- [ ] Conversion auto tier beta â†’ free si pas d'upgrade

---

### Documentation

- [ ] `Docs/USER-DOCUMENTATION/18-QUOTAS-PRICING-FINAL.md` âœ… CRÃ‰Ã‰
- [ ] Update `Docs/USER-DOCUMENTATION/14-FAQ.md` (section quotas)
- [ ] Update `Docs/USER-DOCUMENTATION/06-Analytics-IA.md` (nouveaux quotas)
- [ ] CrÃ©er `Docs/BETA-TESTER-GUIDE.md` (guide complet beta testeurs)
- [ ] Update README.md (mention programme beta)

---

### Checklist Lancement Beta

**Technique:**
- [ ] Tables DB (user_quotas, beta_keys)
- [ ] SystÃ¨me clÃ©s fonctionnel
- [ ] 20 clÃ©s gÃ©nÃ©rÃ©es et testÃ©es
- [ ] Mode invitÃ© (5 crÃ©dits)
- [ ] SystÃ¨me crÃ©dits unifiÃ©s dÃ©ployÃ©
- [ ] Badge Beta visible
- [ ] Page /pricing live
- [ ] Discord beta crÃ©Ã©

**Communication:**
- [ ] Email template bienvenue beta
- [ ] Formulaire candidature
- [ ] Posts recrutement publiÃ©s
- [ ] Page `/beta` expliquant programme
- [ ] Questionnaires prÃ©parÃ©s

**Suivi:**
- [ ] Analytics tracking (activation clÃ©s, usage, conversion)
- [ ] Dashboard admin beta testeurs
- [ ] Alertes (bugs critiques, inactivitÃ©)
- [ ] Scripts support (FAQ beta)

**Total:** ~8 jours + 1 semaine recrutement/suivi  
**PrioritÃ©:** ğŸ”¥ CRITIQUE (permet lancement beta sans limitations)  
**CoÃ»t:** 20 testeurs Ã— $0.50/mois = $10/mois (ROI: testimonials + feedback + conversions)

---

## PRE LANCEMENT

### Technique

####Configuration Supabase pour lancement :
  - [ ] Activer "Enable email confirmations" dans Supabase Dashboard â†’ Authentication â†’ Settings (sÃ©curitÃ© production)
  - [ ] VÃ©rifier que les emails de confirmation sont bien envoyÃ©s
  - [ ] Voir `SUPABASE-SETUP-GUIDE.md` section "5. Configurer l'Email Confirmation"

#### Timezone (2h)
- **QUESTION** : choix de la timezone ? Comment cela se passe actuellement et dans un contexte internationale, comment faire cela au mieux ?
    - Ajouter choix timezone lors de la crÃ©ation
    - Stocker timezone: "Europe/Paris" dans les polls
    - Afficher indication "Horaires en heure de Paris"
    - Utiliser date-fns-tz pour conversion

#### Authentication & Security
- **Sans Compte Owner Token** (voir @Sans-Compte-OwnerToken.md)
- **AccessibilitÃ©** (Ã©diteur + vote) : Focus management, aria labels
- **Performance** : Rendre uniquement la question active (dÃ©jÃ  fait), virtualisation si > 20 questions

#### Google Services Integration (10-15h)
**Objectif :** IntÃ©gration complÃ¨te Ã©cosystÃ¨me Google

**Composants :**

**1. Google OAuth 2.0 (base) - 4h**
- Flow frontend/backend
- Tokens management (stockage, refresh)
- Scopes permissions

**2. Google Sheets API Export - 8-12h**
- Export direct vers Sheets via API officielle
- CrÃ©ation spreadsheet automatique
- Remplissage donnÃ©es structurÃ©es
- Gestion rate limits (300 req/min)

**3. Calendar Integration (optionnel) - 2-3h**
- Auto-suggestion aprÃ¨s sÃ©lection dates
- Connexion calendrier (Google Calendar API)
- Interface discrÃ¨te et optionnelle

**Architecture :**
- Backend Node.js pour gestion tokens
- googleapis SDK
- Rate limiting + error handling

**Note :** Base OAuth rÃ©utilisable pour tous les services Google

#### Deployment & Operations (POST BETA)
**PrioritÃ© :** ğŸŸ¡ MOYENNE - Ã€ faire aprÃ¨s validation bÃªta

- [ ] **DÃ©ploiement Vercel production** (1h)
   - [ ] Migration GitHub Pages â†’ Vercel (si nÃ©cessaire)
   - [ ] Configuration domain personnalisÃ© (doodates.com) (30min)
   - [ ] Setup variables d'environnement Vercel
   - [ ] Tests smoke en production Vercel

- [ ] **Monitoring & Analytics** (2h)
   - [ ] Setup Sentry pour monitoring erreurs (1h)
   - [ ] Analytics & Tracking (Plausible/Posthog) (1h)
   - [ ] Dashboard monitoring centralisÃ©

**Note :** Pour la bÃªta privÃ©e, GitHub Pages + Supabase suffisent. Migration Vercel/domain aprÃ¨s validation produit.

- **CI/CD Pipeline** : Tests automatisÃ©s, branch protection, deployment automation (dÃ©jÃ  en place)

---

### Business & Marketing

#### StratÃ©gie Tarifaire

**RÃ©fÃ©rence pricing Doodle (03/11/2025) :**
- Free : â‚¬0
- Pro : â‚¬6.95/user/mois (annuel)
- Team : â‚¬8.95/user/mois (annuel)

**DÃ©cision :**
- âœ… **Premium = 6.95â‚¬/mois** (au lieu de 9â‚¬) â†’ AlignÃ© Doodle Pro pour fonctionnalitÃ©s de base (sondages de dates)
- âœ… **IA = bonus inclus** (pas de surcoÃ»t) â†’ DiffÃ©renciateur unique
- âœ… **Pro = 29â‚¬/mois** â†’ Ã‰quivalent Team Doodle (3 users) + IA avancÃ©e

**Positionnement :** MÃªme prix que Doodle pour fonctionnalitÃ©s de base, IA en bonus.

**Avantages vs Doodle :** MÃªme prix base + IA incluse + Analytics IA + Formulaires avancÃ©s + Export illimitÃ©

**Voir aussi :** Section "Avantages CompÃ©titifs vs SurveyMonkey" pour diffÃ©renciateurs complets.


#### Plan d'Acquisition

**Objectif :** Atteindre les 100 premiers utilisateurs

> **ğŸ“„ Voir :** [`INTERNATIONAL-LAUNCH-STRATEGY.md`](./INTERNATIONAL-LAUNCH-STRATEGY.md) section "Go-to-Market" pour guide Product Hunt dÃ©taillÃ©

**Canaux :**
- Landing page optimisÃ©e (SEO, conversion) : https://seobotai.com/
- Product Hunt launch
- Reddit outreach (r/productivity, r/SideProject)
- Personal network
- Social media (LinkedIn, Twitter) : https://www.makeugc.ai/
- Email ? https://mailtrap.io/pricing/
---

## LAUNCH

### Launch Day (Jour 0)
- [ ] Product Hunt launch
- [ ] Reddit posts (r/productivity, r/SideProject)
- [ ] Personal network outreach
- [ ] Social media annonce

### Post-Launch (Semaine 1-4)
- [ ] Daily monitoring (analytics + Sentry)
- [ ] RÃ©pondre feedback utilisateurs
- [ ] ItÃ©rations rapides (bugs + quick wins)
- [ ] MÃ©triques de succÃ¨s: 50-100 users, 10+ polls created

## APRES LANCEMENT

### Tests Gemini AutomatisÃ©s - Phase 3 (POST LANCEMENT) â³
          - **Tests Simulation IA** - 5 tests
          - Simulation avec objectif dÃ©fini
          - Validation rÃ©sultats simulÃ©s atteignent objectif
          - DÃ©tection problÃ¨mes dans questionnaire
          - **Estimation :** 2-3h


### Phase 3.5 (Mois 3-6) : Tests Performance AvancÃ©s ğŸ¯

**DÃ©clencheur :** AprÃ¨s validation bÃªta, besoin de garantir performance Ã  l'Ã©chelle

**Objectif :** ImplÃ©menter des tests de performance automatisÃ©s avec mÃ©triques prÃ©cises pour dÃ©tecter les rÃ©gressions et garantir la scalabilitÃ©.

#### Tests Performance Dashboard (8-12h)

**Contexte :** Les tests actuels (60-65) vÃ©rifient la stabilitÃ© mais pas les mÃ©triques prÃ©cises. Phase d'implÃ©mentation de tests automatisÃ©s avec seuils mesurables.

**1. Lighthouse CI Integration (4-6h)**
- [ ] Setup Lighthouse CI dans GitHub Actions
- [ ] Configuration thresholds (Performance > 90, LCP < 2.5s, FID < 100ms)
- [ ] **Workflow :** `.github/workflows/lighthouse.yml` (nouveau)
  - [ ] ExÃ©cution sur schedule (quotidien, ex: 3h du matin UTC)
  - [ ] ExÃ©cution manuelle possible via `workflow_dispatch`
  - [ ] Pas d'exÃ©cution sur PR (Ã©vite ralentir les validations)
  - [ ] CrÃ©ation issue GitHub si rÃ©gression > 10%
- [ ] Dashboard avec historique des mÃ©triques
- [ ] Alertes Slack/Email en cas de rÃ©gression

**2. Tests Performance E2E avec MÃ©triques (4-6h)**
- [ ] **Workflow :** `6-nightly-regression.yml` (job dÃ©diÃ© `e2e-performance`)
  - [ ] ExÃ©cution nocturne (2h du matin UTC, mÃªme schedule que regression)
  - [ ] Tests trÃ¨s longs (10-15 min) â†’ mieux dans workflow nightly
  - [ ] ExÃ©cution manuelle possible via `workflow_dispatch`
  - [ ] CrÃ©ation issue GitHub si rÃ©gression > 20%
- [ ] Utiliser `performance-measurement.ts` existant dans les tests E2E
- [ ] Test 61 amÃ©liorÃ© : Mesurer temps chargement dashboard avec 50+ conversations
  - Seuil : < 2s pour 50 conversations, < 5s pour 200 conversations
  - Mesurer LCP (Largest Contentful Paint), FCP (First Contentful Paint)
- [ ] Test 62 amÃ©liorÃ© : Mesurer temps ouverture menu tags avec 20+ tags
  - Seuil : < 500ms pour ouverture menu
  - Mesurer temps de scroll et frame rate
- [ ] Test 63 amÃ©liorÃ© : Mesurer temps ouverture menu dossiers avec 20+ dossiers
  - Seuil : < 500ms pour ouverture menu
  - Mesurer temps de scroll et frame rate
- [ ] Tests de charge progressifs : 10, 50, 100, 200 conversations
- [ ] GÃ©nÃ©ration de rapports de performance (JSON/HTML)

**3. Web Vitals Monitoring (2-3h)**
- [ ] IntÃ©gration Web Vitals API dans l'app
- [ ] Envoi mÃ©triques vers Supabase/Analytics
- [ ] Dashboard monitoring temps rÃ©el (p50, p75, p95)
- [ ] Alertes si dÃ©gradation > 20% sur 7 jours
- [ ] **Note :** Monitoring en production uniquement (pas de workflow CI)

**Fichiers Ã  crÃ©er/modifier :**
- [ ] `tests/e2e/dashboard-performance.spec.ts` - Tests avec mÃ©triques prÃ©cises
- [ ] `.github/workflows/lighthouse.yml` - **Nouveau workflow Lighthouse CI (schedule quotidien)**
- [ ] Modifier `.github/workflows/6-nightly-regression.yml` - Ajouter job `e2e-performance` (tests longs)
- [ ] `src/lib/web-vitals-tracker.ts` - Tracking Web Vitals (production)
- [ ] `src/lib/performance-benchmarks.ts` - Seuils et comparaisons

**MÃ©triques cibles :**
- **Dashboard chargement :** < 2s (50 conversations), < 5s (200 conversations)
- **Lighthouse Performance :** > 90
- **LCP (Largest Contentful Paint) :** < 2.5s
- **FID (First Input Delay) :** < 100ms
- **CLS (Cumulative Layout Shift) :** < 0.1
- **Menu tags/dossiers :** < 500ms ouverture
- **Scroll 60fps** : Frame rate stable lors du scroll

**Outils recommandÃ©s :**
- Lighthouse CI (GitHub Actions)
- Playwright Performance API (`page.metrics()`)
- Web Vitals library (Google)
- Performance Observer API

**PrioritÃ© :** ğŸŸ¡ MOYENNE - Important pour scalabilitÃ© mais pas bloquant bÃªta
**Note :** Les tests de stabilitÃ© actuels (60-65) sont suffisants pour la bÃªta. Cette phase ajoute des mÃ©triques prÃ©cises pour garantir performance Ã  l'Ã©chelle.

---

### Phase 4 (Mois 6-9) : MonÃ©tisation
**DÃ©clencheur :** 500+ utilisateurs actifs

#### Payment System & Monetization (10-15h)
> **ğŸ“„ Voir :** [`INTERNATIONAL-LAUNCH-STRATEGY.md`](./INTERNATIONAL-LAUNCH-STRATEGY.md) pour dÃ©cision Merchant of Record (Lemon Squeezy vs Stripe/Paddle)

- **SystÃ¨me de paiement intÃ©grÃ©** (Stripe/Paddle)
- **Gestion abonnements Pro/Premium**
- **DÃ©blocage features payantes** (exports avancÃ©s, analytics dÃ©taillÃ©s)
- **Quotas Management** : Limites par option/segment, feedback temps-rÃ©el
   Aligner la doc "6. [Quotas et Limites](#quotas-et-limites)"
- **QUESTION** : Ã‰tats UI quotas (source de vÃ©ritÃ© serveur, Ã©tats Ã  afficher, seuil "presque plein" 90%/95%?)

**Note:** Formats d'export actuellement supportÃ©s: CSV, PDF, JSON, Markdown (pas de Google Sheets/XLSX)

#### ğŸ¨ ThÃ¨mes Premium (10-15h)

**âšªâš« ThÃ¨me MINIMALISTE Light + Dark (Premium)**
- Public : Power users, pros, sessions longues
- Objectif : Conversion payante, diffÃ©renciation tangible
- Status : âœ… Specs complÃ¨tes (Ã  gÃ©nÃ©rer par LÃ©a)
- Fichier : `Docs/Visual-Identity-Specs.md` sections 3A/3B
- Accent Light : Coral `#FF6B6B`
- Accent Dark : Mint `#00FFA3`

**ğŸŒ¿ ThÃ¨me NATURE (Gratuit)**
- Public : Grand public, Ã©vÃ©nements occasionnels
- Objectif : Acquisition, marketing viral
- Status : âœ… Specs complÃ¨tes + mockups gÃ©nÃ©rÃ©s
- Fichier : `Docs/Visual-Identity-Specs.md` section 3

#### ğŸ“… Sondages de Dates RÃ©currents (28-40h) ğŸ’¼ PREMIUM/PRO - DIFFÃ‰RENCIATEUR IA

**Concept :** GÃ©nÃ©ration automatique de sondages rÃ©currents via IA. RÃ©servÃ© aux clients Premium/Pro.

**Valeur ajoutÃ©e :**
- **Gain de temps** : Plus besoin de crÃ©er manuellement le mÃªme sondage chaque semaine/mois
- **DiffÃ©renciation vs Doodle** : RÃ©currence automatique + IA = unique sur le marchÃ©
- **Conversion premium** : Feature tangible qui montre la valeur de l'abonnement
- **IA au centre** : L'IA comprend le langage naturel pour crÃ©er les templates rÃ©currents

**Architecture :**

**1. Template de rÃ©currence (nouveau type de ressource)**
- [ ] Table `recurring_poll_templates` (Supabase)
  - RÃ¨gle de rÃ©currence (frequency, dayOfWeek, timeSlots, exclusions)
  - Template de sondage rÃ©utilisable (participants, settings)
  - Options gÃ©nÃ©ration automatique (autoGenerate, generateDaysAhead, maxPollsAhead)
- [ ] Interface `RecurringPollTemplate` dans codebase
- [ ] Migration SQL pour crÃ©ation table

**2. Service de gÃ©nÃ©ration automatique**
- [ ] Edge Function `/api/recurring-polls/generate` (Supabase)
- [ ] Cron job quotidien (2h du matin) pour gÃ©nÃ©ration automatique
- [ ] Calcul dates futures selon rÃ¨gles de rÃ©currence
- [ ] VÃ©rification doublons (Ã©viter crÃ©ation si sondage existe dÃ©jÃ )
- [ ] Notifications email optionnelles (crÃ©ateur informÃ©)

**3. IntÃ©gration IA dans le chat**
- [ ] DÃ©tection mots-clÃ©s rÃ©currence dans `GeminiService.ts`
  - "chaque", "tous les", "rÃ©current", "hebdomadaire", "mensuel", etc.
- [ ] Prompt IA enrichi pour extraire rÃ¨gle de rÃ©currence depuis texte naturel
- [ ] Parsing JSON structurÃ© (frequency, dayOfWeek, timeSlots)
- [ ] Workflow conversationnel :
  ```
  Utilisateur : "CrÃ©e un sondage rÃ©current pour notre rÃ©union d'Ã©quipe chaque mardi Ã  14h"
  IA : "âœ… Template rÃ©current crÃ©Ã© ! [Options] GÃ©nÃ©rer automatiquement ?"
  ```

**4. Interface utilisateur**
- [ ] Section "RÃ©currences" dans Dashboard (Premium/Pro uniquement)
  - Liste templates actifs/en pause
  - Prochain sondage Ã  gÃ©nÃ©rer
  - Boutons : Pause, Ã‰diter, Voir tous les sondages
- [ ] Toggle "Rendre ce sondage rÃ©current" dans `PollCreator.tsx`
- [ ] SÃ©lecteur frÃ©quence (hebdomadaire, bi-mensuelle, mensuelle, custom)
- [ ] SÃ©lecteur jour(s) de la semaine
- [ ] Options gÃ©nÃ©ration (auto/non, jours Ã  l'avance, max en attente)
- [ ] Modal upgrade si tier gratuit tente d'accÃ©der

**5. Restrictions Premium/Pro**
- [ ] VÃ©rification tier dans `QuotaService.ts` ou `usePolls.ts`
- [ ] Blocage crÃ©ation template si tier gratuit
- [ ] Modal upgrade avec bÃ©nÃ©fices :
  - "GÃ©nÃ©ration automatique de sondages"
  - "Templates rÃ©utilisables"
  - "Notifications automatiques"
- [ ] Badge "Premium" visible dans UI rÃ©currences

**6. DiffÃ©renciation IA - Features avancÃ©es**
- [ ] ComprÃ©hension naturelle :
  - "chaque mardi matin" â†’ weekly, dayOfWeek: [2], timeSlots: [8h-12h]
  - "1er lundi du mois" â†’ monthly, weekOfMonth: 1, dayOfWeek: [1]
  - "tous les 15 jours le jeudi" â†’ biweekly, dayOfWeek: [4]
- [ ] Suggestions intelligentes :
  - "J'ai dÃ©tectÃ© que vous crÃ©ez souvent des sondages le mardi. Template rÃ©current ?"
- [ ] Optimisation automatique :
  - Ã‰viter conflits (dÃ©jÃ  un sondage cette date)
  - Ajuster crÃ©neaux selon disponibilitÃ©s historiques
  - Proposer alternatives si dates problÃ©matiques

**ImplÃ©mentation par phases :**

**Phase 1 : MVP (8-12h)**
- [ ] Table `recurring_poll_templates` + migration SQL
- [ ] Service `RecurringPollService.ts` (CRUD templates)
- [ ] DÃ©tection IA basique (mots-clÃ©s + prompt structurÃ©)
- [ ] CrÃ©ation template depuis chat IA
- [ ] GÃ©nÃ©ration manuelle (bouton "GÃ©nÃ©rer le prochain")
- [ ] UI Dashboard section rÃ©currences (basique)

**Phase 2 : Automatisation (12-16h)**
- [ ] Edge Function gÃ©nÃ©ration quotidienne
- [ ] Cron Supabase (tous les jours Ã  2h)
- [ ] Logique calcul dates (rÃ©utiliser librairie date-fns ou similar)
- [ ] VÃ©rification doublons/intelligente
- [ ] Notifications email (optionnel via Resend)
- [ ] Dashboard complet (gestion, pause, Ã©dition)

**Phase 3 : AvancÃ© (8-12h)**
- [ ] RÃ¨gles complexes (exclusions dates, modifications ponctuelles)
- [ ] Analytics rÃ©currences (taux participation, tendances)
- [ ] Suggestions IA d'optimisation (meilleures dates selon historique)
- [ ] Export templates rÃ©currents (JSON/CSV)

**Fichiers Ã  crÃ©er :**
- [ ] `src/services/RecurringPollService.ts`
- [ ] `src/components/recurring/RecurringPollTemplate.tsx`
- [ ] `src/components/recurring/RecurringPollDashboard.tsx`
- [ ] `src/lib/recurrence-utils.ts` (calcul dates, parsing rÃ¨gles)
- [ ] `supabase/functions/generate-recurring-polls/index.ts`
- [ ] `sql-scripts/create-recurring-polls-table.sql`

**Fichiers Ã  modifier :**
- [ ] `src/lib/gemini.ts` (dÃ©tection rÃ©currence dans prompts)
- [ ] `src/services/PollCreatorService.ts` (crÃ©ation template)
- [ ] `src/components/PollCreator.tsx` (toggle rÃ©currence + UI)
- [ ] `src/components/Dashboard.tsx` (section rÃ©currences)
- [ ] `src/services/QuotaService.ts` (vÃ©rification tier)
- [ ] `src/hooks/usePolls.ts` (gestion rÃ©currences)

**Valeur marketing :**
- Message : "FatiguÃ© de crÃ©er le mÃªme sondage chaque semaine ? Avec Premium, vos rÃ©unions rÃ©currentes se crÃ©ent automatiquement. L'IA comprend votre rythme et gÃ©nÃ¨re les sondages Ã  l'avance."
- DiffÃ©renciation : Doodle n'a pas de rÃ©currence automatique â†’ Avantage compÃ©titif clair

**PrioritÃ© :** ğŸŸ¡ MOYENNE - Feature premium diffÃ©renciante, aprÃ¨s validation monÃ©tisation base
**PrÃ©requis :** Phase 4 MonÃ©tisation complÃ¨te (systÃ¨me paiement + tiers fonctionnels)

---

**Objectif Phase 4 :** Valider conversion freemium â†’ payant

---

### Phase 5 (Mois 9-12) : Scale International
**DÃ©clencheur :** 1000+ utilisateurs, demande internationale

> **ğŸ“„ Voir :** [`INTERNATIONAL-LAUNCH-STRATEGY.md`](./INTERNATIONAL-LAUNCH-STRATEGY.md) - Roadmap complÃ¨te i18n + paiements internationaux + conformitÃ© RGPD/DPDP

#### i18n (Internationalisation) (10-15h)
- Setup i18next
- Traductions (ES, DE, IT)
- Formats locaux (dates, nombres, devises)
- DÃ©tection automatique langue navigateur

**Impact :** Expansion marchÃ© au-delÃ  de FR/EN

#### PWA/Mobile Native (20-40h)
**Option A : PWA Core Features**
- Installable app
- Push notifications
- Offline functionality

**Option B : Mobile Native (Capacitor)**
- Transform web app to Android native
- Native APIs integration
- Push notification system complet

**DÃ©cision :** Selon usage mobile en Phase 4

**Objectif Phase 5 :** Expansion gÃ©ographique

---

### Phase 6 (Mois 12+) : UX Premium
**DÃ©clencheur :** Feedback utilisateurs demandant ces features


#### Smart Suggestions Proactives (6-8h)
- [x] Suggestions contextuelles intelligentes (via Validation Objectifs)
- [x] Boutons "Appliquer" cliquables
- [ ] Suggestions proactives EN TEMPS RÃ‰EL pendant l'Ã©dition
- [ ] "Cette question pourrait Ãªtre une matrice ?" (dÃ©tection patterns)
- [ ] "Trop d'options, veux-tu les grouper ?" (optimisation UX)
- [ ] Undo/Redo
- [ ] Tester formulations naturelles possibles

**Statut :** ğŸŸ¡ PARTIELLEMENT IMPLÃ‰MENTÃ‰
- âœ… Suggestions post-simulatgion avec application 1-clic
- â³ Suggestions proactives temps rÃ©el (Phase 6)

**Objectif Phase 6 :** DiffÃ©renciation UX

**Pour complÃ©ter la feature :**
- DÃ©tection proactive pendant l'Ã©dition :
// Exemple : DÃ©tecter qu'une question a >7 options
useEffect(() => {
  if (question.options.length > 7) {
    showSuggestion("Trop d'options, veux-tu les grouper ?");
  }
}, [question.options]);
- Suggestions contextuelles par question :
      "Cette question texte pourrait Ãªtre un choix multiple ?"
      "Ajouter une option 'Autre' ?"
      "Rendre cette question obligatoire ?"
- Undo/Redo :
      Historique des modifications
      Boutons Ctrl+Z / Ctrl+Y

## BACKLOG WAITING FOR DEMAND
Roadmap en ligne ? https://www.featurebase.app/features/public-roadmaps

### Nice-to-have
- **Reordering & Duplication** : Focus management, raccourcis clavier, annonces ARIA, ID stability

### Continuous integration
- Gagner en vitesse
  - ğŸ“Š **Analyse Phase 2/3** : Voir `Docs/E2E-PHASE-2-ANALYSIS.md`
      - Phase 2 : Gain estimÃ© ~27-32s par run (70-85% rÃ©duction), ROI excellent âœ…
      - Phase 3 : Gain estimÃ© ~165-175s mais fichier critique (analytics-ai), risque Ã©levÃ© â¸ï¸
      - **Recommandation** : Phase 3 NON recommandÃ©e pour l'instant (fichier fonctionnel, CI acceptable 1m 30s)
