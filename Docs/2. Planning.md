# DooDates - Planning de DÃ©veloppement 

### A VOIR

### ðŸš€ Prochaine Ã‰tape 
- **Interface chat amÃ©liorÃ©e**
  - CrÃ©ation de questionnaire par IA
  - Modification possible
  - Historique conversations
- **Exporter** â†’ CSV/PDF des rÃ©sultats
- **PWA Features** : Installable, notifications push, offline
#### 3.2 IA Conversationnelle AvancÃ©e
**Objectif :** IA complÃ¨te avec parsing avancÃ©

**FonctionnalitÃ©s IA avancÃ©es :**
```typescript
// ai/advanced/
â”œâ”€â”€ ContextManager.ts       // Gestion contexte conversation
â”œâ”€â”€ DateTimeParser.ts       // Parsing dates/heures NLP
â”œâ”€â”€ SmartSuggestions.ts     // Suggestions intelligentes
â”œâ”€â”€ LearningEngine.ts       // Apprentissage prÃ©fÃ©rences
â””â”€â”€ ConversationFlow.ts     // Flow conversation optimisÃ©
```
**Parsing avancÃ© :**
- "mercredi prochain" â†’ date exacte
- "15h-17h" â†’ crÃ©neaux horaires
- "Paul et Marie" â†’ participants
- "rÃ©union Ã©quipe" â†’ contexte mÃ©tier

### En attente
- **Flux avec emails**
- **Templates d'emails professionnels** : CrÃ©ation, vote confirmation, notifications
- **Analytics** : MÃ©triques usage + performance
- **SystÃ¨me de Paiement**
  ## Connexion Calendrier (Optionnelle et DiscrÃ¨te)
- **Proposition automatique** aprÃ¨s sÃ©lection des dates
- **Lien direct** : "Connecter votre calendrier (optionnel)" cliquable
- **Fermeture discrÃ¨te** : Croix pour masquer cette section
- **Interface minimaliste** : Une seule ligne avec lien et bouton fermer
- **ComplÃ¨tement optionnel** : peut Ãªtre ignorÃ© ou fermÃ©
 ## Supabase
- **Supabase Integration** : Remplacement localStorage par vraie DB mobile-optimisÃ©e
    - **Configuration Projet :**
      - **Nom projet :** `doodates-prod`
      - **RÃ©gion :** Europe (eu-west-1)
      - **Plan :** Pro (25$/mois - nÃ©cessaire pour RLS avancÃ©)
      - **Environnements :**
        - `doodates-dev` (dÃ©veloppement)
        - `doodates-staging` (tests)
        - `doodates-prod` (production)
- **Authentication** : Google OAuth + email/password mobile-friendly
- **API Routes** : CRUD optimisÃ© pour mobile
- **SÃ©curitÃ© :**
- Row Level Security (RLS) activÃ© sur toutes les tables
- Policies restrictives par dÃ©faut
- API Keys sÃ©parÃ©es par environnement
- CORS configurÃ© pour domaines autorisÃ©s
- **Beta Launch** : 50+ early adopters focus mobile

#### 1.3 Authentication
**Objectif :** SystÃ¨me d'auth flexible (connectÃ© + anonyme)
**Providers configurÃ©s :**
- **Google OAuth** (prioritÃ© - 80% des utilisateurs)
- **Email/Password** (backup - 20% des utilisateurs)
- **Anonymous** (pour votes sans inscription)
**Flux d'authentification :**
1. **CrÃ©ateur de sondage** : Auth obligatoire (Google ou Email)
2. **Votant** : Auth optionnelle (peut voter avec juste email)
3. **Session anonyme** : UUID temporaire pour conversations IA

## Phase 4 : Application Mobile Native (Capacitor)

#### 4.1 Setup Capacitor (Semaine 9)
**Objectif :** Transformer l'app web en application Android native

#### 4.2 APIs Natives 
**Objectif :** IntÃ©gration fonctionnalitÃ©s natives Android
**Services natifs implÃ©mentÃ©s :**
- SystÃ¨me de notifications push complet

#### Polish & Beta Launch 
**1. Achat et Configuration du Nom de Domaine**
**2. HÃ©bergement et DÃ©ploiement**
**3. Configuration Email & DNS**
**4. Configuration Base de DonnÃ©es Production**
**5. SÃ©curitÃ© et Performance**
**6. Tests de Production**
**7. Configuration Domaines et Redirections**
**8. Mise en Production**

## Plan Dual Poll Types (Dates vs Formulaire)

### Ã‰tat d'avancement

- __En cours__
    - [stabilize-selectors] Audit complÃ©mentaire pour gÃ©nÃ©raliser `data-testid` (tous Ã©crans/flows).
    - Consolidation E2E Â« Ultra Simple Â» (rÃ©duction flakiness, helpers robustClick/warmup, garde console).

- __Ã€ faire (prochaines Ã©tapes)__

  - __PrioritÃ© 1 â€” Bloquants MVP FormPoll__

    - AccessibilitÃ© (Ã©diteur + vote): focus management, `aria-describedby`/`aria-live`, labels explicites.

  - __PrioritÃ© 2 â€” QualitÃ© et UX mobile__
    - Performance: rendre uniquement la question active (dÃ©jÃ  fait) + prÃ©parer la virtualisation si > 20 questions.
    - Histogrammes rÃ©sultats FormPoll (mini barres) + pagination lÃ©gÃ¨re pour texte.
    - Analytics: taux de complÃ©tion, erreurs validation.
    - Documentation: capter les conventions UI dans `Docs/DooDates-UX-Flow.md` et README.

  - __PrioritÃ© 3 â€” Gouvernance et robustesse__
    - Feature flag `enableFormPoll`: gouvernance et bascule progressive.
    - Anti-doublons avancÃ© (empreinte locale optionnelle, seuil anti double-submit).
    - Virtualisation si > 20 questions, debouncing autosave.
    - Reordering/Duplication robustes avec conservation du focus.
    - Partage: MÃªme composant que DatePoll (lien, copier, envoyer email plus tard).

  - __Hors scope MVP (plus tard)__
    - Logique conditionnelle entre questions (branching).
    - Pages longues type Typeform.
    - Scoring, quotas.
    - Fichiers uploadÃ©s.
    - Auth forcÃ©e des rÃ©pondants.

### 3) ModÃ¨le de domaine unifiÃ© (LATER)

- __Types principaux__
  - Poll { id, type, title, createdAt, ... }
  - For type `date`: options = Date + TimeSlots
  - For type `form`: questions[]
    - Question { id, kind: single|multiple|text, title, required, options?, maxChoices? }
  - Response { pollId, respondentName?, items[] }
    - ResponseItem { questionId|dateSlotId, value }

- __RÃ¨gles__
  - Validation cÃ´tÃ© client pour types single/multiple (maxChoices) et required
  - Type-safety via TypeScript unions discriminants pour `kind`

### 4) SchÃ©ma DB (Supabase) et paritÃ© localStorage (LATER, sans migration)

- __Tables (proposition)__
  - polls(id, type, title, slug, created_at, ...)
  - date_options(poll_id, date)
  - time_slots(poll_id, date_option_id, start, end)
  - questions(poll_id, question_id, kind, title, required, max_choices)
  - question_options(poll_id, question_id, option_id, label)
  - responses(id, poll_id, respondent_name, created_at)
  - response_items(response_id, question_id?, date_option_id?, time_slot_id?, value_text?, option_id?)

- __Local dev__
  - Structure JSON miroir pour `dev-polls` dans localStorage afin de tester sans Supabase.
  - Migration legacy: les anciens brouillons de formulaires stockÃ©s sous `dev-form-polls` sont migrÃ©s automatiquement vers `dev-polls` Ã  la lecture (voir `migrateFormDraftsIntoUnified()` interne Ã  `src/lib/pollStorage.ts`). La clÃ© legacy est nettoyÃ©e aprÃ¨s fusion.

### 4.b) Stockage unifiÃ© & APIs (DEV)

- __ClÃ© unique__
  - `dev-polls`: contient une liste de `Poll` oÃ¹ `poll.type` discrimine `"date"` ou `"form"`.

- __Helpers (`src/lib/pollStorage.ts`)__
  - `getAllPolls()` retourne la liste unifiÃ©e aprÃ¨s migration; valide chaque entrÃ©e selon son type.
  - `getPolls()` retourne uniquement les sondages de type date (compat ascendante UI existante).
  - `addPoll(poll)` valide par type puis ajoute Ã  lâ€™unifiÃ©.
  - `deletePollById(id)`, `duplicatePoll(poll)`, `getPollBySlugOrId(key)`, `savePolls(polls)`, `buildPublicLink(slug)`, `copyToClipboard(text)`.

- __Validation__
  - Type `date`: `settings.selectedDates` doit Ãªtre un tableau non vide de chaÃ®nes.
  - Type `form`: `title` non vide; `questions` libre (MVP). Des validations supplÃ©mentaires seront ajoutÃ©es avec le moteur de questions.

- __Comportements UI clÃ©s__
  - Dashboard consomme `getAllPolls()` pour lister tous les sondages.
  - CrÃ©ation Date poll (dev) pose `type: "date"` dans les objets persistÃ©s localement.
  - CrÃ©ation Form poll (dev) persiste les brouillons et finalisations via la liste unifiÃ©e avec `type: "form"`.

### 5) Impact API & composants (LATER)

- __Front__
  - `src/components/polls/`: crÃ©ateur FormPoll (questions); persistance via stockage unifiÃ©.
  - `src/components/Dashboard.tsx`: liste lâ€™unifiÃ© via `getAllPolls()` (plus de lecture `dev-form-polls`).
  - `src/components/voting/`: rendu FormPoll (single/multiple/text).
  - `src/hooks/usePolls.ts`: en dev, les crÃ©ations locales de Date poll posent `type: 'date'`.
  - `src/pages/Results.tsx`: afficher aggrÃ©gations FormPoll.
  - Feature flag lÃ©ger: `enableFormPoll` pour gating UI.

- __Tests existants__
  - VÃ©rifier `data-testid` sur nouveaux composants

- __Unit (ajout)__
  - `src/lib/__tests__/pollStorage.test.ts` couvre `getAllPolls()`, la migration `dev-form-polls` -> `dev-polls`, et la validation minimale des FormPolls.
