# DooDates - Development Planning

## 1. Current Status & Immediate Next Steps

### En cours
- Historique des conversations disponible dans le dashboard

### Prochaine étape prioritaire
- **Interface chat améliorée**
  - Création de questionnaire par IA, en plus des sondages de dates
  - Modification possible d'un sondage ou d'un questionnaire

### Export Features (MVP)
- **Format CSV uniquement** pour le MVP (rapide, interop, léger)
- **PDF** (résumé lisible) en "Later" pour partage humain
- **XLSX** réservé au palier Pro (aligné Doodle: export Excel = feature payante)

#### Points d'entrée UX
- Dashboard (`src/components/Dashboard.tsx`): action "Exporter" par sondage (menu `PollActions`)
- Résultats (`/poll/:slug/results`): bouton "Exporter" visible propriétaire
- État: désactivé si aucun vote/réponse

#### Sécurité & accès
- Liens d'export non indexables, aucune URL signée côté client en MVP

#### Formats CSV
- Encodage UTF-8 avec BOM, séparateur ","
- Horodatages ISO 8601 (UTC) + colonne `timezone_display`
- **Métadonnées en tête**: `poll_id`, `poll_slug`, `poll_title`, `type`, `created_at`, `status`, `exported_at`
- **DatePoll (wide)**: 1 ligne par répondant, 1 colonne par option (date/slot), valeurs: YES/MAYBE/NO/EMPTY
- **DatePoll (long)**: 1 ligne par (respondant, option) avec colonnes `choice` in {yes, maybe, no}
- **FormPoll (long)**: 1 ligne par (respondant, question), colonnes: `question_id`, `question_title`, `kind`, `value` (texte ou étiquettes jointes par `|`), `selected_count`
- Colonnes communes: `respondent_display`, `respondent_hash` (pseudo-ID stable local), `submitted_at`, `source` {link, email, qr}

#### Comportements techniques
- Noms de colonnes stables snake_case
- Valeurs échappées (quotes) si virgules ou nouvelles lignes
- Fichiers nommés: `doodates_{type}_{slug}_{YYYYMMDD-HHmmss}.csv`
- Génération côté client via util `toCsv()` et `Blob` + `URL.createObjectURL`
- Largeur: limiter à 10k lignes; au-delà, proposer format long uniquement
- Préparer hook `useExportCsv(poll)` dans `src/lib/exports.ts`

#### Tests requis
- Unit: snapshot CSV (small fixtures) + vérif BOM/encodage + valeurs YES/MAYBE/NO
- E2E: bouton visible/invisible selon droits, téléchargement déclenché

### PWA Features
- Installable, notifications push, offline

## 2. Active Development (MVP Focus)

### 2.1 Immediate Blockers
- **Gemini test problems** - solve current issues

### 2.2 Dashboard Improvements
- **Archive system**
  - Bouton "Archiver" dans PollActions
  - Filtre "archived" (actuellement non proposé dans les boutons de filtre alors que géré dans `getStatusColor()`)
- **Sorting & pagination**
  - Tri par updated_at, votes_count, participants_count
  - Pagination si > N éléments
- **Quick sharing**
  - Bouton "Copier le lien public" visible
  - Badge "Lien copié"
- **Poll indicators**
  - Meilleure(s) date(s) (résumé 1–2 chips) pour les DatePolls
- **Poll claiming**
  - Si créé sans compte, action "Associer à mon compte" (flow de claim via token)

### 2.3 Form Poll Features
#### Multi-step Flow (Typeform-style)
- Une question par écran, navigation « Suivant/Précédent »
- Barre de progression
- Validation par étape, autosave, reprise
- Mobile-first, performances (éviter re-renders lourds)
- **QUESTION**: Seuils/valeurs pour pagination texte (ex: >50 réponses → « Voir plus ») et N pour pagination Dashboard

#### Results Display
- **Histogrammes résultats FormPoll** (mini barres horizontales)
  - UX: lisible en compact (cartes, section récap)
  - Tech: composant de barre simple (width = pourcentage), gestion des égalités, couleurs accessibles
  - Pagination légère: si question texte libre a beaucoup de réponses, afficher par pages ou « Voir plus »
  - **QUESTION**: Préciser l'échelle (pourcentage vs valeur brute), troncature des labels, gestion des ex-aequo

### 2.4 Authentication & Security
- **Sans Compte Owner Token** (voir @Sans-Compte-OwnerToken.md)

#### Priority 1 - MVP Blockers
- **Accessibilité** (éditeur + vote)
  - Focus management
  - `aria-describedby`/`aria-live`
  - Labels explicites

#### Priority 2 - Quality & UX Mobile
- **Performance optimization**
  - Rendre uniquement la question active (déjà fait)
  - Préparer la virtualisation si > 20 questions
- **Analytics for development**
  - Taux de complétion: répondants ayant fini / ayant commencé
  - Abandons par étape: où les gens quittent
  - Erreurs de validation: volume et type (ex: champ requis manqué)
  - Tech: instrumentation d'événements (start, next, submit, validation_error) + tableau de bord agrégé

#### Priority 3 - Governance & Robustness
- **Anti-doublons avancé**
  - Double-submit: désactiver le bouton après clic, idempotence côté API (token de soumission), seuil de tempo (ex: 3–5 s)
  - Empreinte locale optionnelle: hash local (device + pollId + contenu) stocké en localStorage pour alerter l'utilisateur
  - Sans bloquer des cas légitimes (option « envoyer quand même »)
  - **QUESTION**: Décider si l'empreinte locale bloque ou alerte; définir le délai anti double-submit (ex: 3–5 s)

### IA conversationnelle avancée
**Objectif :** IA complète avec parsing avancé

**Fonctionnalités IA avancées :**
```typescript
// ai/advanced/
├── ContextManager.ts       // Gestion contexte conversation
├── DateTimeParser.ts       // Parsing dates/heures NLP
├── SmartSuggestions.ts     // Suggestions intelligentes
├── LearningEngine.ts       // Apprentissage préférences
└── ConversationFlow.ts     // Flow conversation optimisé
```
**Parsing avancé :**
- "mercredi prochain" → date exacte
- "15h-17h" → créneaux horaires
- "Paul et Marie" → participants
- "réunion équipe" → contexte métier

## 3. Feature Roadmap & Advanced Features

### 3.1 Immediate Backlog (Next Sprint)
- **Email Templates & Workflows**
  - Templates d'emails professionnels: Création, vote confirmation, notifications
  - Flux avec emails automatisés
- **Analytics & Monitoring**
  - Métriques usage + performance
  - Tableau de bord pour développeurs

### 3.2 Calendar Integration (Optional & Discrete)
- **Auto-suggestion** après sélection des dates
- **Direct link**: "Connecter votre calendrier (optionnel)" cliquable
- **Discrete closure**: Croix pour masquer cette section
- **Minimal interface**: Une seule ligne avec lien et bouton fermer
- **Completely optional**: peut être ignoré ou fermé

### 3.3 PWA & Mobile Native Features
- **PWA Core Features**
  - Installable app
  - Push notifications
  - Offline functionality
- **Mobile Native (Capacitor)**
  - Transform web app to Android native
  - Native APIs integration
  - Push notification system complet

### 3.4 Advanced Form Features (Post-MVP)
#### Reordering & Duplication Robustness
- **MVP Requirements**
  - Focus après duplication: focus automatique sur l'input titre de la question dupliquée
  - Focus après réordonnancement: conserver exactement le focus (titre ou option) et position de scroll
- **Post-MVP Enhancements**
  - Raccourcis clavier: Alt+Flèche Haut/Bas pour déplacer; Ctrl+D pour dupliquer
  - Annonces ARIA via région `aria-live="polite"` ("Question déplacée en position N")
  - Navigation Tab cohérente après opérations
- **ID Stability**
  - IDs uniques pour options lors duplication
  - Éviter collisions au sein d'une même question
- **Mobile UX**
  - Indicateur visuel de focus
  - Grandes zones de clic pour boutons Monter/Descendre/Dupliquer
  - Pas de saut intempestif de scroll

#### Advanced Logic & Scoring
- **Conditional Logic** (branching entre questions)
- **Scoring System**
  - Attribuer points/poids aux réponses pour calculer score
  - Use cases: priorisation, matching, qualification
- **Quotas Management**
  - Limites par option/segment (ex: max 100 réponses pour "créneau A")
  - Feedback temps-réel quand quota atteint
  - Tech: validation côté serveur, verrouillage optimiste, messages d'état UI
  - **QUESTION**: Définir source de vérité serveur + états UI (complet, presque plein, fermé)

### 3.5 Payment System & Monetization
- **Système de paiement intégré**
- **Gestion abonnements Pro/Premium**
- **Déblocage features payantes** (PDF/XLSX export)
- **Métriques de conversion** et analytics business

### 3.6 File & Media Support
- **File Uploads** dans formulaires
- **Media attachments** pour contexte sondages

### 3.7 Advanced Authentication
- **Forced Authentication** pour répondants (option)
- **Enterprise SSO** integration
- **Advanced permissions** et rôles
- **Multi-factor Authentication** pour les comptes administrateurs

## 4. Technical Architecture References

Detailed technical specifications are maintained in dedicated documents:
- **Database schema and data models**: `5. Database-Schema.md`
- **AI integration and conversational interface**: `7. Integration-IA.md`
- **Authentication and API endpoints**: `6. API-Endpoints.md`
- **Mobile native strategy**: `5. Mobile-Strategy-Capacitor.md`

## 5. Deployment & Operations

### Production Setup
- Domain acquisition and DNS configuration
- Hosting and deployment pipeline
- Email service configuration
- Production database setup
- Security and performance optimization
- Production testing
- Domain routing and redirections
- Go-live deployment

### CI/CD Pipeline
- Automated testing (unit, e2e)
- Branch protection rules
- Deployment automation
- Monitoring and alerts

### Beta Launch Strategy
- Target: 100+ early adopters
- Mobile-first focus
- Feedback collection and iteration