name: ðŸš€ Quick E2E Debug Test

on:
  workflow_dispatch:  # Permet de lancer manuellement
  push:
    branches: [debug-e2e]  # Optionnel: dÃ©clencher sur cette branche

jobs:
  quick-e2e-debug:
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout Code
        uses: actions/checkout@v4
        
      - name: ðŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          
      - name: ðŸ“¦ Install Dependencies
        run: npm ci
        
      - name: ðŸ§ª Tests Unitaires Rapides
        run: npm run test:unit:fast
        timeout-minutes: 2
        
      - name: ðŸ“ TypeScript Check
        run: npm run type-check
        timeout-minutes: 2
        
      - name: ðŸ§¹ Linting & Formatage
        run: npm run lint -- --max-warnings=0
        timeout-minutes: 2
        
      - name: ðŸ—ï¸ Build Validation
        run: npm run build
        timeout-minutes: 3
        
      - name: ðŸŽ­ Cache Playwright browsers
        id: cache-playwright
        uses: actions/cache@v4
        with:
          path: ~/.cache/ms-playwright
          key: ${{ runner.os }}-playwright-${{ hashFiles('package-lock.json', 'playwright.config*.ts') }}
          restore-keys: |
            ${{ runner.os }}-playwright-
        
      - name: ðŸ§­ Install Playwright
        run: |
          echo "ðŸ”§ Installation de Playwright pour le test de debug CI"
          npx playwright install --with-deps
        timeout-minutes: 3
        
      - name: ðŸš€ Quick E2E Debug Test
        run: |
          echo "ðŸ” DÃ‰BUT DU TEST RAPIDE E2E DEBUG"
          echo "ðŸ”§ NODE_ENV=development pour interface React complÃ¨te"
          echo "âš¡ Test rapide pour diagnostiquer les problÃ¨mes CI"
          echo ""
          CI=true NODE_ENV=development BASE_URL=http://localhost:8080/DooDates VITE_GEMINI_API_KEY=TEST_MODE npx playwright test tests/e2e/ci-debug-chat-input.spec.ts --project=chromium --reporter=list
        timeout-minutes: 5
        
      - name: ðŸ“¸ Upload Debug Screenshots
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: quick-e2e-debug-screenshots-${{ github.run_number }}
          path: |
            test-results/**/*.png
            ci-debug-*.png
          retention-days: 3
          
      - name: ðŸ“Š Quick Debug Summary
        if: always()
        run: |
          echo "## Quick E2E Debug Results" >> $GITHUB_STEP_SUMMARY
          echo "- **Test**: CI Debug Chat Input Analysis" >> $GITHUB_STEP_SUMMARY
          echo "- **Environment**: NODE_ENV=development" >> $GITHUB_STEP_SUMMARY
          echo "- **Purpose**: Diagnose React initialization issues" >> $GITHUB_STEP_SUMMARY
          echo "- **Status**: ${{ job.status }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ“¸ Screenshots uploaded in artifacts" >> $GITHUB_STEP_SUMMARY
