name: 5Ô∏è‚É£ YAML Workflows Validation

on:
  pull_request:
    paths:
      - '.github/workflows/**'
  push:
    branches: [main, develop]
    paths:
      - '.github/workflows/**'

jobs:
  validate-yaml:
    runs-on: ubuntu-latest
    steps:
      - name: üì• Checkout code
        uses: actions/checkout@v4

      - name: üîç Validate YAML syntax
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: üì¶ Install YAML validator
        run: npm install -g yaml-validator

      - name: ‚úÖ Validate all workflow files
        run: |
          echo "Validating YAML files..."
          for file in .github/workflows/*.yml; do
            echo "Checking $file..."
            yaml-validator "$file" || exit 1
          done
          echo "‚úÖ All YAML files are valid!"

      - name: üîç Check for common issues
        run: |
          echo "Checking for common YAML issues in workflows..."
          
          # Check for problematic patterns in body/title fields
          # Note: Checking for cross mark emoji (U+274C) in body/title
          if grep -r 'body:.*\xE2\x9D\x8C' .github/workflows/ || grep -r 'title:.*\xE2\x9D\x8C' .github/workflows/; then
            echo "Found problematic emoji in body/title fields"
            echo "Use text instead: 'Failed' or 'Error'"
            exit 1
          fi
          
          # Check for markdown bold ** in multi-line strings
          if grep -r "body:.*\*\*" .github/workflows/; then
            echo "‚ö†Ô∏è Warning: Found markdown bold ** in body fields"
            echo "This may cause YAML parsing issues. Use plain text instead."
            exit 1
          fi
          
          # Check for numbered lists starting with digits
          if grep -r "body:.*^[0-9]\." .github/workflows/; then
            echo "‚ö†Ô∏è Warning: Found numbered lists in body fields"
            echo "Use bullet points (-) instead to avoid YAML parsing issues."
            exit 1
          fi
          
          echo "‚úÖ No common YAML issues found!"
