name: Error Handling Enforcement

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  workflow_dispatch:

jobs:
  error-handling-enforcement:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: Install dependencies
      run: npm ci
      
    - name: Run Error Handling Enforcement Tests
      run: npm run test:error-handling
      
    - name: Report Results
      if: always()
      run: |
        echo "## ðŸ›¡ï¸ Error Handling Enforcement Results" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        if [ ${{ job.status }} == 'success' ]; then
          echo "âœ… All error handling patterns are compliant with centralized system" >> $GITHUB_STEP_SUMMARY
        else
          echo "âŒ Found violations of centralized error handling patterns" >> $GITHUB_STEP_SUMMARY
          echo "Please fix the violations reported above and use:" >> $GITHUB_STEP_SUMMARY
          echo "- \`logError(ErrorFactory.category('message', 'userMessage'), { context })\` for logging" >> $GITHUB_STEP_SUMMARY
          echo "- \`throw ErrorFactory.category('message', 'userMessage')\` instead of \`throw new Error\`" >> $GITHUB_STEP_SUMMARY
          echo "- Import from \`../lib/error-handling\` when handling errors" >> $GITHUB_STEP_SUMMARY
        fi
